{"title":"Vue中v-for为什么要加key","slug":"92","date":"2020-08-16T09:27:45.000Z","updated":"2022-07-29T04:22:04.755Z","comments":true,"path":"api/articles/92.json","excerpt":" [Figure] ","covers":["https://cdn.jsdelivr.net/gh/wuzhiguang1/bolgfile@1.2/photo/IMG_0047.JPG","https://qny.aqingya.cn/img/20200816171140.png","https://qny.aqingya.cn/img/20200816171159.png","https://qny.aqingya.cn/img/20200816171858.png","https://qny.aqingya.cn/img/20200816171921.png","https://qny.aqingya.cn/img/20200816172117.png","https://qny.aqingya.cn/img/20200816172149.png","https://qny.aqingya.cn/img/20200816172211.png","https://qny.aqingya.cn/img/20200816172237.png"],"content":"<p><img src=\"https://cdn.jsdelivr.net/gh/wuzhiguang1/bolgfile@1.2/photo/IMG_0047.JPG\"></p>\n<span id=\"more\"></span>\n\n\n\n<p>我们先来举个栗子🌰：</p>\n<br>\n\n<p>如果我们不加key：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=<span class=\"string\">&quot;app&quot;</span>&gt;</span><br><span class=\"line\">  &lt;div&gt;</span><br><span class=\"line\">    &lt;input type=&quot;text&quot; v-model=&quot;name&quot;&gt;</span><br><span class=\"line\">    &lt;button @click=&quot;add&quot;&gt;添加&lt;/button&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">  &lt;ul&gt;</span><br><span class=\"line\">    &lt;li v-for=&quot; item in list&quot;&gt;</span><br><span class=\"line\">      &lt;input type=&quot;checkbox&quot;&gt; &#123;&#123;item.name&#125;&#125;</span><br><span class=\"line\">    &lt;/li&gt;</span><br><span class=\"line\">  &lt;/ul&gt;</span><br><span class=\"line\">  &lt;script src=&quot;./js/vue.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">  &lt;script&gt;</span><br><span class=\"line\">    // 创建 Vue 实例，</span><br><span class=\"line\">    var vm = new Vue(&#123;</span><br><span class=\"line\">      el: &#x27;#app&#x27;,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        name: &#x27;&#x27;,</span><br><span class=\"line\">        newId: 3,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">            &#123; id: 1, name: &#x27;开心超人&#x27; &#125;, </span><br><span class=\"line\">            &#123; id: 2, name: &#x27;花心超人&#x27; &#125;,</span><br><span class=\"line\">            &#123; id: 3, name: &#x27;小心超人&#x27; &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      methods: &#123;</span><br><span class=\"line\">        add() &#123;</span><br><span class=\"line\">          //注意这里是unshift</span><br><span class=\"line\">          this.list.unshift(&#123;</span><br><span class=\"line\">            id: ++this.newId,</span><br><span class=\"line\">            name: this.name</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">          this.name = &#x27;&#x27;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>当选中花心超人时，添加大大怪将军后选中的确是开心超人，并不是我们想要的结果，我们想要的是当添加大大怪将军后，应该选中的还是花心超人。</p>\n</blockquote>\n<p><img src=\"https://qny.aqingya.cn/img/20200816171140.png\"></p>\n<p><img src=\"https://qny.aqingya.cn/img/20200816171159.png\"></p>\n<br>\n\n<p>当我们加上key：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=<span class=\"string\">&quot;app&quot;</span>&gt;</span><br><span class=\"line\">  &lt;div&gt;</span><br><span class=\"line\">    &lt;input type=&quot;text&quot; v-model=&quot;name&quot;&gt;</span><br><span class=\"line\">    &lt;button @click=&quot;add&quot;&gt;添加&lt;/button&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">  &lt;ul&gt;</span><br><span class=\"line\">    &lt;li v-for=&quot; item in list&quot; :key=&quot;item.id&quot;&gt;</span><br><span class=\"line\">      &lt;input type=&quot;checkbox&quot;&gt; &#123;&#123;item.name&#125;&#125;</span><br><span class=\"line\">    &lt;/li&gt;</span><br><span class=\"line\">  &lt;/ul&gt;</span><br><span class=\"line\">  &lt;script src=&quot;./js/vue.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">  &lt;script&gt;</span><br><span class=\"line\">    // 创建 Vue 实例，</span><br><span class=\"line\">    var vm = new Vue(&#123;</span><br><span class=\"line\">      el: &#x27;#app&#x27;,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        name: &#x27;&#x27;,</span><br><span class=\"line\">        newId: 3,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">            &#123; id: 1, name: &#x27;开心超人&#x27; &#125;, </span><br><span class=\"line\">            &#123; id: 2, name: &#x27;花心超人&#x27; &#125;,</span><br><span class=\"line\">            &#123; id: 3, name: &#x27;小心超人&#x27; &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      methods: &#123;</span><br><span class=\"line\">        add() &#123;</span><br><span class=\"line\">          //注意这里是unshift</span><br><span class=\"line\">          this.list.unshift(&#123;</span><br><span class=\"line\">            id: ++this.newId,</span><br><span class=\"line\">            name: this.name</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">          this.name = &#x27;&#x27;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>同样当选中花心超人时，添加大大怪将军后依旧选中的是花心超人。</p>\n</blockquote>\n<p><img src=\"https://qny.aqingya.cn/img/20200816171858.png\"></p>\n<p><img src=\"https://qny.aqingya.cn/img/20200816171921.png\"></p>\n<br>\n\n<p>查过相关文档，图例说明很清晰。</p>\n<p>vue和react的虚拟DOM的Diff算法大致相同，其核心是基于两个简单的假设<br>首先讲一下diff算法的处理方法，对操作前后的dom树同一层的节点进行对比，一层一层对比，如下图：</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200816172117.png\"></p>\n<p>当某一层有很多相同的节点时，也就是列表节点时，Diff算法的更新过程默认情况下也是遵循以上原则。<br>比如一下这个情况：</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200816172149.png\"></p>\n<p>我们希望可以在B和C之间加一个F，Diff算法默认执行起来是这样的：</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200816172211.png\"></p>\n<p>即把C更新成F，D更新成C，E更新成D，最后再插入E，是不是很没有效率？</p>\n<p>所以我们需要使用key来给每个节点做一个唯一标识，Diff算法就可以正确的识别此节点，找到正确的位置区插入新的节点。</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200816172237.png\"></p>\n<br>\n\n<p>总结：</p>\n<p><span style=\"color:red\"><strong>vue中列表循环需加 :key=”唯一标识” 唯一标识可以是item里面id index等，因为vue组件高度复用增加Key可以标识组件的唯一性，为了更好地区别各个组件 key的作用主要是为了高效的更新虚拟DOM 。</strong></span></p>\n","more":"<p>我们先来举个栗子🌰：</p>\n<br>\n\n<p>如果我们不加key：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=<span class=\"string\">&quot;app&quot;</span>&gt;</span><br><span class=\"line\">  &lt;div&gt;</span><br><span class=\"line\">    &lt;input type=&quot;text&quot; v-model=&quot;name&quot;&gt;</span><br><span class=\"line\">    &lt;button @click=&quot;add&quot;&gt;添加&lt;/button&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">  &lt;ul&gt;</span><br><span class=\"line\">    &lt;li v-for=&quot; item in list&quot;&gt;</span><br><span class=\"line\">      &lt;input type=&quot;checkbox&quot;&gt; &#123;&#123;item.name&#125;&#125;</span><br><span class=\"line\">    &lt;/li&gt;</span><br><span class=\"line\">  &lt;/ul&gt;</span><br><span class=\"line\">  &lt;script src=&quot;./js/vue.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">  &lt;script&gt;</span><br><span class=\"line\">    // 创建 Vue 实例，</span><br><span class=\"line\">    var vm = new Vue(&#123;</span><br><span class=\"line\">      el: &#x27;#app&#x27;,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        name: &#x27;&#x27;,</span><br><span class=\"line\">        newId: 3,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">            &#123; id: 1, name: &#x27;开心超人&#x27; &#125;, </span><br><span class=\"line\">            &#123; id: 2, name: &#x27;花心超人&#x27; &#125;,</span><br><span class=\"line\">            &#123; id: 3, name: &#x27;小心超人&#x27; &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      methods: &#123;</span><br><span class=\"line\">        add() &#123;</span><br><span class=\"line\">          //注意这里是unshift</span><br><span class=\"line\">          this.list.unshift(&#123;</span><br><span class=\"line\">            id: ++this.newId,</span><br><span class=\"line\">            name: this.name</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">          this.name = &#x27;&#x27;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>当选中花心超人时，添加大大怪将军后选中的确是开心超人，并不是我们想要的结果，我们想要的是当添加大大怪将军后，应该选中的还是花心超人。</p>\n</blockquote>\n<p><img src=\"https://qny.aqingya.cn/img/20200816171140.png\"></p>\n<p><img src=\"https://qny.aqingya.cn/img/20200816171159.png\"></p>\n<br>\n\n<p>当我们加上key：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;div id=<span class=\"string\">&quot;app&quot;</span>&gt;</span><br><span class=\"line\">  &lt;div&gt;</span><br><span class=\"line\">    &lt;input type=&quot;text&quot; v-model=&quot;name&quot;&gt;</span><br><span class=\"line\">    &lt;button @click=&quot;add&quot;&gt;添加&lt;/button&gt;</span><br><span class=\"line\">  &lt;/div&gt;</span><br><span class=\"line\">  &lt;ul&gt;</span><br><span class=\"line\">    &lt;li v-for=&quot; item in list&quot; :key=&quot;item.id&quot;&gt;</span><br><span class=\"line\">      &lt;input type=&quot;checkbox&quot;&gt; &#123;&#123;item.name&#125;&#125;</span><br><span class=\"line\">    &lt;/li&gt;</span><br><span class=\"line\">  &lt;/ul&gt;</span><br><span class=\"line\">  &lt;script src=&quot;./js/vue.js&quot;&gt;&lt;/script&gt;</span><br><span class=\"line\">  &lt;script&gt;</span><br><span class=\"line\">    // 创建 Vue 实例，</span><br><span class=\"line\">    var vm = new Vue(&#123;</span><br><span class=\"line\">      el: &#x27;#app&#x27;,</span><br><span class=\"line\">      data: &#123;</span><br><span class=\"line\">        name: &#x27;&#x27;,</span><br><span class=\"line\">        newId: 3,</span><br><span class=\"line\">        list: [</span><br><span class=\"line\">            &#123; id: 1, name: &#x27;开心超人&#x27; &#125;, </span><br><span class=\"line\">            &#123; id: 2, name: &#x27;花心超人&#x27; &#125;,</span><br><span class=\"line\">            &#123; id: 3, name: &#x27;小心超人&#x27; &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      methods: &#123;</span><br><span class=\"line\">        add() &#123;</span><br><span class=\"line\">          //注意这里是unshift</span><br><span class=\"line\">          this.list.unshift(&#123;</span><br><span class=\"line\">            id: ++this.newId,</span><br><span class=\"line\">            name: this.name</span><br><span class=\"line\">          &#125;)</span><br><span class=\"line\">          this.name = &#x27;&#x27;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">  &lt;/script&gt;</span><br></pre></td></tr></table></figure>\n\n<blockquote>\n<p>同样当选中花心超人时，添加大大怪将军后依旧选中的是花心超人。</p>\n</blockquote>\n<p><img src=\"https://qny.aqingya.cn/img/20200816171858.png\"></p>\n<p><img src=\"https://qny.aqingya.cn/img/20200816171921.png\"></p>\n<br>\n\n<p>查过相关文档，图例说明很清晰。</p>\n<p>vue和react的虚拟DOM的Diff算法大致相同，其核心是基于两个简单的假设<br>首先讲一下diff算法的处理方法，对操作前后的dom树同一层的节点进行对比，一层一层对比，如下图：</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200816172117.png\"></p>\n<p>当某一层有很多相同的节点时，也就是列表节点时，Diff算法的更新过程默认情况下也是遵循以上原则。<br>比如一下这个情况：</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200816172149.png\"></p>\n<p>我们希望可以在B和C之间加一个F，Diff算法默认执行起来是这样的：</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200816172211.png\"></p>\n<p>即把C更新成F，D更新成C，E更新成D，最后再插入E，是不是很没有效率？</p>\n<p>所以我们需要使用key来给每个节点做一个唯一标识，Diff算法就可以正确的识别此节点，找到正确的位置区插入新的节点。</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200816172237.png\"></p>\n<br>\n\n<p>总结：</p>\n<p><span style=\"color:red\"><strong>vue中列表循环需加 :key=”唯一标识” 唯一标识可以是item里面id index等，因为vue组件高度复用增加Key可以标识组件的唯一性，为了更好地区别各个组件 key的作用主要是为了高效的更新虚拟DOM 。</strong></span></p>","categories":[{"name":"Vue","path":"api/categories/Vue.json"}],"tags":[{"name":"Vue","path":"api/tags/Vue.json"}]}