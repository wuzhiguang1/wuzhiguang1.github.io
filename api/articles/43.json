{"title":"对原生AJAX 的简单封装","slug":"43","date":"2020-06-24T04:45:32.000Z","updated":"2022-07-29T04:22:04.779Z","comments":true,"path":"api/articles/43.json","excerpt":" [Figure] ","covers":["https://qny.aqingya.cn/img/234.png"],"content":"<p><img src=\"https://qny.aqingya.cn/img/234.png\"></p>\n<span id=\"more\"></span>\n\n<h1 id=\"对原生AJAX-的简单封装-wink\"><a href=\"#对原生AJAX-的简单封装-wink\" class=\"headerlink\" title=\"对原生AJAX 的简单封装:wink:\"></a>对原生AJAX 的简单封装:wink:</h1><p>我们先看一下JQuery的AJAX的使用。<br>jQuery.ajax(url,[settings])</p>\n<p>参数：</p>\n<ol>\n<li><strong>url</strong>:一个用来包含发送请求的URL字符串。</li>\n<li><strong>data</strong> [Object,String]类型：发送到服务器的数据。将自动转换为请求字符串格式。GET 请求中将附加在 URL 后。查看 processData 选项说明以禁止此自动转换。必须为 Key/Value 格式。如果为数组，jQuery 将自动为不同值对应同一个名称。如 {foo:[“bar1”, “bar2”]} 转换为 “&amp;foo=bar1&amp;foo=bar2”。</li>\n<li><strong>type</strong>  [String]类型：(默认: “GET”) 请求方式 (“POST” 或 “GET”)， 默认为 “GET”。注意：其它 HTTP 请求方法，如 PUT 和 DELETE 也可以使用，但仅部分浏览器支持。</li>\n<li><strong>success</strong> 当请求之后调用。传入返回后的数据，以及包含成功代码的字符串。</li>\n<li><strong>error</strong> 在请求出错时调用。传入XMLHttpRequest对象，描述错误类型的字符串以及一个异常对象（如果有的话）</li>\n</ol>\n<p>JQuery AJAX 的简单使用</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.ajax(&#123;</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"string\">&quot;get&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">url</span>: <span class=\"string\">&quot;ajax_get.php&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">data</span>: <span class=\"string\">&quot;username=John&amp;userpwd=Boston&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">success</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">xrh</span>) </span>&#123;</span><br><span class=\"line\">        alert(xrh.responseText);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">error</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        alert(<span class=\"string\">&quot;请求错误&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<hr>\n<br>\n\n<p>对原生AJAX的封装：<br>&emsp;&emsp;对元素我们需要注意的有以下几点</p>\n<ol>\n<li>对IE5 IE6的兼容</li>\n<li>AJAX在ie中的缓存问题</li>\n<li>url中的中文进行转码 地址栏中不能出现中文</li>\n<li>将传入的对象转化为字符串函数</li>\n<li>判断外界是否传入超时</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//封装对象转化为字符串函数</span></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * &quot;username&quot;:&quot;wzg&quot;</span></span><br><span class=\"line\"><span class=\"comment\"> * &quot;userpwd&quot;:&quot;123&quot;</span></span><br><span class=\"line\"><span class=\"comment\"> * &quot;t&quot;:&quot;235262345112354&quot;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">datastr</span>(<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> res = [];</span><br><span class=\"line\">    data.t = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> data) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//encodeURLComponent() 将url中的中文进行转码 地址栏中不能出现中文</span></span><br><span class=\"line\">        <span class=\"comment\">// url中只能出现字母数字下划线</span></span><br><span class=\"line\">        res.push(<span class=\"built_in\">encodeURIComponent</span>(key) + <span class=\"string\">&quot;=&quot;</span> + <span class=\"built_in\">encodeURIComponent</span>(data[key])); <span class=\"comment\">//[username = wzg,userpwd=123]</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.join(<span class=\"string\">&quot;&amp;&quot;</span>); <span class=\"comment\">//username = wzg&amp;userpwd=123</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ajax</span>(<span class=\"params\">option</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 将对象转化为字符串</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> str = datastr(option.data);</span><br><span class=\"line\">    <span class=\"comment\">//1.创建一个异步对象</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> xhr, timer;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.XMLHttpRequest) &#123; <span class=\"comment\">// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class=\"line\">        xhr = <span class=\"keyword\">new</span> XMLHttpRequest();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123; <span class=\"comment\">// code for IE6, IE5</span></span><br><span class=\"line\">        xhr = <span class=\"keyword\">new</span> ActiveXObject(<span class=\"string\">&quot;Microsoft.XMLHTTP&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 2.设置请求方式</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (option.type.toLowerCase() === <span class=\"string\">&quot;get&quot;</span>) &#123;</span><br><span class=\"line\">        xhr.open(option.type, option.url + <span class=\"string\">&quot;?&quot;</span> + str, <span class=\"literal\">true</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 3.发送请求</span></span><br><span class=\"line\">        xhr.send();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        xhr.open(option.type, option.url, <span class=\"literal\">true</span>);</span><br><span class=\"line\">        xhr.setRequestHeader(<span class=\"string\">&quot;Content-type&quot;</span>, <span class=\"string\">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class=\"line\">        xhr.send(str);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 4.监听状态的变化</span></span><br><span class=\"line\">    xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (xhr.readyState === <span class=\"number\">4</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">clearInterval</span>(timer); <span class=\"comment\">//接收到响应 就关闭定时器</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (xhr.status &gt;= <span class=\"number\">200</span> &amp;&amp; xhr.status &lt;= <span class=\"number\">300</span> ||</span><br><span class=\"line\">                xhr.status == <span class=\"number\">304</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 5.处理返回的结果</span></span><br><span class=\"line\">                option.success(xhr);</span><br><span class=\"line\">                <span class=\"comment\">//无论请求成功还是失败 都会调用option.complete();函数</span></span><br><span class=\"line\">                option.option.complete();;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                option.error(xhr);</span><br><span class=\"line\">                <span class=\"comment\">//无论请求成功还是失败 都会调用option.complete();函数</span></span><br><span class=\"line\">                option.complete();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 判断外界是否传入超时</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (option.timeout) &#123;</span><br><span class=\"line\">        timer = <span class=\"built_in\">setInterval</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            xhr.abort();     <span class=\"comment\">//终止异步请求</span></span><br><span class=\"line\">            <span class=\"built_in\">clearInterval</span>(timer);</span><br><span class=\"line\">        &#125;, option.timeout)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<br>\n对封装的AJAX的简单使用：\n\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">btn.onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">              ajax(&#123;</span><br><span class=\"line\">                  <span class=\"attr\">type</span>: <span class=\"string\">&quot;get&quot;</span>,</span><br><span class=\"line\">                  <span class=\"attr\">url</span>: <span class=\"string\">&quot;1.txt&quot;</span>,</span><br><span class=\"line\">                  <span class=\"attr\">timeout</span>: <span class=\"number\">3000</span>,</span><br><span class=\"line\">                  <span class=\"attr\">data</span>: &#123;</span><br><span class=\"line\">                      <span class=\"string\">&quot;username&quot;</span>: <span class=\"string\">&quot;wzg&quot;</span>,</span><br><span class=\"line\">                      <span class=\"string\">&quot;userpwd&quot;</span>: <span class=\"string\">&quot;123&quot;</span></span><br><span class=\"line\">                  &#125;,</span><br><span class=\"line\">                  <span class=\"attr\">success</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">xhr</span>) </span>&#123;</span><br><span class=\"line\">                      <span class=\"comment\">// console.log(xhr.responseXML);</span></span><br><span class=\"line\">                      <span class=\"comment\">// let x = xhr.responseXML</span></span><br><span class=\"line\">                      <span class=\"comment\">// console.log(x.querySelector(&quot;to&quot;).innerHTML);</span></span><br><span class=\"line\">                      <span class=\"comment\">// console.log(x.querySelector(&quot;from&quot;));</span></span><br><span class=\"line\">                      <span class=\"keyword\">let</span> x = xhr.responseText;</span><br><span class=\"line\">                      y = <span class=\"built_in\">JSON</span>.parse(x);</span><br><span class=\"line\">                      <span class=\"built_in\">console</span>.log(y.name);</span><br><span class=\"line\">                      <span class=\"built_in\">console</span>.log(y.age);</span><br><span class=\"line\">                  &#125;,</span><br><span class=\"line\">                  <span class=\"attr\">error</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">xhr</span>) </span>&#123;</span><br><span class=\"line\">                      alert(<span class=\"string\">&quot;请求失败！！！&quot;</span>);</span><br><span class=\"line\">                  &#125;</span><br><span class=\"line\">              &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n","more":"<h1 id=\"对原生AJAX-的简单封装-wink\"><a href=\"#对原生AJAX-的简单封装-wink\" class=\"headerlink\" title=\"对原生AJAX 的简单封装:wink:\"></a>对原生AJAX 的简单封装:wink:</h1><p>我们先看一下JQuery的AJAX的使用。<br>jQuery.ajax(url,[settings])</p>\n<p>参数：</p>\n<ol>\n<li><strong>url</strong>:一个用来包含发送请求的URL字符串。</li>\n<li><strong>data</strong> [Object,String]类型：发送到服务器的数据。将自动转换为请求字符串格式。GET 请求中将附加在 URL 后。查看 processData 选项说明以禁止此自动转换。必须为 Key/Value 格式。如果为数组，jQuery 将自动为不同值对应同一个名称。如 {foo:[“bar1”, “bar2”]} 转换为 “&amp;foo=bar1&amp;foo=bar2”。</li>\n<li><strong>type</strong>  [String]类型：(默认: “GET”) 请求方式 (“POST” 或 “GET”)， 默认为 “GET”。注意：其它 HTTP 请求方法，如 PUT 和 DELETE 也可以使用，但仅部分浏览器支持。</li>\n<li><strong>success</strong> 当请求之后调用。传入返回后的数据，以及包含成功代码的字符串。</li>\n<li><strong>error</strong> 在请求出错时调用。传入XMLHttpRequest对象，描述错误类型的字符串以及一个异常对象（如果有的话）</li>\n</ol>\n<p>JQuery AJAX 的简单使用</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">$.ajax(&#123;</span><br><span class=\"line\">    <span class=\"attr\">type</span>: <span class=\"string\">&quot;get&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">url</span>: <span class=\"string\">&quot;ajax_get.php&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">data</span>: <span class=\"string\">&quot;username=John&amp;userpwd=Boston&quot;</span>,</span><br><span class=\"line\">    <span class=\"attr\">success</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">xrh</span>) </span>&#123;</span><br><span class=\"line\">        alert(xrh.responseText);</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">error</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        alert(<span class=\"string\">&quot;请求错误&quot;</span>)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;);</span><br></pre></td></tr></table></figure>\n\n<hr>\n<br>\n\n<p>对原生AJAX的封装：<br>&emsp;&emsp;对元素我们需要注意的有以下几点</p>\n<ol>\n<li>对IE5 IE6的兼容</li>\n<li>AJAX在ie中的缓存问题</li>\n<li>url中的中文进行转码 地址栏中不能出现中文</li>\n<li>将传入的对象转化为字符串函数</li>\n<li>判断外界是否传入超时</li>\n</ol>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//封装对象转化为字符串函数</span></span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * </span></span><br><span class=\"line\"><span class=\"comment\"> * &quot;username&quot;:&quot;wzg&quot;</span></span><br><span class=\"line\"><span class=\"comment\"> * &quot;userpwd&quot;:&quot;123&quot;</span></span><br><span class=\"line\"><span class=\"comment\"> * &quot;t&quot;:&quot;235262345112354&quot;</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">datastr</span>(<span class=\"params\">data</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> res = [];</span><br><span class=\"line\">    data.t = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime();</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> key <span class=\"keyword\">in</span> data) &#123;</span><br><span class=\"line\">        <span class=\"comment\">//encodeURLComponent() 将url中的中文进行转码 地址栏中不能出现中文</span></span><br><span class=\"line\">        <span class=\"comment\">// url中只能出现字母数字下划线</span></span><br><span class=\"line\">        res.push(<span class=\"built_in\">encodeURIComponent</span>(key) + <span class=\"string\">&quot;=&quot;</span> + <span class=\"built_in\">encodeURIComponent</span>(data[key])); <span class=\"comment\">//[username = wzg,userpwd=123]</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> res.join(<span class=\"string\">&quot;&amp;&quot;</span>); <span class=\"comment\">//username = wzg&amp;userpwd=123</span></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">ajax</span>(<span class=\"params\">option</span>) </span>&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 将对象转化为字符串</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> str = datastr(option.data);</span><br><span class=\"line\">    <span class=\"comment\">//1.创建一个异步对象</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> xhr, timer;</span><br><span class=\"line\">    <span class=\"keyword\">if</span> (<span class=\"built_in\">window</span>.XMLHttpRequest) &#123; <span class=\"comment\">// code for IE7+, Firefox, Chrome, Opera, Safari</span></span><br><span class=\"line\">        xhr = <span class=\"keyword\">new</span> XMLHttpRequest();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123; <span class=\"comment\">// code for IE6, IE5</span></span><br><span class=\"line\">        xhr = <span class=\"keyword\">new</span> ActiveXObject(<span class=\"string\">&quot;Microsoft.XMLHTTP&quot;</span>);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"comment\">// 2.设置请求方式</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (option.type.toLowerCase() === <span class=\"string\">&quot;get&quot;</span>) &#123;</span><br><span class=\"line\">        xhr.open(option.type, option.url + <span class=\"string\">&quot;?&quot;</span> + str, <span class=\"literal\">true</span>);</span><br><span class=\"line\">        <span class=\"comment\">// 3.发送请求</span></span><br><span class=\"line\">        xhr.send();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">        xhr.open(option.type, option.url, <span class=\"literal\">true</span>);</span><br><span class=\"line\">        xhr.setRequestHeader(<span class=\"string\">&quot;Content-type&quot;</span>, <span class=\"string\">&quot;application/x-www-form-urlencoded&quot;</span>);</span><br><span class=\"line\">        xhr.send(str);</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 4.监听状态的变化</span></span><br><span class=\"line\">    xhr.onreadystatechange = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (xhr.readyState === <span class=\"number\">4</span>) &#123;</span><br><span class=\"line\">            <span class=\"built_in\">clearInterval</span>(timer); <span class=\"comment\">//接收到响应 就关闭定时器</span></span><br><span class=\"line\">            <span class=\"keyword\">if</span> (xhr.status &gt;= <span class=\"number\">200</span> &amp;&amp; xhr.status &lt;= <span class=\"number\">300</span> ||</span><br><span class=\"line\">                xhr.status == <span class=\"number\">304</span>) &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 5.处理返回的结果</span></span><br><span class=\"line\">                option.success(xhr);</span><br><span class=\"line\">                <span class=\"comment\">//无论请求成功还是失败 都会调用option.complete();函数</span></span><br><span class=\"line\">                option.option.complete();;</span><br><span class=\"line\">            &#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">                option.error(xhr);</span><br><span class=\"line\">                <span class=\"comment\">//无论请求成功还是失败 都会调用option.complete();函数</span></span><br><span class=\"line\">                option.complete();</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"comment\">// 判断外界是否传入超时</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (option.timeout) &#123;</span><br><span class=\"line\">        timer = <span class=\"built_in\">setInterval</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            xhr.abort();     <span class=\"comment\">//终止异步请求</span></span><br><span class=\"line\">            <span class=\"built_in\">clearInterval</span>(timer);</span><br><span class=\"line\">        &#125;, option.timeout)</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<br>\n对封装的AJAX的简单使用：\n\n\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">btn.onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">              ajax(&#123;</span><br><span class=\"line\">                  <span class=\"attr\">type</span>: <span class=\"string\">&quot;get&quot;</span>,</span><br><span class=\"line\">                  <span class=\"attr\">url</span>: <span class=\"string\">&quot;1.txt&quot;</span>,</span><br><span class=\"line\">                  <span class=\"attr\">timeout</span>: <span class=\"number\">3000</span>,</span><br><span class=\"line\">                  <span class=\"attr\">data</span>: &#123;</span><br><span class=\"line\">                      <span class=\"string\">&quot;username&quot;</span>: <span class=\"string\">&quot;wzg&quot;</span>,</span><br><span class=\"line\">                      <span class=\"string\">&quot;userpwd&quot;</span>: <span class=\"string\">&quot;123&quot;</span></span><br><span class=\"line\">                  &#125;,</span><br><span class=\"line\">                  <span class=\"attr\">success</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">xhr</span>) </span>&#123;</span><br><span class=\"line\">                      <span class=\"comment\">// console.log(xhr.responseXML);</span></span><br><span class=\"line\">                      <span class=\"comment\">// let x = xhr.responseXML</span></span><br><span class=\"line\">                      <span class=\"comment\">// console.log(x.querySelector(&quot;to&quot;).innerHTML);</span></span><br><span class=\"line\">                      <span class=\"comment\">// console.log(x.querySelector(&quot;from&quot;));</span></span><br><span class=\"line\">                      <span class=\"keyword\">let</span> x = xhr.responseText;</span><br><span class=\"line\">                      y = <span class=\"built_in\">JSON</span>.parse(x);</span><br><span class=\"line\">                      <span class=\"built_in\">console</span>.log(y.name);</span><br><span class=\"line\">                      <span class=\"built_in\">console</span>.log(y.age);</span><br><span class=\"line\">                  &#125;,</span><br><span class=\"line\">                  <span class=\"attr\">error</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">xhr</span>) </span>&#123;</span><br><span class=\"line\">                      alert(<span class=\"string\">&quot;请求失败！！！&quot;</span>);</span><br><span class=\"line\">                  &#125;</span><br><span class=\"line\">              &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","categories":[{"name":"AJAX","path":"api/categories/AJAX.json"}],"tags":[{"name":"AJAX","path":"api/tags/AJAX.json"},{"name":"JavaScript","path":"api/tags/JavaScript.json"}]}