{"title":"React hook中useState数组对象更新机制","slug":"253","date":"2022-11-28T12:24:49.000Z","updated":"2022-11-28T12:32:49.238Z","comments":true,"path":"api/articles/253.json","excerpt":null,"covers":null,"content":"<p>react组件的更新机制只对数组进行的一个浅对比，也就是说没有改变它的引用地址，所以我们要改变数组时应该进行一次拷贝。</p>\n<p>当数组和对象只有一级时，展开运算符和一些库函数复制方法都是深拷贝</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> arrCopy = arr.slice();</span><br><span class=\"line\"><span class=\"keyword\">const</span> objCopy = <span class=\"built_in\">Object</span>.assign(&#123;&#125;,obj)</span><br></pre></td></tr></table></figure>\n\n<p><strong>数组中使用：</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; useEffect, useState &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> App = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [arr, setArr] = useState([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [value, setValue] = useState();</span><br><span class=\"line\">  <span class=\"keyword\">const</span> change = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// setArr((pre) =&gt; &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//   if (pre.length == 0) return [];</span></span><br><span class=\"line\">    <span class=\"comment\">//   pre[0] = 100;</span></span><br><span class=\"line\">    <span class=\"comment\">//   let newArr = pre.slice();</span></span><br><span class=\"line\">    <span class=\"comment\">//   return newArr;</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;)</span></span><br><span class=\"line\">    arr[<span class=\"number\">0</span>] = <span class=\"number\">100</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> newArr = arr.slice();</span><br><span class=\"line\">    setArr(newArr);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> deleteItem = <span class=\"function\">(<span class=\"params\">index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    setArr(<span class=\"function\">(<span class=\"params\">pre</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      pre.splice(index, <span class=\"number\">1</span>);</span><br><span class=\"line\">      <span class=\"keyword\">let</span> newArr = pre.slice();</span><br><span class=\"line\">      <span class=\"keyword\">return</span> newArr;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(arr);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> addItem = <span class=\"function\">(<span class=\"params\">num</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> inputDom = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;inputId&#x27;</span>);</span><br><span class=\"line\">    setArr(<span class=\"function\">(<span class=\"params\">pre</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      pre.push(inputDom.value);</span><br><span class=\"line\">      <span class=\"keyword\">let</span> newArr = pre.slice();</span><br><span class=\"line\">      <span class=\"keyword\">return</span> newArr;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(arr);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> arr1 = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> arr2 = arr1.slice();</span><br><span class=\"line\">  arr2.splice(<span class=\"number\">0</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(arr1, arr2);<span class=\"comment\">// 可以发现修改拷贝之后的arr2并不影响arr1</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;change&#125;</span>&gt;</span>change<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">value</span>=<span class=\"string\">&#123;value&#125;</span> <span class=\"attr\">id</span>=<span class=\"string\">&#x27;inputId&#x27;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">input</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> addItem(value)&#125;&gt;add<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        &#123;</span></span><br><span class=\"line\"><span class=\"xml\">          arr.map((item, index) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"xml\">            return (</span></span><br><span class=\"line\"><span class=\"xml\">              <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;item&#125;&#123;index&#125; <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> deleteItem(index)&#125;&gt;delete<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">            )</span></span><br><span class=\"line\"><span class=\"xml\">          &#125;)</span></span><br><span class=\"line\"><span class=\"xml\">        &#125;</span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App;</span><br></pre></td></tr></table></figure>\n\n<p><strong>对象中使用</strong>：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> [obj,setObj]=useState(&#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>:<span class=\"string\">&#x27;xiaowang&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">age</span>:<span class=\"string\">&#x27;10&#x27;</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 更新值</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> newObj = &#123;...obj,age=<span class=\"string\">&#x27;18&#x27;</span>&#125;</span><br><span class=\"line\">setObj(newObj);</span><br></pre></td></tr></table></figure>\n\n","more":"<p>react组件的更新机制只对数组进行的一个浅对比，也就是说没有改变它的引用地址，所以我们要改变数组时应该进行一次拷贝。</p>\n<p>当数组和对象只有一级时，展开运算符和一些库函数复制方法都是深拷贝</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> arrCopy = arr.slice();</span><br><span class=\"line\"><span class=\"keyword\">const</span> objCopy = <span class=\"built_in\">Object</span>.assign(&#123;&#125;,obj)</span><br></pre></td></tr></table></figure>\n\n<p><strong>数组中使用：</strong></p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> React, &#123; useEffect, useState &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;react&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> App = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [arr, setArr] = useState([<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>]);</span><br><span class=\"line\">  <span class=\"keyword\">const</span> [value, setValue] = useState();</span><br><span class=\"line\">  <span class=\"keyword\">const</span> change = <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"comment\">// setArr((pre) =&gt; &#123;</span></span><br><span class=\"line\">    <span class=\"comment\">//   if (pre.length == 0) return [];</span></span><br><span class=\"line\">    <span class=\"comment\">//   pre[0] = 100;</span></span><br><span class=\"line\">    <span class=\"comment\">//   let newArr = pre.slice();</span></span><br><span class=\"line\">    <span class=\"comment\">//   return newArr;</span></span><br><span class=\"line\">    <span class=\"comment\">// &#125;)</span></span><br><span class=\"line\">    arr[<span class=\"number\">0</span>] = <span class=\"number\">100</span>;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> newArr = arr.slice();</span><br><span class=\"line\">    setArr(newArr);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> deleteItem = <span class=\"function\">(<span class=\"params\">index</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    setArr(<span class=\"function\">(<span class=\"params\">pre</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      pre.splice(index, <span class=\"number\">1</span>);</span><br><span class=\"line\">      <span class=\"keyword\">let</span> newArr = pre.slice();</span><br><span class=\"line\">      <span class=\"keyword\">return</span> newArr;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(arr);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">const</span> addItem = <span class=\"function\">(<span class=\"params\">num</span>) =&gt;</span> &#123;</span><br><span class=\"line\">    <span class=\"keyword\">let</span> inputDom = <span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;inputId&#x27;</span>);</span><br><span class=\"line\">    setArr(<span class=\"function\">(<span class=\"params\">pre</span>) =&gt;</span> &#123;</span><br><span class=\"line\">      pre.push(inputDom.value);</span><br><span class=\"line\">      <span class=\"keyword\">let</span> newArr = pre.slice();</span><br><span class=\"line\">      <span class=\"keyword\">return</span> newArr;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(arr);</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"keyword\">let</span> arr1 = [<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>];</span><br><span class=\"line\">  <span class=\"keyword\">let</span> arr2 = arr1.slice();</span><br><span class=\"line\">  arr2.splice(<span class=\"number\">0</span>, <span class=\"number\">1</span>);</span><br><span class=\"line\">  <span class=\"built_in\">console</span>.log(arr1, arr2);<span class=\"comment\">// 可以发现修改拷贝之后的arr2并不影响arr1</span></span><br><span class=\"line\">  <span class=\"keyword\">return</span> (</span><br><span class=\"line\">    <span class=\"xml\"><span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;change&#125;</span>&gt;</span>change<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;<span class=\"name\">input</span> <span class=\"attr\">value</span>=<span class=\"string\">&#123;value&#125;</span> <span class=\"attr\">id</span>=<span class=\"string\">&#x27;inputId&#x27;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">input</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> addItem(value)&#125;&gt;add<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">        &#123;</span></span><br><span class=\"line\"><span class=\"xml\">          arr.map((item, index) =&gt; &#123;</span></span><br><span class=\"line\"><span class=\"xml\">            return (</span></span><br><span class=\"line\"><span class=\"xml\">              <span class=\"tag\">&lt;<span class=\"name\">div</span>&gt;</span>&#123;item&#125;&#123;index&#125; <span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">onClick</span>=<span class=\"string\">&#123;()</span> =&gt;</span> deleteItem(index)&#125;&gt;delete<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">            )</span></span><br><span class=\"line\"><span class=\"xml\">          &#125;)</span></span><br><span class=\"line\"><span class=\"xml\">        &#125;</span></span><br><span class=\"line\"><span class=\"xml\">      <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\"><span class=\"xml\">    <span class=\"tag\">&lt;/<span class=\"name\">div</span>&gt;</span></span></span><br><span class=\"line\">  )</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"keyword\">default</span> App;</span><br></pre></td></tr></table></figure>\n\n<p><strong>对象中使用</strong>：</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> [obj,setObj]=useState(&#123;</span><br><span class=\"line\">  <span class=\"attr\">name</span>:<span class=\"string\">&#x27;xiaowang&#x27;</span></span><br><span class=\"line\">  <span class=\"attr\">age</span>:<span class=\"string\">&#x27;10&#x27;</span>;</span><br><span class=\"line\">&#125;);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 更新值</span></span><br><span class=\"line\"><span class=\"keyword\">let</span> newObj = &#123;...obj,age=<span class=\"string\">&#x27;18&#x27;</span>&#125;</span><br><span class=\"line\">setObj(newObj);</span><br></pre></td></tr></table></figure>\n\n","categories":[{"name":"React","path":"api/categories/React.json"}],"tags":[{"name":"React","path":"api/tags/React.json"}]}