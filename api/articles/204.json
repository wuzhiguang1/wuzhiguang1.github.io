{"title":"微信小程序录制视频方法","slug":"204","date":"2022-07-03T06:51:44.000Z","updated":"2022-07-21T08:46:00.617Z","comments":true,"path":"api/articles/204.json","excerpt":null,"covers":["https://s2.loli.net/2022/07/01/MDfFdLcJVzCnYqs.jpg","https://s2.loli.net/2022/07/01/8zuTdCMvVf2jlkw.jpg","https://s2.loli.net/2022/07/01/o3Sl1FvpPmjZLdk.jpg","https://s2.loli.net/2022/07/01/1pWhtlGokIY8au9.jpg","https://s2.loli.net/2022/07/01/VbaWYG4JgSij7N1.jpg","https://s2.loli.net/2022/07/01/IB4Lq1nrEuZRYFA.jpg"],"content":"<p>方法一：使用wx.chooseVideo，wx.chooseVideo是微信官方提供的接口，不需要用户授权，可直接调用返回拍摄完的视频地址。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wx.chooseVideo(&#123;</span><br><span class=\"line\">  <span class=\"attr\">sourceType</span>: [<span class=\"string\">&#x27;camera&#x27;</span>],</span><br><span class=\"line\">  <span class=\"attr\">maxDuration</span>: <span class=\"number\">60</span>,</span><br><span class=\"line\">  <span class=\"attr\">camera</span>: <span class=\"string\">&#x27;back&#x27;</span>,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">success</span>(<span class=\"params\">res</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res.tempFilePath)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>方法二：<strong>使用wx.createCameraContext()，自己定义录制方法</strong></p>\n<p><strong>注意点：<br>1.使用该方法需要用户授权摄像头权限和麦克风权限，需要对未授权时的情况进行处理<br>2.startRecord和stopRecord方法注意调用时机，都不可连续调用，需要对用户连续点击的行为做处理</strong></p>\n<p>代码如下：</p>\n<p>index.wxml</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;video&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">video</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">&quot;&#123;&#123;video&#125;&#125;&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&#123;&#123;video&#125;&#125;&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;width: 100%;display: block;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">video</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;primary&quot;</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;checkSetting&quot;</span>&gt;</span>录制视频demo<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>index.js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> app = getApp()</span><br><span class=\"line\">Page(&#123;</span><br><span class=\"line\">\t<span class=\"attr\">data</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">video</span>:<span class=\"literal\">null</span></span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"attr\">onLoad</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">options</span>) </span>&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">onShow</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t * 每次进入页面判断本地是否存在录制视频地址，有则取，取完清除</span></span><br><span class=\"line\"><span class=\"comment\">\t\t */</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (wx.getStorageSync(<span class=\"string\">&#x27;auth_video&#x27;</span>)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">video</span>: wx.getStorageSync(<span class=\"string\">&#x27;auth_video&#x27;</span>)</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t\twx.removeStorageSync(<span class=\"string\">&#x27;auth_video&#x27;</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * 由于录像页面使用了camera标签，使用该标签时需要获取摄像头权限，否则无法捕捉画面</span></span><br><span class=\"line\"><span class=\"comment\">\t * 所以每次进入页面时先进行检验用户是否授权摄像头权限</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">checkSetting</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\twx.getSetting(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> authSetting = res.authSetting</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t * authSetting.hasOwnProperty(&#x27;scope.camera&#x27;)==true 说明用户不是首次授权</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t * authSetting[&#x27;scope.camera&#x27;]==false 说明用户未允许授权</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t * 只有当两个条件同时满足时需要提示用户开启授权</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t */</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (authSetting.hasOwnProperty(<span class=\"string\">&#x27;scope.camera&#x27;</span>) &amp;&amp; !authSetting[<span class=\"string\">&#x27;scope.camera&#x27;</span>]) &#123;</span><br><span class=\"line\">\t\t\t\t\twx.showModal(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">content</span>: <span class=\"string\">&#x27;检测到您当前未开启摄像头权限，将无法使用相机功能&#x27;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">confirmText</span>: <span class=\"string\">&#x27;去开启&#x27;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">if</span> (res.confirm) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;用户点击确定&#x27;</span>)</span><br><span class=\"line\">\t\t\t\t\t\t\t\twx.openSetting(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"function\"><span class=\"title\">success</span>(<span class=\"params\">res</span>)</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t<span class=\"built_in\">console</span>.log(res.authSetting)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t&#125;);</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (res.cancel) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;用户点击取消&#x27;</span>)</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\twx.navigateTo(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">url</span>:<span class=\"string\">&quot;../camera/camera&quot;</span></span><br><span class=\"line\">\t\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>camera.wxml</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;video&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">&quot;&#123;&#123;!video_url&#125;&#125;&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;position: relative;&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;time-container&quot;</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">&quot;&#123;&#123;isRecording&#125;&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;time&quot;</span>&gt;</span>正在录制 &#123;&#123;time&#125;&#125;s<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;change-btn&quot;</span> <span class=\"attr\">wx:else</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;changePosition&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span>&gt;</span>点击切换&#123;&#123;devicePosition==&#x27;front&#x27;?&#x27;后置&#x27;:&#x27;前置&#x27;&#125;&#125;摄像头<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">camera</span> <span class=\"attr\">binderror</span>=<span class=\"string\">&quot;getError&quot;</span> <span class=\"attr\">device-position</span>=<span class=\"string\">&quot;&#123;&#123;devicePosition&#125;&#125;&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;width: 100vw;height: 100vh;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">camera</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn-container&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn-item&quot;</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;back&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;background-color: #ddd;&quot;</span>&gt;</span>返回<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn-item&quot;</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;record&quot;</span>&gt;</span>&#123;&#123;isRecording?&#x27;结束录制&#x27;:&#x27;点击录制&#x27;&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:else</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;position: fixed;width: 100vw;height: 100vh;&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">video</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&#123;&#123;video_url&#125;&#125;&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;width: 100%;height: 100%;&quot;</span> <span class=\"attr\">autoplay</span>=<span class=\"string\">&quot;&#123;&#123;true&#125;&#125;&quot;</span> <span class=\"attr\">loop</span>=<span class=\"string\">&quot;&#123;&#123;true&#125;&#125;&quot;</span> <span class=\"attr\">controls</span>=<span class=\"string\">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">video</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn-container&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn-item&quot;</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;recordAgain&quot;</span>&gt;</span>重新录制<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn-item&quot;</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;sureVideo&quot;</span>&gt;</span>确认选择<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>camera.wxss</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.time-container</span>&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">\t<span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">left</span>:<span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">height</span>: <span class=\"number\">240</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">\t<span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">\t<span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">\t<span class=\"attribute\">background-color</span>: <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.4</span>);</span><br><span class=\"line\">\t<span class=\"attribute\">z-index</span>: <span class=\"number\">100</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.change-btn</span>&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">\t<span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">transform</span>: <span class=\"built_in\">translate</span>(-<span class=\"number\">50%</span>,-<span class=\"number\">50%</span>);</span><br><span class=\"line\">\t<span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">\t<span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">\t<span class=\"attribute\">height</span>: <span class=\"number\">100</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">font-size</span>: <span class=\"number\">30</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">padding</span>: <span class=\"number\">0</span> <span class=\"number\">50</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">border-radius</span>: <span class=\"number\">50</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">z-index</span>: <span class=\"number\">100</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">background-color</span>: <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.time</span>&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">font-size</span>: <span class=\"number\">30</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">color</span>: red;</span><br><span class=\"line\">\t<span class=\"attribute\">padding</span>: <span class=\"number\">0</span> <span class=\"number\">20</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">margin-top</span>: <span class=\"number\">30</span>rpx;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.btn-container</span>&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">\t<span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">padding</span>: <span class=\"number\">0</span> <span class=\"number\">80</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">box-sizing</span>: border-box;</span><br><span class=\"line\">\t<span class=\"attribute\">bottom</span>: <span class=\"number\">160</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">\t<span class=\"attribute\">justify-content</span>: space-between;</span><br><span class=\"line\">\t<span class=\"attribute\">z-index</span>: <span class=\"number\">100</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.btn-item</span>&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">padding</span>: <span class=\"number\">30</span>rpx <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">border-radius</span>: <span class=\"number\">45</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">background-color</span>: <span class=\"number\">#FF6685</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">font-size</span>: <span class=\"number\">32</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">\t<span class=\"attribute\">width</span>: <span class=\"number\">240</span>rpx;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>camera.js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> app = getApp()</span><br><span class=\"line\">Page(&#123;</span><br><span class=\"line\">\t<span class=\"attr\">data</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">ctx</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">isRecording</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">video_url</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">time</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">min_time</span>:<span class=\"number\">5</span>,\t<span class=\"comment\">//录制视频最小时长</span></span><br><span class=\"line\">\t\t<span class=\"attr\">timer</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">devicePosition</span>: <span class=\"string\">&quot;back&quot;</span>, <span class=\"comment\">//摄像头朝向</span></span><br><span class=\"line\">\t\t<span class=\"attr\">isStart</span>:<span class=\"literal\">false</span>, <span class=\"comment\">//记录用户点击开始录制的状态</span></span><br><span class=\"line\">\t\t<span class=\"attr\">isStop</span>:<span class=\"literal\">false</span> <span class=\"comment\">//记录用户点击结束录制的状态</span></span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">onLoad</span>(<span class=\"params\">options</span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> ctx = wx.createCameraContext()</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">\t\t\tctx</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">onUnload</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">clearInterval</span>(<span class=\"built_in\">this</span>.data.timer)</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">//切换前置/后置摄像头</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">changePosition</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">devicePosition</span>: <span class=\"built_in\">this</span>.data.devicePosition == <span class=\"string\">&#x27;back&#x27;</span> ? <span class=\"string\">&#x27;front&#x27;</span> : <span class=\"string\">&#x27;back&#x27;</span></span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">checkSetting</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//这里定义一个状态isStart来记录用户点击开始录制行为，待startRecord接口请求成功后还原状态</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.data.isStart)&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.data.isStart = <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t * 调用wx.createCameraContext().startRecord()方法需要获取用户麦克风权限，否则无法调用且无法录制视频</span></span><br><span class=\"line\"><span class=\"comment\">\t\t * 所以每次进入页面时先进行检验用户是否授权麦克风权限</span></span><br><span class=\"line\"><span class=\"comment\">\t\t */</span></span><br><span class=\"line\">\t\twx.getSetting(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> authSetting = res.authSetting</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t * 原理同检测摄像头权限</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t */</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (authSetting.hasOwnProperty(<span class=\"string\">&#x27;scope.record&#x27;</span>) &amp;&amp; !authSetting[<span class=\"string\">&#x27;scope.record&#x27;</span>]) &#123;</span><br><span class=\"line\">\t\t\t\t\twx.showModal(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">content</span>: <span class=\"string\">&#x27;检测到您当前未开启麦克风权限，将无法录制视频&#x27;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">confirmText</span>: <span class=\"string\">&#x27;去开启&#x27;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">if</span> (res.confirm) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;用户点击确定&#x27;</span>)</span><br><span class=\"line\">\t\t\t\t\t\t\t\twx.openSetting(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"function\"><span class=\"title\">success</span>(<span class=\"params\">res</span>)</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t<span class=\"built_in\">console</span>.log(res.authSetting)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t&#125;);</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (res.cancel) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;用户点击取消&#x27;</span>)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"comment\">// this.back()</span></span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">this</span>.startRecord()</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">//用户进入页面授权时点击不允许授权时触发该方法，且不允许授权后每次进入页面都会直接触发</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">getError</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;用户未授权使用摄像头&quot;</span>)</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.back()</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">//点击开始录制/结束录制</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">record</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.data.isRecording) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;结束录制视频&quot;</span>)</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">this</span>.stopRecord()</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;开始录制视频&quot;</span>)</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">this</span>.checkSetting()</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">//开始录制</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">startRecord</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.data.ctx.startRecord(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">timeoutCallback</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t * 微信官方限制</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t * 使用该方法录制视频最多录制30s，30s后自动停止录制</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t * 停止录制计时</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t */</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;30秒时间结束，自动停止录制&quot;</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">clearInterval</span>(<span class=\"built_in\">this</span>.data.timer)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">video_url</span>: res.tempVideoPath,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">isRecording</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">this</span>.timing()</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">isRecording</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">this</span>.data.isStart = <span class=\"literal\">false</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">fail</span>:<span class=\"function\">(<span class=\"params\">err</span>)=&gt;</span>&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log(err)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">this</span>.data.isStart = <span class=\"literal\">false</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">//结束录制</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">stopRecord</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//stopRecord方法不可连续调用，否则无法停止录制</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//这里定义一个状态isStop来记录用户点击结束录制行为，待stopRecord接口请求成功后还原状态</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.data.isStop)&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.data.time&lt;<span class=\"built_in\">this</span>.data.min_time)&#123;</span><br><span class=\"line\">\t\t\twx.showToast(&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">title</span>:<span class=\"string\">&quot;视频时长小于&quot;</span>+<span class=\"built_in\">this</span>.data.min_time+<span class=\"string\">&quot;秒&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">icon</span>:<span class=\"string\">&quot;none&quot;</span></span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\twx.showLoading(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">title</span>:<span class=\"string\">&quot;请稍候&quot;</span></span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.data.isStop = <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.data.ctx.stopRecord(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//compressed: false,  //是否压缩录完的视频</span></span><br><span class=\"line\">\t\t\t<span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">clearInterval</span>(<span class=\"built_in\">this</span>.data.timer)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">video_url</span>: res.tempVideoPath,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">isRecording</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">this</span>.data.isStop = <span class=\"literal\">false</span></span><br><span class=\"line\">\t\t\t\twx.hideLoading()</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"function\"><span class=\"title\">fail</span>(<span class=\"params\">err</span>)</span>&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log(err)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">this</span>.data.isStop = <span class=\"literal\">false</span></span><br><span class=\"line\">\t\t\t\twx.hideLoading()</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">//计时</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">timing</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">let</span> time = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//每次计时前先将页面上的时间重置为0</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">\t\t\ttime</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t\t<span class=\"keyword\">let</span> self = <span class=\"built_in\">this</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">let</span> timer = <span class=\"built_in\">setInterval</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t\t\ttime++</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">console</span>.log(time)</span><br><span class=\"line\">\t\t\tself.setData(&#123;</span><br><span class=\"line\">\t\t\t\ttime</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">\t\t\ttimer</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">//重新录制</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">recordAgain</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">video_url</span>: <span class=\"literal\">null</span></span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">//返回上一页</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">back</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\twx.navigateBack()</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">//确认选择</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">sureVideo</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t * 将录完的视频地址保存本地，返回上一页时在onShow里面判断本地是否存在录制视频的地址</span></span><br><span class=\"line\"><span class=\"comment\">\t\t */</span></span><br><span class=\"line\">\t\twx.setStorageSync(<span class=\"string\">&#x27;auth_video&#x27;</span>, <span class=\"built_in\">this</span>.data.video_url)</span><br><span class=\"line\">\t\twx.navigateBack()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://s2.loli.net/2022/07/01/MDfFdLcJVzCnYqs.jpg\"></p>\n<p><img src=\"https://s2.loli.net/2022/07/01/8zuTdCMvVf2jlkw.jpg\"></p>\n<p><img src=\"https://s2.loli.net/2022/07/01/o3Sl1FvpPmjZLdk.jpg\"></p>\n<p><img src=\"https://s2.loli.net/2022/07/01/1pWhtlGokIY8au9.jpg\"></p>\n<p><img src=\"https://s2.loli.net/2022/07/01/VbaWYG4JgSij7N1.jpg\"></p>\n<p><img src=\"https://s2.loli.net/2022/07/01/IB4Lq1nrEuZRYFA.jpg\"></p>\n","more":"<p>方法一：使用wx.chooseVideo，wx.chooseVideo是微信官方提供的接口，不需要用户授权，可直接调用返回拍摄完的视频地址。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">wx.chooseVideo(&#123;</span><br><span class=\"line\">  <span class=\"attr\">sourceType</span>: [<span class=\"string\">&#x27;camera&#x27;</span>],</span><br><span class=\"line\">  <span class=\"attr\">maxDuration</span>: <span class=\"number\">60</span>,</span><br><span class=\"line\">  <span class=\"attr\">camera</span>: <span class=\"string\">&#x27;back&#x27;</span>,</span><br><span class=\"line\">  <span class=\"function\"><span class=\"title\">success</span>(<span class=\"params\">res</span>)</span> &#123;</span><br><span class=\"line\">    <span class=\"built_in\">console</span>.log(res.tempFilePath)</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>方法二：<strong>使用wx.createCameraContext()，自己定义录制方法</strong></p>\n<p><strong>注意点：<br>1.使用该方法需要用户授权摄像头权限和麦克风权限，需要对未授权时的情况进行处理<br>2.startRecord和stopRecord方法注意调用时机，都不可连续调用，需要对用户连续点击的行为做处理</strong></p>\n<p>代码如下：</p>\n<p>index.wxml</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;video&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">video</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">&quot;&#123;&#123;video&#125;&#125;&quot;</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&#123;&#123;video&#125;&#125;&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;width: 100%;display: block;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">video</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">button</span> <span class=\"attr\">type</span>=<span class=\"string\">&quot;primary&quot;</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;checkSetting&quot;</span>&gt;</span>录制视频demo<span class=\"tag\">&lt;/<span class=\"name\">button</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>index.js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> app = getApp()</span><br><span class=\"line\">Page(&#123;</span><br><span class=\"line\">\t<span class=\"attr\">data</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">video</span>:<span class=\"literal\">null</span></span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"attr\">onLoad</span>: <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\">options</span>) </span>&#123;</span><br><span class=\"line\">\t\t</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">onShow</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t * 每次进入页面判断本地是否存在录制视频地址，有则取，取完清除</span></span><br><span class=\"line\"><span class=\"comment\">\t\t */</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (wx.getStorageSync(<span class=\"string\">&#x27;auth_video&#x27;</span>)) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">video</span>: wx.getStorageSync(<span class=\"string\">&#x27;auth_video&#x27;</span>)</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t\twx.removeStorageSync(<span class=\"string\">&#x27;auth_video&#x27;</span>)</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t * 由于录像页面使用了camera标签，使用该标签时需要获取摄像头权限，否则无法捕捉画面</span></span><br><span class=\"line\"><span class=\"comment\">\t * 所以每次进入页面时先进行检验用户是否授权摄像头权限</span></span><br><span class=\"line\"><span class=\"comment\">\t */</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">checkSetting</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\twx.getSetting(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> authSetting = res.authSetting</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t * authSetting.hasOwnProperty(&#x27;scope.camera&#x27;)==true 说明用户不是首次授权</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t * authSetting[&#x27;scope.camera&#x27;]==false 说明用户未允许授权</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t * 只有当两个条件同时满足时需要提示用户开启授权</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t */</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (authSetting.hasOwnProperty(<span class=\"string\">&#x27;scope.camera&#x27;</span>) &amp;&amp; !authSetting[<span class=\"string\">&#x27;scope.camera&#x27;</span>]) &#123;</span><br><span class=\"line\">\t\t\t\t\twx.showModal(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">content</span>: <span class=\"string\">&#x27;检测到您当前未开启摄像头权限，将无法使用相机功能&#x27;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">confirmText</span>: <span class=\"string\">&#x27;去开启&#x27;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">if</span> (res.confirm) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;用户点击确定&#x27;</span>)</span><br><span class=\"line\">\t\t\t\t\t\t\t\twx.openSetting(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"function\"><span class=\"title\">success</span>(<span class=\"params\">res</span>)</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t<span class=\"built_in\">console</span>.log(res.authSetting)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t&#125;);</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (res.cancel) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;用户点击取消&#x27;</span>)</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\twx.navigateTo(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">url</span>:<span class=\"string\">&quot;../camera/camera&quot;</span></span><br><span class=\"line\">\t\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p>camera.wxml</p>\n<figure class=\"highlight html\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;video&quot;</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">&quot;&#123;&#123;!video_url&#125;&#125;&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;position: relative;&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;time-container&quot;</span> <span class=\"attr\">wx:if</span>=<span class=\"string\">&quot;&#123;&#123;isRecording&#125;&#125;&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;time&quot;</span>&gt;</span>正在录制 &#123;&#123;time&#125;&#125;s<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;change-btn&quot;</span> <span class=\"attr\">wx:else</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;changePosition&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span>&gt;</span>点击切换&#123;&#123;devicePosition==&#x27;front&#x27;?&#x27;后置&#x27;:&#x27;前置&#x27;&#125;&#125;摄像头<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">camera</span> <span class=\"attr\">binderror</span>=<span class=\"string\">&quot;getError&quot;</span> <span class=\"attr\">device-position</span>=<span class=\"string\">&quot;&#123;&#123;devicePosition&#125;&#125;&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;width: 100vw;height: 100vh;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">camera</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn-container&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn-item&quot;</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;back&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;background-color: #ddd;&quot;</span>&gt;</span>返回<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn-item&quot;</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;record&quot;</span>&gt;</span>&#123;&#123;isRecording?&#x27;结束录制&#x27;:&#x27;点击录制&#x27;&#125;&#125;<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;<span class=\"name\">view</span> <span class=\"attr\">wx:else</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;position: fixed;width: 100vw;height: 100vh;&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">video</span> <span class=\"attr\">src</span>=<span class=\"string\">&quot;&#123;&#123;video_url&#125;&#125;&quot;</span> <span class=\"attr\">style</span>=<span class=\"string\">&quot;width: 100%;height: 100%;&quot;</span> <span class=\"attr\">autoplay</span>=<span class=\"string\">&quot;&#123;&#123;true&#125;&#125;&quot;</span> <span class=\"attr\">loop</span>=<span class=\"string\">&quot;&#123;&#123;true&#125;&#125;&quot;</span> <span class=\"attr\">controls</span>=<span class=\"string\">&quot;&#123;&#123;false&#125;&#125;&quot;</span>&gt;</span><span class=\"tag\">&lt;/<span class=\"name\">video</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn-container&quot;</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn-item&quot;</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;recordAgain&quot;</span>&gt;</span>重新录制<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t\t\t<span class=\"tag\">&lt;<span class=\"name\">cover-view</span> <span class=\"attr\">class</span>=<span class=\"string\">&quot;btn-item&quot;</span> <span class=\"attr\">bindtap</span>=<span class=\"string\">&quot;sureVideo&quot;</span>&gt;</span>确认选择<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t\t<span class=\"tag\">&lt;/<span class=\"name\">cover-view</span>&gt;</span></span><br><span class=\"line\">\t<span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br><span class=\"line\"><span class=\"tag\">&lt;/<span class=\"name\">view</span>&gt;</span></span><br></pre></td></tr></table></figure>\n\n<p>camera.wxss</p>\n<figure class=\"highlight css\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"selector-class\">.time-container</span>&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">\t<span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">left</span>:<span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">top</span>: <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">height</span>: <span class=\"number\">240</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">\t<span class=\"attribute\">justify-content</span>: center;</span><br><span class=\"line\">\t<span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">\t<span class=\"attribute\">background-color</span>: <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.4</span>);</span><br><span class=\"line\">\t<span class=\"attribute\">z-index</span>: <span class=\"number\">100</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.change-btn</span>&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">\t<span class=\"attribute\">top</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">left</span>: <span class=\"number\">50%</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">transform</span>: <span class=\"built_in\">translate</span>(-<span class=\"number\">50%</span>,-<span class=\"number\">50%</span>);</span><br><span class=\"line\">\t<span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">\t<span class=\"attribute\">align-items</span>: center;</span><br><span class=\"line\">\t<span class=\"attribute\">height</span>: <span class=\"number\">100</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">font-size</span>: <span class=\"number\">30</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">padding</span>: <span class=\"number\">0</span> <span class=\"number\">50</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">border-radius</span>: <span class=\"number\">50</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">z-index</span>: <span class=\"number\">100</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">background-color</span>: <span class=\"built_in\">rgba</span>(<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0</span>,<span class=\"number\">0.5</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.time</span>&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">font-size</span>: <span class=\"number\">30</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">color</span>: red;</span><br><span class=\"line\">\t<span class=\"attribute\">padding</span>: <span class=\"number\">0</span> <span class=\"number\">20</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">margin-top</span>: <span class=\"number\">30</span>rpx;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.btn-container</span>&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">position</span>: absolute;</span><br><span class=\"line\">\t<span class=\"attribute\">width</span>: <span class=\"number\">100%</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">padding</span>: <span class=\"number\">0</span> <span class=\"number\">80</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">box-sizing</span>: border-box;</span><br><span class=\"line\">\t<span class=\"attribute\">bottom</span>: <span class=\"number\">160</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">display</span>: flex;</span><br><span class=\"line\">\t<span class=\"attribute\">justify-content</span>: space-between;</span><br><span class=\"line\">\t<span class=\"attribute\">z-index</span>: <span class=\"number\">100</span>;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"selector-class\">.btn-item</span>&#123;</span><br><span class=\"line\">\t<span class=\"attribute\">padding</span>: <span class=\"number\">30</span>rpx <span class=\"number\">0</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">border-radius</span>: <span class=\"number\">45</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">background-color</span>: <span class=\"number\">#FF6685</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">color</span>: <span class=\"number\">#fff</span>;</span><br><span class=\"line\">\t<span class=\"attribute\">font-size</span>: <span class=\"number\">32</span>rpx;</span><br><span class=\"line\">\t<span class=\"attribute\">text-align</span>: center;</span><br><span class=\"line\">\t<span class=\"attribute\">width</span>: <span class=\"number\">240</span>rpx;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>camera.js</p>\n<figure class=\"highlight js\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br><span class=\"line\">156</span><br><span class=\"line\">157</span><br><span class=\"line\">158</span><br><span class=\"line\">159</span><br><span class=\"line\">160</span><br><span class=\"line\">161</span><br><span class=\"line\">162</span><br><span class=\"line\">163</span><br><span class=\"line\">164</span><br><span class=\"line\">165</span><br><span class=\"line\">166</span><br><span class=\"line\">167</span><br><span class=\"line\">168</span><br><span class=\"line\">169</span><br><span class=\"line\">170</span><br><span class=\"line\">171</span><br><span class=\"line\">172</span><br><span class=\"line\">173</span><br><span class=\"line\">174</span><br><span class=\"line\">175</span><br><span class=\"line\">176</span><br><span class=\"line\">177</span><br><span class=\"line\">178</span><br><span class=\"line\">179</span><br><span class=\"line\">180</span><br><span class=\"line\">181</span><br><span class=\"line\">182</span><br><span class=\"line\">183</span><br><span class=\"line\">184</span><br><span class=\"line\">185</span><br><span class=\"line\">186</span><br><span class=\"line\">187</span><br><span class=\"line\">188</span><br><span class=\"line\">189</span><br><span class=\"line\">190</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> app = getApp()</span><br><span class=\"line\">Page(&#123;</span><br><span class=\"line\">\t<span class=\"attr\">data</span>: &#123;</span><br><span class=\"line\">\t\t<span class=\"attr\">ctx</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">isRecording</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">video_url</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">time</span>: <span class=\"number\">0</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">min_time</span>:<span class=\"number\">5</span>,\t<span class=\"comment\">//录制视频最小时长</span></span><br><span class=\"line\">\t\t<span class=\"attr\">timer</span>: <span class=\"literal\">null</span>,</span><br><span class=\"line\">\t\t<span class=\"attr\">devicePosition</span>: <span class=\"string\">&quot;back&quot;</span>, <span class=\"comment\">//摄像头朝向</span></span><br><span class=\"line\">\t\t<span class=\"attr\">isStart</span>:<span class=\"literal\">false</span>, <span class=\"comment\">//记录用户点击开始录制的状态</span></span><br><span class=\"line\">\t\t<span class=\"attr\">isStop</span>:<span class=\"literal\">false</span> <span class=\"comment\">//记录用户点击结束录制的状态</span></span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">onLoad</span>(<span class=\"params\">options</span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">const</span> ctx = wx.createCameraContext()</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">\t\t\tctx</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">onUnload</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">clearInterval</span>(<span class=\"built_in\">this</span>.data.timer)</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">//切换前置/后置摄像头</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">changePosition</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">devicePosition</span>: <span class=\"built_in\">this</span>.data.devicePosition == <span class=\"string\">&#x27;back&#x27;</span> ? <span class=\"string\">&#x27;front&#x27;</span> : <span class=\"string\">&#x27;back&#x27;</span></span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">checkSetting</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//这里定义一个状态isStart来记录用户点击开始录制行为，待startRecord接口请求成功后还原状态</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.data.isStart)&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.data.isStart = <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t * 调用wx.createCameraContext().startRecord()方法需要获取用户麦克风权限，否则无法调用且无法录制视频</span></span><br><span class=\"line\"><span class=\"comment\">\t\t * 所以每次进入页面时先进行检验用户是否授权麦克风权限</span></span><br><span class=\"line\"><span class=\"comment\">\t\t */</span></span><br><span class=\"line\">\t\twx.getSetting(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">let</span> authSetting = res.authSetting</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t * 原理同检测摄像头权限</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t */</span></span><br><span class=\"line\">\t\t\t\t<span class=\"keyword\">if</span> (authSetting.hasOwnProperty(<span class=\"string\">&#x27;scope.record&#x27;</span>) &amp;&amp; !authSetting[<span class=\"string\">&#x27;scope.record&#x27;</span>]) &#123;</span><br><span class=\"line\">\t\t\t\t\twx.showModal(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">content</span>: <span class=\"string\">&#x27;检测到您当前未开启麦克风权限，将无法录制视频&#x27;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">confirmText</span>: <span class=\"string\">&#x27;去开启&#x27;</span>,</span><br><span class=\"line\">\t\t\t\t\t\t<span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t<span class=\"keyword\">if</span> (res.confirm) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;用户点击确定&#x27;</span>)</span><br><span class=\"line\">\t\t\t\t\t\t\t\twx.openSetting(&#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t<span class=\"function\"><span class=\"title\">success</span>(<span class=\"params\">res</span>)</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t\t<span class=\"built_in\">console</span>.log(res.authSetting)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t&#125;);</span><br><span class=\"line\">\t\t\t\t\t\t\t&#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (res.cancel) &#123;</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;用户点击取消&#x27;</span>)</span><br><span class=\"line\">\t\t\t\t\t\t\t\t<span class=\"comment\">// this.back()</span></span><br><span class=\"line\">\t\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"built_in\">this</span>.startRecord()</span><br><span class=\"line\">\t\t\t\t&#125;</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">//用户进入页面授权时点击不允许授权时触发该方法，且不允许授权后每次进入页面都会直接触发</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">getError</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;用户未授权使用摄像头&quot;</span>)</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.back()</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">//点击开始录制/结束录制</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">record</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span> (<span class=\"built_in\">this</span>.data.isRecording) &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;结束录制视频&quot;</span>)</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">this</span>.stopRecord()</span><br><span class=\"line\">\t\t&#125; <span class=\"keyword\">else</span> &#123;</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;开始录制视频&quot;</span>)</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">this</span>.checkSetting()</span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">//开始录制</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">startRecord</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.data.ctx.startRecord(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">timeoutCallback</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t * 微信官方限制</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t * 使用该方法录制视频最多录制30s，30s后自动停止录制</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t * 停止录制计时</span></span><br><span class=\"line\"><span class=\"comment\">\t\t\t\t */</span></span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log(<span class=\"string\">&quot;30秒时间结束，自动停止录制&quot;</span>)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">clearInterval</span>(<span class=\"built_in\">this</span>.data.timer)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">video_url</span>: res.tempVideoPath,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">isRecording</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">this</span>.timing()</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">isRecording</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">this</span>.data.isStart = <span class=\"literal\">false</span></span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"attr\">fail</span>:<span class=\"function\">(<span class=\"params\">err</span>)=&gt;</span>&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log(err)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">this</span>.data.isStart = <span class=\"literal\">false</span></span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">//结束录制</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">stopRecord</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">//stopRecord方法不可连续调用，否则无法停止录制</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//这里定义一个状态isStop来记录用户点击结束录制行为，待stopRecord接口请求成功后还原状态</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.data.isStop)&#123;</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\t<span class=\"keyword\">if</span>(<span class=\"built_in\">this</span>.data.time&lt;<span class=\"built_in\">this</span>.data.min_time)&#123;</span><br><span class=\"line\">\t\t\twx.showToast(&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">title</span>:<span class=\"string\">&quot;视频时长小于&quot;</span>+<span class=\"built_in\">this</span>.data.min_time+<span class=\"string\">&quot;秒&quot;</span>,</span><br><span class=\"line\">\t\t\t\t<span class=\"attr\">icon</span>:<span class=\"string\">&quot;none&quot;</span></span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t<span class=\"keyword\">return</span></span><br><span class=\"line\">\t\t&#125;</span><br><span class=\"line\">\t\twx.showLoading(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">title</span>:<span class=\"string\">&quot;请稍候&quot;</span></span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.data.isStop = <span class=\"literal\">true</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.data.ctx.stopRecord(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"comment\">//compressed: false,  //是否压缩录完的视频</span></span><br><span class=\"line\">\t\t\t<span class=\"attr\">success</span>: <span class=\"function\">(<span class=\"params\">res</span>) =&gt;</span> &#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log(res)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">clearInterval</span>(<span class=\"built_in\">this</span>.data.timer)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">video_url</span>: res.tempVideoPath,</span><br><span class=\"line\">\t\t\t\t\t<span class=\"attr\">isRecording</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">\t\t\t\t&#125;)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">this</span>.data.isStop = <span class=\"literal\">false</span></span><br><span class=\"line\">\t\t\t\twx.hideLoading()</span><br><span class=\"line\">\t\t\t&#125;,</span><br><span class=\"line\">\t\t\t<span class=\"function\"><span class=\"title\">fail</span>(<span class=\"params\">err</span>)</span>&#123;</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">console</span>.log(err)</span><br><span class=\"line\">\t\t\t\t<span class=\"built_in\">this</span>.data.isStop = <span class=\"literal\">false</span></span><br><span class=\"line\">\t\t\t\twx.hideLoading()</span><br><span class=\"line\">\t\t\t&#125;</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">//计时</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">timing</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"keyword\">let</span> time = <span class=\"number\">0</span></span><br><span class=\"line\">\t\t<span class=\"comment\">//每次计时前先将页面上的时间重置为0</span></span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">\t\t\ttime</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t\t<span class=\"keyword\">let</span> self = <span class=\"built_in\">this</span></span><br><span class=\"line\">\t\t<span class=\"keyword\">let</span> timer = <span class=\"built_in\">setInterval</span>(<span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">\t\t\ttime++</span><br><span class=\"line\">\t\t\t<span class=\"built_in\">console</span>.log(time)</span><br><span class=\"line\">\t\t\tself.setData(&#123;</span><br><span class=\"line\">\t\t\t\ttime</span><br><span class=\"line\">\t\t\t&#125;)</span><br><span class=\"line\">\t\t&#125;, <span class=\"number\">1000</span>)</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">\t\t\ttimer</span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">//重新录制</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">recordAgain</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"built_in\">this</span>.setData(&#123;</span><br><span class=\"line\">\t\t\t<span class=\"attr\">video_url</span>: <span class=\"literal\">null</span></span><br><span class=\"line\">\t\t&#125;)</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">//返回上一页</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">back</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\twx.navigateBack()</span><br><span class=\"line\">\t&#125;,</span><br><span class=\"line\">\t<span class=\"comment\">//确认选择</span></span><br><span class=\"line\">\t<span class=\"function\"><span class=\"title\">sureVideo</span>(<span class=\"params\"></span>)</span> &#123;</span><br><span class=\"line\">\t\t<span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\">\t\t * 将录完的视频地址保存本地，返回上一页时在onShow里面判断本地是否存在录制视频的地址</span></span><br><span class=\"line\"><span class=\"comment\">\t\t */</span></span><br><span class=\"line\">\t\twx.setStorageSync(<span class=\"string\">&#x27;auth_video&#x27;</span>, <span class=\"built_in\">this</span>.data.video_url)</span><br><span class=\"line\">\t\twx.navigateBack()</span><br><span class=\"line\">\t&#125;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://s2.loli.net/2022/07/01/MDfFdLcJVzCnYqs.jpg\"></p>\n<p><img src=\"https://s2.loli.net/2022/07/01/8zuTdCMvVf2jlkw.jpg\"></p>\n<p><img src=\"https://s2.loli.net/2022/07/01/o3Sl1FvpPmjZLdk.jpg\"></p>\n<p><img src=\"https://s2.loli.net/2022/07/01/1pWhtlGokIY8au9.jpg\"></p>\n<p><img src=\"https://s2.loli.net/2022/07/01/VbaWYG4JgSij7N1.jpg\"></p>\n<p><img src=\"https://s2.loli.net/2022/07/01/IB4Lq1nrEuZRYFA.jpg\"></p>\n","categories":[{"name":"微信小程序","path":"api/categories/微信小程序.json"}],"tags":[{"name":"微信小程序","path":"api/tags/微信小程序.json"}]}