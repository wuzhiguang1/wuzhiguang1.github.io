{"title":"微信小程序实现下拉刷新","slug":"135","date":"2020-12-21T00:48:48.000Z","updated":"2020-12-21T00:53:16.000Z","comments":true,"path":"api/articles/135.json","excerpt":" [Figure] ","covers":["https://cdn.jsdelivr.net/gh/wuzhiguang1/bolgfile@1.9/photo/IMG_0090.PNG"],"content":"<p><img src=\"https://cdn.jsdelivr.net/gh/wuzhiguang1/bolgfile@1.9/photo/IMG_0090.PNG\"></p>\n<span id=\"more\"></span>\n\n<p>本文将简单介绍如何实现微信小程序的下拉刷新<br>将要使用的api：</p>\n<ul>\n<li>wx.showNavigationBarLoading(Object object) </li>\n<li>wx.showLoading(Object object) </li>\n<li>wx.hideLoading(Object object)</li>\n<li>wx.hideNavigationBarLoading(Object object)</li>\n<li>wx.stopPullDownRefresh(Object object) wx.request(Object object)</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//刷新</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">onRefresh</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//在当前页面显示导航条加载动画</span></span><br><span class=\"line\">    wx.showNavigationBarLoading(); </span><br><span class=\"line\">    <span class=\"comment\">//显示 loading 提示框。需主动调用 wx.hideLoading 才能关闭提示框</span></span><br><span class=\"line\">    wx.showLoading(&#123;</span><br><span class=\"line\">      <span class=\"attr\">title</span>: <span class=\"string\">&#x27;刷新中...&#x27;</span>,</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.getData();</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"><span class=\"comment\">//网络请求，获取数据</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">getData</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">\twx.request(&#123;</span><br><span class=\"line\">        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"comment\">//网络请求执行完后将执行的动作</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"title\">complete</span>(<span class=\"params\">res</span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//隐藏loading 提示框</span></span><br><span class=\"line\">            wx.hideLoading();</span><br><span class=\"line\">            <span class=\"comment\">//隐藏导航条加载动画</span></span><br><span class=\"line\">            wx.hideNavigationBarLoading();</span><br><span class=\"line\">            <span class=\"comment\">//停止下拉刷新</span></span><br><span class=\"line\">            wx.stopPullDownRefresh();</span><br><span class=\"line\">  \t  \t&#125;</span><br><span class=\"line\">\t&#125;)   </span><br><span class=\"line\">&#125;,</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 页面相关事件处理函数--监听用户下拉动作</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"attr\">onPullDownRefresh</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//调用刷新时将执行的方法</span></span><br><span class=\"line\">\t<span class=\"built_in\">this</span>.onRefresh();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>除了在js页面编写响应的逻辑之外，还需要再相应页面的json中写入以下配置，这个配置允许这个页面进行下拉刷新动作</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">     <span class=\"string\">&quot;enablePullDownRefresh&quot;</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>特别需要注意的是：</p>\n<ul>\n<li>写之前先看看有无已经存在的onPullDownRefresh:function()函数，否则将不能监听到用户的下拉刷新动作</li>\n<li>注意相关api的配对使用</li>\n<li>不要忘了在需要刷新结束时调用wx.stopPullDownRefresh()，否则，页面将会保持下拉状态、不会回弹。·</li>\n</ul>\n<p>此外，除了下拉刷新，有时候可能是在某个事件进行时触发刷新动作，此时可以调用wx.startPullDownRefresh(Object object) 此api的作用是：“ 开始下拉刷新。调用后触发下拉刷新动画，效果与用户手动下拉刷新一致。”</p>\n","more":"<p>本文将简单介绍如何实现微信小程序的下拉刷新<br>将要使用的api：</p>\n<ul>\n<li>wx.showNavigationBarLoading(Object object) </li>\n<li>wx.showLoading(Object object) </li>\n<li>wx.hideLoading(Object object)</li>\n<li>wx.hideNavigationBarLoading(Object object)</li>\n<li>wx.stopPullDownRefresh(Object object) wx.request(Object object)</li>\n</ul>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//刷新</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">onRefresh</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//在当前页面显示导航条加载动画</span></span><br><span class=\"line\">    wx.showNavigationBarLoading(); </span><br><span class=\"line\">    <span class=\"comment\">//显示 loading 提示框。需主动调用 wx.hideLoading 才能关闭提示框</span></span><br><span class=\"line\">    wx.showLoading(&#123;</span><br><span class=\"line\">      <span class=\"attr\">title</span>: <span class=\"string\">&#x27;刷新中...&#x27;</span>,</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"built_in\">this</span>.getData();</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\"><span class=\"comment\">//网络请求，获取数据</span></span><br><span class=\"line\"><span class=\"function\"><span class=\"title\">getData</span>(<span class=\"params\"></span>)</span>&#123;</span><br><span class=\"line\">\twx.request(&#123;</span><br><span class=\"line\">        <span class=\"attr\">url</span>: <span class=\"string\">&#x27;&#x27;</span>,</span><br><span class=\"line\">        <span class=\"comment\">//网络请求执行完后将执行的动作</span></span><br><span class=\"line\">        <span class=\"function\"><span class=\"title\">complete</span>(<span class=\"params\">res</span>)</span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">//隐藏loading 提示框</span></span><br><span class=\"line\">            wx.hideLoading();</span><br><span class=\"line\">            <span class=\"comment\">//隐藏导航条加载动画</span></span><br><span class=\"line\">            wx.hideNavigationBarLoading();</span><br><span class=\"line\">            <span class=\"comment\">//停止下拉刷新</span></span><br><span class=\"line\">            wx.stopPullDownRefresh();</span><br><span class=\"line\">  \t  \t&#125;</span><br><span class=\"line\">\t&#125;)   </span><br><span class=\"line\">&#125;,</span><br><span class=\"line\"><span class=\"comment\">/**</span></span><br><span class=\"line\"><span class=\"comment\"> * 页面相关事件处理函数--监听用户下拉动作</span></span><br><span class=\"line\"><span class=\"comment\"> */</span></span><br><span class=\"line\"><span class=\"attr\">onPullDownRefresh</span>: <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">//调用刷新时将执行的方法</span></span><br><span class=\"line\">\t<span class=\"built_in\">this</span>.onRefresh();</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>除了在js页面编写响应的逻辑之外，还需要再相应页面的json中写入以下配置，这个配置允许这个页面进行下拉刷新动作</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&#123;</span><br><span class=\"line\">     <span class=\"string\">&quot;enablePullDownRefresh&quot;</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>特别需要注意的是：</p>\n<ul>\n<li>写之前先看看有无已经存在的onPullDownRefresh:function()函数，否则将不能监听到用户的下拉刷新动作</li>\n<li>注意相关api的配对使用</li>\n<li>不要忘了在需要刷新结束时调用wx.stopPullDownRefresh()，否则，页面将会保持下拉状态、不会回弹。·</li>\n</ul>\n<p>此外，除了下拉刷新，有时候可能是在某个事件进行时触发刷新动作，此时可以调用wx.startPullDownRefresh(Object object) 此api的作用是：“ 开始下拉刷新。调用后触发下拉刷新动画，效果与用户手动下拉刷新一致。”</p>","categories":[{"name":"微信小程序","path":"api/categories/微信小程序.json"}],"tags":[{"name":"微信小程序","path":"api/tags/微信小程序.json"},{"name":"小程序下拉刷新","path":"api/tags/小程序下拉刷新.json"}]}