{"title":"webpack 性能优化","slug":"56","date":"2020-07-16T14:46:35.000Z","updated":"2022-07-29T04:22:04.776Z","comments":true,"path":"api/articles/56.json","excerpt":" [Figure] ","covers":["https://qny.aqingya.cn/img/f2aedd087b1941baa9f31ee14591f6c7.jpg","https://qny.aqingya.cn/img/20200716155656.png","https://qny.aqingya.cn/img/20200717090022.png","https://qny.aqingya.cn/img/20200716164340.png","https://qny.aqingya.cn/img/20200716164207.png","https://qny.aqingya.cn/img/20200716171931.png","https://qny.aqingya.cn/img/20200716171825.png","https://qny.aqingya.cn/img/20200716172037.png","https://qny.aqingya.cn/img/20200716191203.png","https://qny.aqingya.cn/img/20200716194524.png","https://qny.aqingya.cn/img/20200716214613.png"],"content":"<p><img src=\"https://qny.aqingya.cn/img/f2aedd087b1941baa9f31ee14591f6c7.jpg\" alt=\"\"></p>\n<span id=\"more\"></span>\n<h1 id=\"webpack-性能优化\"><a href=\"#webpack-性能优化\" class=\"headerlink\" title=\"webpack 性能优化\"></a>webpack 性能优化</h1><h2 id=\"HMR-（热模块替换）\"><a href=\"#HMR-（热模块替换）\" class=\"headerlink\" title=\"HMR （热模块替换）\"></a>HMR （热模块替换）</h2><p>HMR: hot module replacement 热模块替换 / 模块热替换</p>\n<p>作用：一个模块发生变化，只会重新打包这一个模块（而不是打包所有模块） </p>\n<p>极大提升构建速度</p>\n<p>1、<strong>样式文件</strong>：可以使用HMR功能：因为style-loader内部实现了~</p>\n<p>2、<strong>js文件</strong>：默认不能使用HMR功能 —&gt; 需要修改js代码，添加支持HMR功能的代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"built_in\">module</span>.hot) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 一旦 module.hot 为true，说明开启了HMR功能。 --&gt; 让HMR功能代码生效</span></span><br><span class=\"line\">    <span class=\"built_in\">module</span>.hot.accept(<span class=\"string\">&#x27;./print.js&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 方法会监听 print.js 文件的变化，一旦发生变化，其他模块不会重新打包构建。</span></span><br><span class=\"line\">        <span class=\"comment\">// 会执行后面的回调函数</span></span><br><span class=\"line\">        <span class=\"comment\">//print();</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong><span style=\"background-color:yellow\">注意：HMR功能对js的处理，只能处理非入口js文件的其他文件。</span></strong></p>\n<p>3、<strong>html文件</strong>: 默认不能使用HMR功能.同时会导致问题：html文件不能热更新了~ （不用做HMR功能）</p>\n<p>​    解决：修改entry入口，将html文件引入</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">entry: [<span class=\"string\">&#x27;./src/js/index.js&#x27;</span>, <span class=\"string\">&#x27;./src/index.html&#x27;</span>]</span><br></pre></td></tr></table></figure>\n<p><br></p>\n<p>修改配置文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//修改entry入口，将html文件引入</span></span><br><span class=\"line\">    <span class=\"attr\">entry</span>: [<span class=\"string\">&#x27;./src/js/index.js&#x27;</span>, <span class=\"string\">&#x27;./src/index.html&#x27;</span>],</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/built.js&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">module</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">rules</span>: [</span><br><span class=\"line\">            <span class=\"comment\">// loader的配置</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理less资源</span></span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.less$/</span>,</span><br><span class=\"line\">                use: [<span class=\"string\">&#x27;style-loader&#x27;</span>, <span class=\"string\">&#x27;css-loader&#x27;</span>, <span class=\"string\">&#x27;less-loader&#x27;</span>]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理css资源</span></span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">                use: [<span class=\"string\">&#x27;style-loader&#x27;</span>, <span class=\"string\">&#x27;css-loader&#x27;</span>]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理图片资源</span></span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.(jpg|png|gif)$/</span>,</span><br><span class=\"line\">                loader: <span class=\"string\">&#x27;url-loader&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">limit</span>: <span class=\"number\">8</span> * <span class=\"number\">1024</span>,</span><br><span class=\"line\">                    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;[hash:10].[ext]&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"comment\">// 关闭es6模块化</span></span><br><span class=\"line\">                    <span class=\"attr\">esModule</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">                    <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;imgs&#x27;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理html中img资源</span></span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.html$/</span>,</span><br><span class=\"line\">                loader: <span class=\"string\">&#x27;html-loader&#x27;</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理其他资源</span></span><br><span class=\"line\">                <span class=\"attr\">exclude</span>: <span class=\"regexp\">/\\.(html|js|css|less|jpg|png|gif)/</span>,</span><br><span class=\"line\">                loader: <span class=\"string\">&#x27;file-loader&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;[hash:10].[ext]&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;media&#x27;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">        <span class=\"comment\">// plugins的配置</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">            <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;development&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">devServer</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">contentBase</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>),</span><br><span class=\"line\">        <span class=\"attr\">compress</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">port</span>: <span class=\"number\">3000</span>,</span><br><span class=\"line\">        <span class=\"attr\">open</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"comment\">// 开启HMR功能</span></span><br><span class=\"line\">        <span class=\"comment\">// 当修改了webpack配置，新配置要想生效，必须重新webpack服务</span></span><br><span class=\"line\">        <span class=\"attr\">hot</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p> 在<code>devServer</code>中开启hot就可以。</p>\n<h2 id=\"source-map\"><a href=\"#source-map\" class=\"headerlink\" title=\"source-map\"></a>source-map</h2><p> <strong>source-map:</strong> <span style=\"background-color:yellow\">一种 提供源代码到构建后代码映射 技术 （如果构建后代码出错了，通过映射可以追踪源代码错误）</span></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map  //devtool属性的值</span><br></pre></td></tr></table></figure>\n<p><br></p>\n<p>  source-map：外部</p>\n<p>   &emsp;&emsp;错误代码准确信息 和 源代码的错误位置</p>\n<p>  inline-source-map：内联</p>\n<p>   &emsp;&emsp;只生成一个内联source-map</p>\n<p>   &emsp;&emsp;错误代码准确信息 和 源代码的错误位置</p>\n<p>  hidden-source-map：外部</p>\n<p>   &emsp;&emsp;错误代码错误原因，但是没有错误位置</p>\n<p>   &emsp;&emsp;不能追踪源代码错误，只能提示到构建后代码的错误位置</p>\n<p>  eval-source-map：内联</p>\n<p>   &emsp;&emsp;每一个文件都生成对应的source-map，都在eval</p>\n<p>   &emsp;&emsp;错误代码准确信息 和 源代码的错误位置</p>\n<p>  nosources-source-map：外部</p>\n<p>  &emsp;&emsp; 错误代码准确信息, 但是没有任何源代码信息</p>\n<p>  cheap-source-map：外部</p>\n<p>   &emsp;&emsp;错误代码准确信息 和 源代码的错误位置 </p>\n<p>   &emsp;&emsp;只能精确的行</p>\n<p>  cheap-module-source-map：外部</p>\n<p>   &emsp;&emsp;错误代码准确信息 和 源代码的错误位置 </p>\n<p>   &emsp;&emsp;module会将loader的source map加入</p>\n<p><br></p>\n<p>  <strong><span style=\"color:red\">内联 和 外部的区别：1. 外部生成了文件，内联没有 2. 内联构建速度更快</span></strong></p>\n<p><br></p>\n<p>  开发环境：速度快，调试更友好</p>\n<p>   速度快(eval&gt;inline&gt;cheap&gt;…)</p>\n<p>   &emsp;&emsp; eval-cheap-souce-map &emsp;&emsp; 速度最快</p>\n<p>  &emsp;&emsp;  eval-source-map&emsp;&emsp;速度其次，<strong>在开发环境中推荐使用</strong>，vue中的脚手架也是采用的eval-source-map</p>\n<p>   调试更友好 </p>\n<p>​    &emsp;&emsp;souce-map</p>\n<p> &emsp;&emsp;   cheap-module-souce-map</p>\n<p> &emsp;&emsp;   cheap-souce-map</p>\n<p><span style=\"background-color:yellow\">eval-source-map / eval-cheap-module-souce-map</span></p>\n<p><br></p>\n<p>  生产环境：源代码要不要隐藏? 调试要不要更友好</p>\n<p>   内联会让代码体积变大，所以在生产环境不用内联</p>\n<p>   &emsp;&emsp;nosources-source-map &emsp;&emsp;全部隐藏</p>\n<p>   &emsp;&emsp;hidden-source-map &emsp;&emsp;只隐藏源代码，会提示构建后代码错误信息</p>\n<p><span style=\"background-color:yellow\">source-map / cheap-module-souce-map</span></p>\n<p><br></p>\n<p>修改配置：<span style=\"background-color:yellow\">在<code>module.exports</code>中加入<code>devtool</code>属性即可</span></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  开发环境配置：能让代码运行</span></span><br><span class=\"line\"><span class=\"comment\">    运行项目指令：</span></span><br><span class=\"line\"><span class=\"comment\">      webpack 会将打包结果输出出去</span></span><br><span class=\"line\"><span class=\"comment\">      npx webpack-dev-server 只会在内存中编译打包，没有输出</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    <span class=\"attr\">entry</span>: [<span class=\"string\">&#x27;./src/js/index.js&#x27;</span>, <span class=\"string\">&#x27;./src/index.html&#x27;</span>],</span><br><span class=\"line\">    <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/built.js&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">module</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">rules</span>: [</span><br><span class=\"line\">            <span class=\"comment\">// loader的配置</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理less资源</span></span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.less$/</span>,</span><br><span class=\"line\">                use: [<span class=\"string\">&#x27;style-loader&#x27;</span>, <span class=\"string\">&#x27;css-loader&#x27;</span>, <span class=\"string\">&#x27;less-loader&#x27;</span>]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理css资源</span></span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">                use: [<span class=\"string\">&#x27;style-loader&#x27;</span>, <span class=\"string\">&#x27;css-loader&#x27;</span>]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理图片资源</span></span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.(jpg|png|gif)$/</span>,</span><br><span class=\"line\">                loader: <span class=\"string\">&#x27;url-loader&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">limit</span>: <span class=\"number\">8</span> * <span class=\"number\">1024</span>,</span><br><span class=\"line\">                    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;[hash:10].[ext]&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"comment\">// 关闭es6模块化</span></span><br><span class=\"line\">                    <span class=\"attr\">esModule</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">                    <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;imgs&#x27;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理html中img资源</span></span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.html$/</span>,</span><br><span class=\"line\">                loader: <span class=\"string\">&#x27;html-loader&#x27;</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理其他资源</span></span><br><span class=\"line\">                <span class=\"attr\">exclude</span>: <span class=\"regexp\">/\\.(html|js|css|less|jpg|png|gif)/</span>,</span><br><span class=\"line\">                loader: <span class=\"string\">&#x27;file-loader&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;[hash:10].[ext]&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;media&#x27;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">        <span class=\"comment\">// plugins的配置</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">            <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">minify</span>: &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 移除空格</span></span><br><span class=\"line\">                <span class=\"attr\">collapseWhitespace</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">                <span class=\"comment\">// 移除注释</span></span><br><span class=\"line\">                <span class=\"attr\">removeComments</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;development&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">devServer</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">contentBase</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>),</span><br><span class=\"line\">        <span class=\"attr\">compress</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">port</span>: <span class=\"number\">3000</span>,</span><br><span class=\"line\">        <span class=\"attr\">open</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">hot</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//配置source-map</span></span><br><span class=\"line\">    <span class=\"attr\">devtool</span>: <span class=\"string\">&#x27;eval-source-map&#x27;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"oneOf\"><a href=\"#oneOf\" class=\"headerlink\" title=\"oneOf\"></a>oneOf</h2><p>配置完oneOf，它以下的loader只会匹配一个<br><span style=\"background-color:yellow\">注意：不能有两个配置处理同一种类型文件,如果有就将一个提取上去，放外面就好了。</span></p>\n<p>修改配置文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> MiniCssExtractPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mini-css-extract-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> OptimizeCssAssetsWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;optimize-css-assets-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 定义nodejs环境变量：决定使用browserslist的哪个环境</span></span><br><span class=\"line\">process.env.NODE_ENV = <span class=\"string\">&#x27;production&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 复用loader</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> commonCssLoader = [</span><br><span class=\"line\">  MiniCssExtractPlugin.loader,</span><br><span class=\"line\">  <span class=\"string\">&#x27;css-loader&#x27;</span>,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 还需要在package.json中定义browserslist</span></span><br><span class=\"line\">    <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;postcss-loader&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">ident</span>: <span class=\"string\">&#x27;postcss&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">plugins</span>: <span class=\"function\">() =&gt;</span> [<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;postcss-preset-env&#x27;</span>)()]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/built.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">module</span>: &#123;</span><br><span class=\"line\">      </span><br><span class=\"line\">  <span class=\"comment\">//-----------------------------------------------------------------------    </span></span><br><span class=\"line\">    <span class=\"attr\">rules</span>: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 在package.json中eslintConfig --&gt; airbnb</span></span><br><span class=\"line\">        <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">        exclude: <span class=\"regexp\">/node_modules/</span>,</span><br><span class=\"line\">        <span class=\"comment\">// 优先执行</span></span><br><span class=\"line\">        enforce: <span class=\"string\">&#x27;pre&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;eslint-loader&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">fix</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">        </span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 以下loader只会匹配一个</span></span><br><span class=\"line\">        <span class=\"comment\">// 注意：不能有两个配置处理同一种类型文件,如果有就将一个提取上去，放外面就好了。</span></span><br><span class=\"line\">        <span class=\"attr\">oneOf</span>: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">            use: [...commonCssLoader]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.less$/</span>,</span><br><span class=\"line\">            use: [...commonCssLoader, <span class=\"string\">&#x27;less-loader&#x27;</span>]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">            正常来讲，一个文件只能被一个loader处理。</span></span><br><span class=\"line\"><span class=\"comment\">            当一个文件要被多个loader处理，那么一定要指定loader执行的先后顺序：</span></span><br><span class=\"line\"><span class=\"comment\">              先执行eslint 在执行babel</span></span><br><span class=\"line\"><span class=\"comment\">          */</span></span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">            exclude: <span class=\"regexp\">/node_modules/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;babel-loader&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">presets</span>: [</span><br><span class=\"line\">                [</span><br><span class=\"line\">                  <span class=\"string\">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class=\"line\">                  &#123;</span><br><span class=\"line\">                    <span class=\"attr\">useBuiltIns</span>: <span class=\"string\">&#x27;usage&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">corejs</span>: &#123;<span class=\"attr\">version</span>: <span class=\"number\">3</span>&#125;,</span><br><span class=\"line\">                    <span class=\"attr\">targets</span>: &#123;</span><br><span class=\"line\">                      <span class=\"attr\">chrome</span>: <span class=\"string\">&#x27;60&#x27;</span>,</span><br><span class=\"line\">                      <span class=\"attr\">firefox</span>: <span class=\"string\">&#x27;50&#x27;</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                  &#125;</span><br><span class=\"line\">                ]</span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.(jpg|png|gif)/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;url-loader&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">limit</span>: <span class=\"number\">8</span> * <span class=\"number\">1024</span>,</span><br><span class=\"line\">              <span class=\"attr\">name</span>: <span class=\"string\">&#x27;[hash:10].[ext]&#x27;</span>,</span><br><span class=\"line\">              <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;imgs&#x27;</span>,</span><br><span class=\"line\">              <span class=\"attr\">esModule</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.html$/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;html-loader&#x27;</span></span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">exclude</span>: <span class=\"regexp\">/\\.(js|css|less|html|jpg|png|gif)/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;file-loader&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;media&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">      </span><br><span class=\"line\">   <span class=\"comment\">//-----------------------------------------------------------------------       </span></span><br><span class=\"line\">      </span><br><span class=\"line\">      </span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> MiniCssExtractPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;css/built.css&#x27;</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> OptimizeCssAssetsWebpackPlugin(),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">minify</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">collapseWhitespace</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">removeComments</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"缓存\"><a href=\"#缓存\" class=\"headerlink\" title=\"缓存\"></a>缓存</h2><p>主要针对生产环境的缓存</p>\n<p><span style=\"background-color:yellow\">注意：有可能是面试题 注意。</span></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">缓存：</span><br><span class=\"line\">  babel缓存</span><br><span class=\"line\">    cacheDirectory: true</span><br><span class=\"line\">    --&gt; 让第二次打包构建速度更快</span><br><span class=\"line\">    </span><br><span class=\"line\">  文件资源缓存  修改 filename: &#x27;js/built.[contenthash:10].js&#x27;</span><br><span class=\"line\">    hash: 每次wepack构建时会生成一个唯一的hash值。</span><br><span class=\"line\">      问题: 因为js和css同时使用一个hash值。</span><br><span class=\"line\">        如果重新打包，会导致所有缓存失效。（可能我却只改动一个文件）</span><br><span class=\"line\">    chunkhash：根据chunk生成的hash值。如果打包来源于同一个chunk，那么hash值就一样</span><br><span class=\"line\">      问题: js和css的hash值还是一样的</span><br><span class=\"line\">        因为css是在js中被引入的，所以同属于一个chunk</span><br><span class=\"line\">    contenthash: 根据文件的内容生成hash值。不同文件hash值一定不一样    </span><br><span class=\"line\">    --&gt; 让代码上线运行缓存更好使用</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>设置配置文件：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> MiniCssExtractPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mini-css-extract-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> OptimizeCssAssetsWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;optimize-css-assets-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 定义nodejs环境变量：决定使用browserslist的哪个环境</span></span><br><span class=\"line\">process.env.NODE_ENV = <span class=\"string\">&#x27;production&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 复用loader</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> commonCssLoader = [</span><br><span class=\"line\">    MiniCssExtractPlugin.loader,</span><br><span class=\"line\">    <span class=\"string\">&#x27;css-loader&#x27;</span>,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 还需要在package.json中定义browserslist</span></span><br><span class=\"line\">        <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;postcss-loader&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">ident</span>: <span class=\"string\">&#x27;postcss&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">plugins</span>: <span class=\"function\">() =&gt;</span> [<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;postcss-preset-env&#x27;</span>)()]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">        <span class=\"comment\">//------------------------------------------------------</span></span><br><span class=\"line\">        <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/built.[contenthash:10].js&#x27;</span>,</span><br><span class=\"line\">        <span class=\"comment\">//------------------------------------------------------</span></span><br><span class=\"line\">        <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">module</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">rules</span>: [&#123;</span><br><span class=\"line\">                <span class=\"comment\">// 在package.json中eslintConfig --&gt; airbnb</span></span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">                exclude: <span class=\"regexp\">/node_modules/</span>,</span><br><span class=\"line\">                <span class=\"comment\">// 优先执行</span></span><br><span class=\"line\">                enforce: <span class=\"string\">&#x27;pre&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;eslint-loader&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">fix</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 以下loader只会匹配一个</span></span><br><span class=\"line\">                <span class=\"comment\">// 注意：不能有两个配置处理同一种类型文件</span></span><br><span class=\"line\">                <span class=\"attr\">oneOf</span>: [&#123;</span><br><span class=\"line\">                        <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">                        use: [...commonCssLoader]</span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.less$/</span>,</span><br><span class=\"line\">                        use: [...commonCssLoader, <span class=\"string\">&#x27;less-loader&#x27;</span>]</span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">                      正常来讲，一个文件只能被一个loader处理。</span></span><br><span class=\"line\"><span class=\"comment\">                      当一个文件要被多个loader处理，那么一定要指定loader执行的先后顺序：</span></span><br><span class=\"line\"><span class=\"comment\">                        先执行eslint 在执行babel</span></span><br><span class=\"line\"><span class=\"comment\">                    */</span></span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">                        exclude: <span class=\"regexp\">/node_modules/</span>,</span><br><span class=\"line\">                        loader: <span class=\"string\">&#x27;babel-loader&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                            <span class=\"attr\">presets</span>: [</span><br><span class=\"line\">                                [</span><br><span class=\"line\">                                    <span class=\"string\">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class=\"line\">                                    &#123;</span><br><span class=\"line\">                                        <span class=\"attr\">useBuiltIns</span>: <span class=\"string\">&#x27;usage&#x27;</span>,</span><br><span class=\"line\">                                        <span class=\"attr\">corejs</span>: &#123; <span class=\"attr\">version</span>: <span class=\"number\">3</span> &#125;,</span><br><span class=\"line\">                                        <span class=\"attr\">targets</span>: &#123;</span><br><span class=\"line\">                                            <span class=\"attr\">chrome</span>: <span class=\"string\">&#x27;60&#x27;</span>,</span><br><span class=\"line\">                                            <span class=\"attr\">firefox</span>: <span class=\"string\">&#x27;50&#x27;</span></span><br><span class=\"line\">                                        &#125;</span><br><span class=\"line\">                                    &#125;</span><br><span class=\"line\">                                ]</span><br><span class=\"line\">                            ],</span><br><span class=\"line\">                            </span><br><span class=\"line\">                    <span class=\"comment\">//------------------------------------------------        </span></span><br><span class=\"line\">                            <span class=\"comment\">// 开启babel缓存</span></span><br><span class=\"line\">                            <span class=\"comment\">// 第二次构建时，会读取之前的缓存</span></span><br><span class=\"line\">                            <span class=\"attr\">cacheDirectory</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">                    <span class=\"comment\">//------------------------------------------------ </span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.(jpg|png|gif)/</span>,</span><br><span class=\"line\">                        loader: <span class=\"string\">&#x27;url-loader&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                            <span class=\"attr\">limit</span>: <span class=\"number\">8</span> * <span class=\"number\">1024</span>,</span><br><span class=\"line\">                            <span class=\"attr\">name</span>: <span class=\"string\">&#x27;[hash:10].[ext]&#x27;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;imgs&#x27;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">esModule</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.html$/</span>,</span><br><span class=\"line\">                        loader: <span class=\"string\">&#x27;html-loader&#x27;</span></span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"attr\">exclude</span>: <span class=\"regexp\">/\\.(js|css|less|html|jpg|png|gif)/</span>,</span><br><span class=\"line\">                        loader: <span class=\"string\">&#x27;file-loader&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                            <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;media&#x27;</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                ]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">        <span class=\"keyword\">new</span> MiniCssExtractPlugin(&#123;</span><br><span class=\"line\">            <span class=\"comment\">//------------------------------------------------ </span></span><br><span class=\"line\">            <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;css/built.[contenthash:10].css&#x27;</span></span><br><span class=\"line\">            <span class=\"comment\">//------------------------------------------------ </span></span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> OptimizeCssAssetsWebpackPlugin(),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">            <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">minify</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">collapseWhitespace</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">                <span class=\"attr\">removeComments</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">devtool</span>: <span class=\"string\">&#x27;source-map&#x27;</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"tree-shaking\"><a href=\"#tree-shaking\" class=\"headerlink\" title=\"tree shaking\"></a>tree shaking</h2><p>  <strong>tree shaking</strong>：去除无用代码<br>    &emsp;&emsp;前提：1. 必须使用ES6模块化  2. 开启production环境<br>    &emsp;&emsp;作用: 减少代码体积</p>\n<p><br></p>\n<p><span style=\"background-color:yellow\">在package.json中配置 </span><br>&emsp;&emsp;  “sideEffects”: false 所有代码都没有副作用（都可以进行tree shaking）<br>  &emsp;&emsp;  <strong>问题</strong>：可能会把css / @babel/polyfill （副作用）文件干掉<br>&emsp;&emsp;  “sideEffects”: [“<em>.css”, “</em>.less”]</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;sideEffects&quot;: [&quot;*.css&quot;, &quot;*.less&quot;]</span><br></pre></td></tr></table></figure>\n<h2 id=\"code-split-代码分割\"><a href=\"#code-split-代码分割\" class=\"headerlink\" title=\"code split (代码分割)\"></a>code split (代码分割)</h2><p>将一个大的js代码块 分割成多个小的代码块，并行加载，总而加快速度。</p>\n<p>有三种分割方式：</p>\n<h3 id=\"第一种\"><a href=\"#第一种\" class=\"headerlink\" title=\"第一种\"></a>第一种</h3><p>有两种配置</p>\n<p>1、单入口   —-默认输出单个文件</p>\n<p>2、多入口   —-有几个入口输出几个入口</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200716155656.png\" alt=\"\"></p>\n<p>修改配置文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">  <span class=\"comment\">// 单入口</span></span><br><span class=\"line\">  <span class=\"comment\">// entry: &#x27;./src/js/index.js&#x27;,</span></span><br><span class=\"line\">  <span class=\"attr\">entry</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 多入口：有一个入口，最终输出就有一个bundle</span></span><br><span class=\"line\">    <span class=\"attr\">index</span>: <span class=\"string\">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">test</span>: <span class=\"string\">&#x27;./src/js/test.js&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// [name]：取文件名</span></span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/[name].[contenthash:10].js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">minify</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">collapseWhitespace</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">removeComments</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"第二种\"><a href=\"#第二种\" class=\"headerlink\" title=\"第二种\"></a>第二种</h3><p>有两种配置</p>\n<p>1、单入口   —-只将node_modules中代码封装打包</p>\n<p>2、多入口   —-除了打包node_modules中代码，还会分析这些多入口有没有公共的依赖。<strong>如果有会打包成单独一个chunk</strong></p>\n<p><span style=\"background-color:yellow\">第二种分割代码不经常使用</span></p>\n<p>我们在index.js和test.js中都引入jquery。</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200717090022.png\" alt=\"\"></p>\n<p>修改配置文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">  <span class=\"comment\">// 单入口</span></span><br><span class=\"line\">  <span class=\"comment\">// entry: &#x27;./src/js/index.js&#x27;,</span></span><br><span class=\"line\">  <span class=\"attr\">entry</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">index</span>: <span class=\"string\">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">test</span>: <span class=\"string\">&#x27;./src/js/test.js&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// [name]：取文件名</span></span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/[name].[contenthash:10].js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">minify</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">collapseWhitespace</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">removeComments</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ],</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">  <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    1. 可以将node_modules中代码单独打包一个chunk最终输出</span></span><br><span class=\"line\"><span class=\"comment\">    2. 自动分析多入口chunk中，有没有公共的文件。如果有会打包成单独一个chunk</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\">  <span class=\"attr\">optimization</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">splitChunks</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">chunks</span>: <span class=\"string\">&#x27;all&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"第三种（常用）\"><a href=\"#第三种（常用）\" class=\"headerlink\" title=\"第三种（常用）\"></a>第三种（常用）</h3><p>1、我们一般采用单入口，配合<code>optimization</code>,将node_modules中代码单独打包一个chunk，</p>\n<p>2、其次我们还希望其他的js文件可以单独打包成一个文件，这样我们就使用js代码来实现。如：在头入口index.js中这样写。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  通过js代码，让某个文件被单独打包成一个chunk</span></span><br><span class=\"line\"><span class=\"comment\">  import动态导入语法：能将某个文件单独打包</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"comment\">//webpackChunkName: &#x27;test&#x27; 为它取一个名字。</span></span><br><span class=\"line\"><span class=\"keyword\">import</span>(<span class=\"comment\">/* webpackChunkName: &#x27;test&#x27; */</span><span class=\"string\">&#x27;./test&#x27;</span>)</span><br><span class=\"line\">\t.then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 文件加载成功~</span></span><br><span class=\"line\">        <span class=\"comment\">// eslint-disable-next-line</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;文件加载成功~&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .catch(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// eslint-disable-next-line</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;文件加载失败~&#x27;</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>修改 <code>webpack.config.js</code> 中的配置</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">  <span class=\"comment\">// 单入口</span></span><br><span class=\"line\">  <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// [name]：取文件名</span></span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/[name].[contenthash:10].js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">minify</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">collapseWhitespace</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">removeComments</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ],</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    1. 可以将node_modules中代码单独打包一个chunk最终输出</span></span><br><span class=\"line\"><span class=\"comment\">    2. 自动分析多入口chunk中，有没有公共的文件。如果有会打包成单独一个chunk</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\">  <span class=\"attr\">optimization</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">splitChunks</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">chunks</span>: <span class=\"string\">&#x27;all&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://qny.aqingya.cn/img/20200716164340.png\" alt=\"\"></p>\n<p><img src=\"https://qny.aqingya.cn/img/20200716164207.png\" alt=\"\"></p>\n<h2 id=\"懒加载和预加载\"><a href=\"#懒加载和预加载\" class=\"headerlink\" title=\"懒加载和预加载\"></a>懒加载和预加载</h2><p><strong>懒加载~</strong>：当文件需要使用时才加载~，不是上来就加载而是触发某些条件才会加载的。<span style=\"background-color:yellow\"><strong>利用代码分割的思路，将代码分割的语法import放到一个异步函数当中，等条件触发，再来加载懒加载这些代码。</strong></span></p>\n<p> <strong>预加载 prefetch</strong>：会在使用之前，提前加载js文件 </p>\n<p><br></p>\n<p> 正常加载可以认为是并行加载（同一时间加载多个文件） </p>\n<p> 预加载 prefetch：等其他资源加载完毕，浏览器空闲了，再偷偷加载资源。<span style=\"background-color:yellow\">(缺点：兼容性差)</span></p>\n<p><br></p>\n<p>index.js</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;index.js文件被加载了~&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// import &#123; mul &#125; from &#x27;./test&#x27;;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;btn&#x27;</span>).onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 懒加载~：当文件需要使用时才加载~</span></span><br><span class=\"line\">    <span class=\"comment\">// 预加载 prefetch：会在使用之前，提前加载js文件 </span></span><br><span class=\"line\">    <span class=\"comment\">// 正常加载可以认为是并行加载（同一时间加载多个文件）  </span></span><br><span class=\"line\">    <span class=\"comment\">// 预加载 prefetch：等其他资源加载完毕，浏览器空闲了，再偷偷加载资源</span></span><br><span class=\"line\">    <span class=\"comment\">//-------------------------------------------------------------------------------</span></span><br><span class=\"line\">    <span class=\"keyword\">import</span> ( <span class=\"comment\">/* webpackChunkName: &#x27;test&#x27;, webpackPrefetch: true */</span> <span class=\"string\">&#x27;./test&#x27;</span>).then(<span class=\"function\">(<span class=\"params\">&#123; mul &#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(mul(<span class=\"number\">4</span>, <span class=\"number\">5</span>));</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"comment\">//-------------------------------------------------------------------------------</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>test.js</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;test.js文件被加载了~&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mul</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> x * y;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">count</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> x - y;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://qny.aqingya.cn/img/20200716171931.png\" alt=\"\"></p>\n<p><strong>同时利用前面的inport 进行代码分割，所以有两个js文件。</strong></p>\n<p><img src=\"https://qny.aqingya.cn/img/20200716171825.png\" alt=\"\"></p>\n<p><strong>点击按钮之后才会加载test.js文件</strong></p>\n<p><img src=\"https://qny.aqingya.cn/img/20200716172037.png\" alt=\"\"></p>\n<h2 id=\"pwd-离线可访问\"><a href=\"#pwd-离线可访问\" class=\"headerlink\" title=\"pwd(离线可访问)\"></a>pwd(离线可访问)</h2><p>PWA: 渐进式网络开发应用程序(离线可访问)</p>\n<p>workbox —&gt; workbox-webpack-plugin</p>\n<p>第一步：下载插件，引入插件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cnpm i workbox-webpack-plugin -D</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//----------------------------------------------------------------------------</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> WorkboxWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;workbox-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"comment\">//----------------------------------------------------------------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\">plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> MiniCssExtractPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;css/built.[contenthash:10].css&#x27;</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> OptimizeCssAssetsWebpackPlugin(),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">minify</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">collapseWhitespace</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">removeComments</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\"><span class=\"comment\">//----------------------------------------------------------------------------</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">new</span> WorkboxWebpackPlugin.GenerateSW(&#123;</span><br><span class=\"line\">      <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        1. 帮助serviceworker快速启动</span></span><br><span class=\"line\"><span class=\"comment\">        2. 删除旧的 serviceworker</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        生成一个 serviceworker 配置文件~</span></span><br><span class=\"line\"><span class=\"comment\">      */</span></span><br><span class=\"line\">      <span class=\"attr\">clientsClaim</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      <span class=\"attr\">skipWaiting</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"comment\">//----------------------------------------------------------------------------</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  ]</span><br></pre></td></tr></table></figure>\n<p>第二步：在入口文件中注册<code>serviceWorker</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; mul &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./test&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;../css/index.css&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sum</span>(<span class=\"params\">...args</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> args.reduce(<span class=\"function\">(<span class=\"params\">p, c</span>) =&gt;</span> p + c, <span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// eslint-disable-next-line</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(mul(<span class=\"number\">2</span>, <span class=\"number\">3</span>));</span><br><span class=\"line\"><span class=\"comment\">// eslint-disable-next-line</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(sum(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>));</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//----------------------------------------------------------------------------</span></span><br><span class=\"line\"><span class=\"comment\">// 注册serviceWorker</span></span><br><span class=\"line\"><span class=\"comment\">// 处理兼容性问题</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"string\">&#x27;serviceWorker&#x27;</span> <span class=\"keyword\">in</span> navigator) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">&#x27;load&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    navigator.serviceWorker</span><br><span class=\"line\">      .register(<span class=\"string\">&#x27;/service-worker.js&#x27;</span>)</span><br><span class=\"line\">      .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//eslint-disable-next-line</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;sw注册成功了~&#x27;</span>);</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      .catch(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//eslint-disable-next-line</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;sw注册失败了~&#x27;</span>);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//----------------------------------------------------------------------------</span></span><br></pre></td></tr></table></figure>\n<p>第三步： 我们要注意一些事项</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. eslint不认识 window、navigator全局变量</span><br><span class=\"line\"> 解决：需要修改package.json中eslintConfig配置</span><br><span class=\"line\">   &quot;env&quot;: &#123;</span><br><span class=\"line\">     &quot;browser&quot;: true // 支持浏览器端全局变量</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">2. sw代码必须运行在服务器上</span><br><span class=\"line\">   --&gt; nodejs</span><br><span class=\"line\">   --&gt;</span><br><span class=\"line\">     npm i serve -g</span><br><span class=\"line\">     serve -s build 启动服务器，将build目录下所有资源作为静态资源暴露出去</span><br></pre></td></tr></table></figure>\n<p><br></p>\n<p>完整 <code>webpack.config.js</code> 中的配置：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> MiniCssExtractPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mini-css-extract-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> OptimizeCssAssetsWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;optimize-css-assets-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> WorkboxWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;workbox-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 定义nodejs环境变量：决定使用browserslist的哪个环境</span></span><br><span class=\"line\">process.env.NODE_ENV = <span class=\"string\">&#x27;production&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 复用loader</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> commonCssLoader = [</span><br><span class=\"line\">  MiniCssExtractPlugin.loader,</span><br><span class=\"line\">  <span class=\"string\">&#x27;css-loader&#x27;</span>,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 还需要在package.json中定义browserslist</span></span><br><span class=\"line\">    <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;postcss-loader&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">ident</span>: <span class=\"string\">&#x27;postcss&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">plugins</span>: <span class=\"function\">() =&gt;</span> [<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;postcss-preset-env&#x27;</span>)()]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/built.[contenthash:10].js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">module</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">rules</span>: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 在package.json中eslintConfig --&gt; airbnb</span></span><br><span class=\"line\">        <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">        exclude: <span class=\"regexp\">/node_modules/</span>,</span><br><span class=\"line\">        <span class=\"comment\">// 优先执行</span></span><br><span class=\"line\">        enforce: <span class=\"string\">&#x27;pre&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;eslint-loader&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">fix</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 以下loader只会匹配一个</span></span><br><span class=\"line\">        <span class=\"comment\">// 注意：不能有两个配置处理同一种类型文件</span></span><br><span class=\"line\">        <span class=\"attr\">oneOf</span>: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">            use: [...commonCssLoader]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.less$/</span>,</span><br><span class=\"line\">            use: [...commonCssLoader, <span class=\"string\">&#x27;less-loader&#x27;</span>]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">            正常来讲，一个文件只能被一个loader处理。</span></span><br><span class=\"line\"><span class=\"comment\">            当一个文件要被多个loader处理，那么一定要指定loader执行的先后顺序：</span></span><br><span class=\"line\"><span class=\"comment\">              先执行eslint 在执行babel</span></span><br><span class=\"line\"><span class=\"comment\">          */</span></span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">            exclude: <span class=\"regexp\">/node_modules/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;babel-loader&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">presets</span>: [</span><br><span class=\"line\">                [</span><br><span class=\"line\">                  <span class=\"string\">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class=\"line\">                  &#123;</span><br><span class=\"line\">                    <span class=\"attr\">useBuiltIns</span>: <span class=\"string\">&#x27;usage&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">corejs</span>: &#123; <span class=\"attr\">version</span>: <span class=\"number\">3</span> &#125;,</span><br><span class=\"line\">                    <span class=\"attr\">targets</span>: &#123;</span><br><span class=\"line\">                      <span class=\"attr\">chrome</span>: <span class=\"string\">&#x27;60&#x27;</span>,</span><br><span class=\"line\">                      <span class=\"attr\">firefox</span>: <span class=\"string\">&#x27;50&#x27;</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                  &#125;</span><br><span class=\"line\">                ]</span><br><span class=\"line\">              ],</span><br><span class=\"line\">              <span class=\"comment\">// 开启babel缓存</span></span><br><span class=\"line\">              <span class=\"comment\">// 第二次构建时，会读取之前的缓存</span></span><br><span class=\"line\">              <span class=\"attr\">cacheDirectory</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.(jpg|png|gif)/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;url-loader&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">limit</span>: <span class=\"number\">8</span> * <span class=\"number\">1024</span>,</span><br><span class=\"line\">              <span class=\"attr\">name</span>: <span class=\"string\">&#x27;[hash:10].[ext]&#x27;</span>,</span><br><span class=\"line\">              <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;imgs&#x27;</span>,</span><br><span class=\"line\">              <span class=\"attr\">esModule</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.html$/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;html-loader&#x27;</span></span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">exclude</span>: <span class=\"regexp\">/\\.(js|css|less|html|jpg|png|gif)/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;file-loader&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;media&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> MiniCssExtractPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;css/built.[contenthash:10].css&#x27;</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> OptimizeCssAssetsWebpackPlugin(),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">minify</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">collapseWhitespace</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">removeComments</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\"><span class=\"comment\">//----------------------------------------------------------------------------      </span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> WorkboxWebpackPlugin.GenerateSW(&#123;</span><br><span class=\"line\">      <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        1. 帮助serviceworker快速启动</span></span><br><span class=\"line\"><span class=\"comment\">        2. 删除旧的 serviceworker</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        生成一个 serviceworker 配置文件~</span></span><br><span class=\"line\"><span class=\"comment\">      */</span></span><br><span class=\"line\">      <span class=\"attr\">clientsClaim</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      <span class=\"attr\">skipWaiting</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"comment\">//----------------------------------------------------------------------------      </span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">devtool</span>: <span class=\"string\">&#x27;source-map&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"多进程打包\"><a href=\"#多进程打包\" class=\"headerlink\" title=\"多进程打包\"></a>多进程打包</h2><p>我们一般给 babel-loader 来用 ,<span style=\"background-color:yellow\">如果babel-loader处理的js文件大可以使用，如果较小，不推荐使用多进程打包。</span></p>\n<p>1、下载安装包</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cnpm install  thread-loader -D</span><br></pre></td></tr></table></figure>\n<p>2、修改配置文件</p>\n<p>原配置文件：babel-loader</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200716191203.png\" alt=\"\"></p>\n<p>配置之后的文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> MiniCssExtractPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mini-css-extract-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> OptimizeCssAssetsWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;optimize-css-assets-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> WorkboxWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;workbox-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 定义nodejs环境变量：决定使用browserslist的哪个环境</span></span><br><span class=\"line\">process.env.NODE_ENV = <span class=\"string\">&#x27;production&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 复用loader</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> commonCssLoader = [</span><br><span class=\"line\">  MiniCssExtractPlugin.loader,</span><br><span class=\"line\">  <span class=\"string\">&#x27;css-loader&#x27;</span>,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 还需要在package.json中定义browserslist</span></span><br><span class=\"line\">    <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;postcss-loader&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">ident</span>: <span class=\"string\">&#x27;postcss&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">plugins</span>: <span class=\"function\">() =&gt;</span> [<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;postcss-preset-env&#x27;</span>)()]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/built.[contenthash:10].js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">module</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">rules</span>: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 在package.json中eslintConfig --&gt; airbnb</span></span><br><span class=\"line\">        <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">        exclude: <span class=\"regexp\">/node_modules/</span>,</span><br><span class=\"line\">        <span class=\"comment\">// 优先执行</span></span><br><span class=\"line\">        enforce: <span class=\"string\">&#x27;pre&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;eslint-loader&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">fix</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 以下loader只会匹配一个</span></span><br><span class=\"line\">        <span class=\"comment\">// 注意：不能有两个配置处理同一种类型文件</span></span><br><span class=\"line\">        <span class=\"attr\">oneOf</span>: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">            use: [...commonCssLoader]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.less$/</span>,</span><br><span class=\"line\">            use: [...commonCssLoader, <span class=\"string\">&#x27;less-loader&#x27;</span>]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">            正常来讲，一个文件只能被一个loader处理。</span></span><br><span class=\"line\"><span class=\"comment\">            当一个文件要被多个loader处理，那么一定要指定loader执行的先后顺序：</span></span><br><span class=\"line\"><span class=\"comment\">              先执行eslint 在执行babel</span></span><br><span class=\"line\"><span class=\"comment\">          */</span></span><br><span class=\"line\">            </span><br><span class=\"line\"> <span class=\"comment\">//------------------------------------------------------------------------------</span></span><br><span class=\"line\">            </span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">            exclude: <span class=\"regexp\">/node_modules/</span>,</span><br><span class=\"line\">            use: [</span><br><span class=\"line\">              <span class=\"comment\">/* </span></span><br><span class=\"line\"><span class=\"comment\">                开启多进程打包。 </span></span><br><span class=\"line\"><span class=\"comment\">                进程启动大概为600ms，进程通信也有开销。</span></span><br><span class=\"line\"><span class=\"comment\">                只有工作消耗时间比较长，才需要多进程打包</span></span><br><span class=\"line\"><span class=\"comment\">              */</span></span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;thread-loader&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                  <span class=\"attr\">workers</span>: <span class=\"number\">2</span> <span class=\"comment\">// 进程2个</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;babel-loader&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                  <span class=\"attr\">presets</span>: [</span><br><span class=\"line\">                    [</span><br><span class=\"line\">                      <span class=\"string\">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class=\"line\">                      &#123;</span><br><span class=\"line\">                        <span class=\"attr\">useBuiltIns</span>: <span class=\"string\">&#x27;usage&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">corejs</span>: &#123; <span class=\"attr\">version</span>: <span class=\"number\">3</span> &#125;,</span><br><span class=\"line\">                        <span class=\"attr\">targets</span>: &#123;</span><br><span class=\"line\">                          <span class=\"attr\">chrome</span>: <span class=\"string\">&#x27;60&#x27;</span>,</span><br><span class=\"line\">                          <span class=\"attr\">firefox</span>: <span class=\"string\">&#x27;50&#x27;</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                      &#125;</span><br><span class=\"line\">                    ]</span><br><span class=\"line\">                  ],</span><br><span class=\"line\">                  <span class=\"comment\">// 开启babel缓存</span></span><br><span class=\"line\">                  <span class=\"comment\">// 第二次构建时，会读取之前的缓存</span></span><br><span class=\"line\">                  <span class=\"attr\">cacheDirectory</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\"> <span class=\"comment\">//------------------------------------------------------------------------------</span></span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.(jpg|png|gif)/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;url-loader&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">limit</span>: <span class=\"number\">8</span> * <span class=\"number\">1024</span>,</span><br><span class=\"line\">              <span class=\"attr\">name</span>: <span class=\"string\">&#x27;[hash:10].[ext]&#x27;</span>,</span><br><span class=\"line\">              <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;imgs&#x27;</span>,</span><br><span class=\"line\">              <span class=\"attr\">esModule</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.html$/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;html-loader&#x27;</span></span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">exclude</span>: <span class=\"regexp\">/\\.(js|css|less|html|jpg|png|gif)/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;file-loader&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;media&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> MiniCssExtractPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;css/built.[contenthash:10].css&#x27;</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> OptimizeCssAssetsWebpackPlugin(),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">minify</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">collapseWhitespace</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">removeComments</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> WorkboxWebpackPlugin.GenerateSW(&#123;</span><br><span class=\"line\">      <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        1. 帮助serviceworker快速启动</span></span><br><span class=\"line\"><span class=\"comment\">        2. 删除旧的 serviceworker</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        生成一个 serviceworker 配置文件~</span></span><br><span class=\"line\"><span class=\"comment\">      */</span></span><br><span class=\"line\">      <span class=\"attr\">clientsClaim</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      <span class=\"attr\">skipWaiting</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">devtool</span>: <span class=\"string\">&#x27;source-map&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"externals\"><a href=\"#externals\" class=\"headerlink\" title=\"externals\"></a>externals</h2><p>彻底不打包，通过一些外链的cdn ：jQuery，vue等等，用到时需用用cdn引入。</p>\n<p>然后禁止一些包不会被打包到最后输出的 built.js 中，</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200716194524.png\" alt=\"\"></p>\n<p>修改配置文件：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/built.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span>,</span><br><span class=\"line\">  <span class=\"comment\">//------------------------------------------------------------------------------</span></span><br><span class=\"line\">  <span class=\"attr\">externals</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 拒绝jQuery被打包进来</span></span><br><span class=\"line\">    <span class=\"attr\">jquery</span>: <span class=\"string\">&#x27;jQuery&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">//------------------------------------------------------------------------------</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"dll\"><a href=\"#dll\" class=\"headerlink\" title=\"dll\"></a>dll</h2><p>对第三方库进行打包，需要打包，打包一次，将来不用重复打包。所以使我们第二次打包的时候，变得很快，因为少了第三方库的打包。</p>\n<p>第一步：创建 <code>webpack.dll.js</code>文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">使用dll技术，对某些库（第三方库：jquery、react、vue...）进行单独打包</span><br><span class=\"line\">  当你运行 webpack 时，默认查找 webpack.config.js 配置文件</span><br><span class=\"line\">  需求：需要运行 webpack.dll.js 文件</span><br><span class=\"line\">    --&gt; webpack --config webpack.dll.js</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;webpack&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"attr\">entry</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 最终打包生成的[name] --&gt; jquery</span></span><br><span class=\"line\">    <span class=\"comment\">// [&#x27;jquery&#x27;] --&gt; 要打包的库是jquery</span></span><br><span class=\"line\">    <span class=\"attr\">jquery</span>: [<span class=\"string\">&#x27;jquery&#x27;</span>],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;[name].js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;dll&#x27;</span>),</span><br><span class=\"line\">    <span class=\"attr\">library</span>: <span class=\"string\">&#x27;[name]_[hash]&#x27;</span> <span class=\"comment\">// 打包的库里面向外暴露出去的内容叫什么名字</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"comment\">// 打包生成一个 manifest.json --&gt; 提供和jquery映射</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> webpack.DllPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">name</span>: <span class=\"string\">&#x27;[name]_[hash]&#x27;</span>, <span class=\"comment\">// 映射库的暴露的内容名称</span></span><br><span class=\"line\">      <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;dll/manifest.json&#x27;</span>) <span class=\"comment\">// 输出文件路径</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>运行命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpack --config webpack.dll.js</span><br></pre></td></tr></table></figure>\n<p>生成dll文件夹</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200716214613.png\" alt=\"\"></p>\n<p><code>jquery.js</code>是要打包的库是jquery，<code>manifest.json</code> 是 提供和jquery映射,这样以后jquery就不用重复打包了。</p>\n<p>第二步：</p>\n<p>下载一个插件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cnpm i add-asset-html-webpack-plugin -D</span><br></pre></td></tr></table></figure>\n<p>告诉webpack哪些库不参与打包，同时使用时的名称也得变~</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">manifest</span>: resolve(__dirname, <span class=\"string\">&#x27;dll/manifest.json&#x27;</span>)</span><br><span class=\"line\">    &#125;),</span><br></pre></td></tr></table></figure>\n<p>将某个文件打包输出去，并在html中自动引入该资源</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> AddAssetHtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">filepath</span>: resolve(__dirname, <span class=\"string\">&#x27;dll/jquery.js&#x27;</span>)</span><br><span class=\"line\">    &#125;)</span><br></pre></td></tr></table></figure>\n<p>修改<code>webpack.config.js</code> 中的配置：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;webpack&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> AddAssetHtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;add-asset-html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;./src/index.js&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;built.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"comment\">//--------------------------------------------------------------------------</span></span><br><span class=\"line\">    <span class=\"comment\">// 告诉webpack哪些库不参与打包，同时使用时的名称也得变~</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">manifest</span>: resolve(__dirname, <span class=\"string\">&#x27;dll/manifest.json&#x27;</span>)</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"comment\">// 将某个文件打包输出去，并在html中自动引入该资源</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> AddAssetHtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">filepath</span>: resolve(__dirname, <span class=\"string\">&#x27;dll/jquery.js&#x27;</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">//--------------------------------------------------------------------------</span></span><br><span class=\"line\">      </span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><h2 id=\"webpack性能优化\"><a href=\"#webpack性能优化\" class=\"headerlink\" title=\"webpack性能优化\"></a>webpack性能优化</h2><ul>\n<li><p>开发环境性能优化</p>\n</li>\n<li><p>生产环境性能优化</p>\n</li>\n</ul>\n<h2 id=\"开发环境性能优化\"><a href=\"#开发环境性能优化\" class=\"headerlink\" title=\"开发环境性能优化\"></a>开发环境性能优化</h2><ul>\n<li>优化打包构建速度<ul>\n<li>HMR</li>\n</ul>\n</li>\n<li>优化代码调试<ul>\n<li>source-map</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"生产环境性能优化\"><a href=\"#生产环境性能优化\" class=\"headerlink\" title=\"生产环境性能优化\"></a>生产环境性能优化</h2><ul>\n<li>优化打包构建速度<ul>\n<li>oneOf</li>\n<li>babel缓存</li>\n<li>多进程打包</li>\n<li>externals</li>\n<li>dll</li>\n</ul>\n</li>\n<li>优化代码运行的性能<ul>\n<li>缓存(hash-chunkhash-contenthash)</li>\n<li>tree shaking</li>\n<li>code split</li>\n<li>懒加载/预加载</li>\n<li>pwa</li>\n</ul>\n</li>\n</ul>\n","more":"<h1 id=\"webpack-性能优化\"><a href=\"#webpack-性能优化\" class=\"headerlink\" title=\"webpack 性能优化\"></a>webpack 性能优化</h1><h2 id=\"HMR-（热模块替换）\"><a href=\"#HMR-（热模块替换）\" class=\"headerlink\" title=\"HMR （热模块替换）\"></a>HMR （热模块替换）</h2><p>HMR: hot module replacement 热模块替换 / 模块热替换</p>\n<p>作用：一个模块发生变化，只会重新打包这一个模块（而不是打包所有模块） </p>\n<p>极大提升构建速度</p>\n<p>1、<strong>样式文件</strong>：可以使用HMR功能：因为style-loader内部实现了~</p>\n<p>2、<strong>js文件</strong>：默认不能使用HMR功能 —&gt; 需要修改js代码，添加支持HMR功能的代码</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"built_in\">module</span>.hot) &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 一旦 module.hot 为true，说明开启了HMR功能。 --&gt; 让HMR功能代码生效</span></span><br><span class=\"line\">    <span class=\"built_in\">module</span>.hot.accept(<span class=\"string\">&#x27;./print.js&#x27;</span>, <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"comment\">// 方法会监听 print.js 文件的变化，一旦发生变化，其他模块不会重新打包构建。</span></span><br><span class=\"line\">        <span class=\"comment\">// 会执行后面的回调函数</span></span><br><span class=\"line\">        <span class=\"comment\">//print();</span></span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n<p><strong><span style=\"background-color:yellow\">注意：HMR功能对js的处理，只能处理非入口js文件的其他文件。</span></strong></p>\n<p>3、<strong>html文件</strong>: 默认不能使用HMR功能.同时会导致问题：html文件不能热更新了~ （不用做HMR功能）</p>\n<p>​    解决：修改entry入口，将html文件引入</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">entry: [<span class=\"string\">&#x27;./src/js/index.js&#x27;</span>, <span class=\"string\">&#x27;./src/index.html&#x27;</span>]</span><br></pre></td></tr></table></figure>\n<p><br></p>\n<p>修改配置文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//修改entry入口，将html文件引入</span></span><br><span class=\"line\">    <span class=\"attr\">entry</span>: [<span class=\"string\">&#x27;./src/js/index.js&#x27;</span>, <span class=\"string\">&#x27;./src/index.html&#x27;</span>],</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/built.js&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">module</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">rules</span>: [</span><br><span class=\"line\">            <span class=\"comment\">// loader的配置</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理less资源</span></span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.less$/</span>,</span><br><span class=\"line\">                use: [<span class=\"string\">&#x27;style-loader&#x27;</span>, <span class=\"string\">&#x27;css-loader&#x27;</span>, <span class=\"string\">&#x27;less-loader&#x27;</span>]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理css资源</span></span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">                use: [<span class=\"string\">&#x27;style-loader&#x27;</span>, <span class=\"string\">&#x27;css-loader&#x27;</span>]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理图片资源</span></span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.(jpg|png|gif)$/</span>,</span><br><span class=\"line\">                loader: <span class=\"string\">&#x27;url-loader&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">limit</span>: <span class=\"number\">8</span> * <span class=\"number\">1024</span>,</span><br><span class=\"line\">                    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;[hash:10].[ext]&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"comment\">// 关闭es6模块化</span></span><br><span class=\"line\">                    <span class=\"attr\">esModule</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">                    <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;imgs&#x27;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理html中img资源</span></span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.html$/</span>,</span><br><span class=\"line\">                loader: <span class=\"string\">&#x27;html-loader&#x27;</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理其他资源</span></span><br><span class=\"line\">                <span class=\"attr\">exclude</span>: <span class=\"regexp\">/\\.(html|js|css|less|jpg|png|gif)/</span>,</span><br><span class=\"line\">                loader: <span class=\"string\">&#x27;file-loader&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;[hash:10].[ext]&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;media&#x27;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">        <span class=\"comment\">// plugins的配置</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">            <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span></span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;development&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">devServer</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">contentBase</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>),</span><br><span class=\"line\">        <span class=\"attr\">compress</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">port</span>: <span class=\"number\">3000</span>,</span><br><span class=\"line\">        <span class=\"attr\">open</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"comment\">// 开启HMR功能</span></span><br><span class=\"line\">        <span class=\"comment\">// 当修改了webpack配置，新配置要想生效，必须重新webpack服务</span></span><br><span class=\"line\">        <span class=\"attr\">hot</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p> 在<code>devServer</code>中开启hot就可以。</p>\n<h2 id=\"source-map\"><a href=\"#source-map\" class=\"headerlink\" title=\"source-map\"></a>source-map</h2><p> <strong>source-map:</strong> <span style=\"background-color:yellow\">一种 提供源代码到构建后代码映射 技术 （如果构建后代码出错了，通过映射可以追踪源代码错误）</span></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">[inline-|hidden-|eval-][nosources-][cheap-[module-]]source-map  //devtool属性的值</span><br></pre></td></tr></table></figure>\n<p><br></p>\n<p>  source-map：外部</p>\n<p>   &emsp;&emsp;错误代码准确信息 和 源代码的错误位置</p>\n<p>  inline-source-map：内联</p>\n<p>   &emsp;&emsp;只生成一个内联source-map</p>\n<p>   &emsp;&emsp;错误代码准确信息 和 源代码的错误位置</p>\n<p>  hidden-source-map：外部</p>\n<p>   &emsp;&emsp;错误代码错误原因，但是没有错误位置</p>\n<p>   &emsp;&emsp;不能追踪源代码错误，只能提示到构建后代码的错误位置</p>\n<p>  eval-source-map：内联</p>\n<p>   &emsp;&emsp;每一个文件都生成对应的source-map，都在eval</p>\n<p>   &emsp;&emsp;错误代码准确信息 和 源代码的错误位置</p>\n<p>  nosources-source-map：外部</p>\n<p>  &emsp;&emsp; 错误代码准确信息, 但是没有任何源代码信息</p>\n<p>  cheap-source-map：外部</p>\n<p>   &emsp;&emsp;错误代码准确信息 和 源代码的错误位置 </p>\n<p>   &emsp;&emsp;只能精确的行</p>\n<p>  cheap-module-source-map：外部</p>\n<p>   &emsp;&emsp;错误代码准确信息 和 源代码的错误位置 </p>\n<p>   &emsp;&emsp;module会将loader的source map加入</p>\n<p><br></p>\n<p>  <strong><span style=\"color:red\">内联 和 外部的区别：1. 外部生成了文件，内联没有 2. 内联构建速度更快</span></strong></p>\n<p><br></p>\n<p>  开发环境：速度快，调试更友好</p>\n<p>   速度快(eval&gt;inline&gt;cheap&gt;…)</p>\n<p>   &emsp;&emsp; eval-cheap-souce-map &emsp;&emsp; 速度最快</p>\n<p>  &emsp;&emsp;  eval-source-map&emsp;&emsp;速度其次，<strong>在开发环境中推荐使用</strong>，vue中的脚手架也是采用的eval-source-map</p>\n<p>   调试更友好 </p>\n<p>​    &emsp;&emsp;souce-map</p>\n<p> &emsp;&emsp;   cheap-module-souce-map</p>\n<p> &emsp;&emsp;   cheap-souce-map</p>\n<p><span style=\"background-color:yellow\">eval-source-map / eval-cheap-module-souce-map</span></p>\n<p><br></p>\n<p>  生产环境：源代码要不要隐藏? 调试要不要更友好</p>\n<p>   内联会让代码体积变大，所以在生产环境不用内联</p>\n<p>   &emsp;&emsp;nosources-source-map &emsp;&emsp;全部隐藏</p>\n<p>   &emsp;&emsp;hidden-source-map &emsp;&emsp;只隐藏源代码，会提示构建后代码错误信息</p>\n<p><span style=\"background-color:yellow\">source-map / cheap-module-souce-map</span></p>\n<p><br></p>\n<p>修改配置：<span style=\"background-color:yellow\">在<code>module.exports</code>中加入<code>devtool</code>属性即可</span></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  开发环境配置：能让代码运行</span></span><br><span class=\"line\"><span class=\"comment\">    运行项目指令：</span></span><br><span class=\"line\"><span class=\"comment\">      webpack 会将打包结果输出出去</span></span><br><span class=\"line\"><span class=\"comment\">      npx webpack-dev-server 只会在内存中编译打包，没有输出</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    <span class=\"attr\">entry</span>: [<span class=\"string\">&#x27;./src/js/index.js&#x27;</span>, <span class=\"string\">&#x27;./src/index.html&#x27;</span>],</span><br><span class=\"line\">    <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/built.js&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">module</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">rules</span>: [</span><br><span class=\"line\">            <span class=\"comment\">// loader的配置</span></span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理less资源</span></span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.less$/</span>,</span><br><span class=\"line\">                use: [<span class=\"string\">&#x27;style-loader&#x27;</span>, <span class=\"string\">&#x27;css-loader&#x27;</span>, <span class=\"string\">&#x27;less-loader&#x27;</span>]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理css资源</span></span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">                use: [<span class=\"string\">&#x27;style-loader&#x27;</span>, <span class=\"string\">&#x27;css-loader&#x27;</span>]</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理图片资源</span></span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.(jpg|png|gif)$/</span>,</span><br><span class=\"line\">                loader: <span class=\"string\">&#x27;url-loader&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">limit</span>: <span class=\"number\">8</span> * <span class=\"number\">1024</span>,</span><br><span class=\"line\">                    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;[hash:10].[ext]&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"comment\">// 关闭es6模块化</span></span><br><span class=\"line\">                    <span class=\"attr\">esModule</span>: <span class=\"literal\">false</span>,</span><br><span class=\"line\">                    <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;imgs&#x27;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理html中img资源</span></span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.html$/</span>,</span><br><span class=\"line\">                loader: <span class=\"string\">&#x27;html-loader&#x27;</span></span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 处理其他资源</span></span><br><span class=\"line\">                <span class=\"attr\">exclude</span>: <span class=\"regexp\">/\\.(html|js|css|less|jpg|png|gif)/</span>,</span><br><span class=\"line\">                loader: <span class=\"string\">&#x27;file-loader&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">name</span>: <span class=\"string\">&#x27;[hash:10].[ext]&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;media&#x27;</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">        <span class=\"comment\">// plugins的配置</span></span><br><span class=\"line\">        <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">            <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">minify</span>: &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 移除空格</span></span><br><span class=\"line\">                <span class=\"attr\">collapseWhitespace</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">                <span class=\"comment\">// 移除注释</span></span><br><span class=\"line\">                <span class=\"attr\">removeComments</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;development&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">devServer</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">contentBase</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>),</span><br><span class=\"line\">        <span class=\"attr\">compress</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">port</span>: <span class=\"number\">3000</span>,</span><br><span class=\"line\">        <span class=\"attr\">open</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">hot</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"comment\">//配置source-map</span></span><br><span class=\"line\">    <span class=\"attr\">devtool</span>: <span class=\"string\">&#x27;eval-source-map&#x27;</span></span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"oneOf\"><a href=\"#oneOf\" class=\"headerlink\" title=\"oneOf\"></a>oneOf</h2><p>配置完oneOf，它以下的loader只会匹配一个<br><span style=\"background-color:yellow\">注意：不能有两个配置处理同一种类型文件,如果有就将一个提取上去，放外面就好了。</span></p>\n<p>修改配置文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> MiniCssExtractPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mini-css-extract-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> OptimizeCssAssetsWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;optimize-css-assets-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 定义nodejs环境变量：决定使用browserslist的哪个环境</span></span><br><span class=\"line\">process.env.NODE_ENV = <span class=\"string\">&#x27;production&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 复用loader</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> commonCssLoader = [</span><br><span class=\"line\">  MiniCssExtractPlugin.loader,</span><br><span class=\"line\">  <span class=\"string\">&#x27;css-loader&#x27;</span>,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 还需要在package.json中定义browserslist</span></span><br><span class=\"line\">    <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;postcss-loader&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">ident</span>: <span class=\"string\">&#x27;postcss&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">plugins</span>: <span class=\"function\">() =&gt;</span> [<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;postcss-preset-env&#x27;</span>)()]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/built.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">module</span>: &#123;</span><br><span class=\"line\">      </span><br><span class=\"line\">  <span class=\"comment\">//-----------------------------------------------------------------------    </span></span><br><span class=\"line\">    <span class=\"attr\">rules</span>: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 在package.json中eslintConfig --&gt; airbnb</span></span><br><span class=\"line\">        <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">        exclude: <span class=\"regexp\">/node_modules/</span>,</span><br><span class=\"line\">        <span class=\"comment\">// 优先执行</span></span><br><span class=\"line\">        enforce: <span class=\"string\">&#x27;pre&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;eslint-loader&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">fix</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">        </span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 以下loader只会匹配一个</span></span><br><span class=\"line\">        <span class=\"comment\">// 注意：不能有两个配置处理同一种类型文件,如果有就将一个提取上去，放外面就好了。</span></span><br><span class=\"line\">        <span class=\"attr\">oneOf</span>: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">            use: [...commonCssLoader]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.less$/</span>,</span><br><span class=\"line\">            use: [...commonCssLoader, <span class=\"string\">&#x27;less-loader&#x27;</span>]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">            正常来讲，一个文件只能被一个loader处理。</span></span><br><span class=\"line\"><span class=\"comment\">            当一个文件要被多个loader处理，那么一定要指定loader执行的先后顺序：</span></span><br><span class=\"line\"><span class=\"comment\">              先执行eslint 在执行babel</span></span><br><span class=\"line\"><span class=\"comment\">          */</span></span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">            exclude: <span class=\"regexp\">/node_modules/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;babel-loader&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">presets</span>: [</span><br><span class=\"line\">                [</span><br><span class=\"line\">                  <span class=\"string\">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class=\"line\">                  &#123;</span><br><span class=\"line\">                    <span class=\"attr\">useBuiltIns</span>: <span class=\"string\">&#x27;usage&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">corejs</span>: &#123;<span class=\"attr\">version</span>: <span class=\"number\">3</span>&#125;,</span><br><span class=\"line\">                    <span class=\"attr\">targets</span>: &#123;</span><br><span class=\"line\">                      <span class=\"attr\">chrome</span>: <span class=\"string\">&#x27;60&#x27;</span>,</span><br><span class=\"line\">                      <span class=\"attr\">firefox</span>: <span class=\"string\">&#x27;50&#x27;</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                  &#125;</span><br><span class=\"line\">                ]</span><br><span class=\"line\">              ]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.(jpg|png|gif)/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;url-loader&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">limit</span>: <span class=\"number\">8</span> * <span class=\"number\">1024</span>,</span><br><span class=\"line\">              <span class=\"attr\">name</span>: <span class=\"string\">&#x27;[hash:10].[ext]&#x27;</span>,</span><br><span class=\"line\">              <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;imgs&#x27;</span>,</span><br><span class=\"line\">              <span class=\"attr\">esModule</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.html$/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;html-loader&#x27;</span></span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">exclude</span>: <span class=\"regexp\">/\\.(js|css|less|html|jpg|png|gif)/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;file-loader&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;media&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">      </span><br><span class=\"line\">   <span class=\"comment\">//-----------------------------------------------------------------------       </span></span><br><span class=\"line\">      </span><br><span class=\"line\">      </span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> MiniCssExtractPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;css/built.css&#x27;</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> OptimizeCssAssetsWebpackPlugin(),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">minify</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">collapseWhitespace</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">removeComments</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"缓存\"><a href=\"#缓存\" class=\"headerlink\" title=\"缓存\"></a>缓存</h2><p>主要针对生产环境的缓存</p>\n<p><span style=\"background-color:yellow\">注意：有可能是面试题 注意。</span></p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">缓存：</span><br><span class=\"line\">  babel缓存</span><br><span class=\"line\">    cacheDirectory: true</span><br><span class=\"line\">    --&gt; 让第二次打包构建速度更快</span><br><span class=\"line\">    </span><br><span class=\"line\">  文件资源缓存  修改 filename: &#x27;js/built.[contenthash:10].js&#x27;</span><br><span class=\"line\">    hash: 每次wepack构建时会生成一个唯一的hash值。</span><br><span class=\"line\">      问题: 因为js和css同时使用一个hash值。</span><br><span class=\"line\">        如果重新打包，会导致所有缓存失效。（可能我却只改动一个文件）</span><br><span class=\"line\">    chunkhash：根据chunk生成的hash值。如果打包来源于同一个chunk，那么hash值就一样</span><br><span class=\"line\">      问题: js和css的hash值还是一样的</span><br><span class=\"line\">        因为css是在js中被引入的，所以同属于一个chunk</span><br><span class=\"line\">    contenthash: 根据文件的内容生成hash值。不同文件hash值一定不一样    </span><br><span class=\"line\">    --&gt; 让代码上线运行缓存更好使用</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>设置配置文件：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> MiniCssExtractPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mini-css-extract-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> OptimizeCssAssetsWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;optimize-css-assets-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 定义nodejs环境变量：决定使用browserslist的哪个环境</span></span><br><span class=\"line\">process.env.NODE_ENV = <span class=\"string\">&#x27;production&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 复用loader</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> commonCssLoader = [</span><br><span class=\"line\">    MiniCssExtractPlugin.loader,</span><br><span class=\"line\">    <span class=\"string\">&#x27;css-loader&#x27;</span>,</span><br><span class=\"line\">    &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 还需要在package.json中定义browserslist</span></span><br><span class=\"line\">        <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;postcss-loader&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">            <span class=\"attr\">ident</span>: <span class=\"string\">&#x27;postcss&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">plugins</span>: <span class=\"function\">() =&gt;</span> [<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;postcss-preset-env&#x27;</span>)()]</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">        <span class=\"comment\">//------------------------------------------------------</span></span><br><span class=\"line\">        <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/built.[contenthash:10].js&#x27;</span>,</span><br><span class=\"line\">        <span class=\"comment\">//------------------------------------------------------</span></span><br><span class=\"line\">        <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">module</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">rules</span>: [&#123;</span><br><span class=\"line\">                <span class=\"comment\">// 在package.json中eslintConfig --&gt; airbnb</span></span><br><span class=\"line\">                <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">                exclude: <span class=\"regexp\">/node_modules/</span>,</span><br><span class=\"line\">                <span class=\"comment\">// 优先执行</span></span><br><span class=\"line\">                enforce: <span class=\"string\">&#x27;pre&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;eslint-loader&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                    <span class=\"attr\">fix</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">            &#125;,</span><br><span class=\"line\">            &#123;</span><br><span class=\"line\">                <span class=\"comment\">// 以下loader只会匹配一个</span></span><br><span class=\"line\">                <span class=\"comment\">// 注意：不能有两个配置处理同一种类型文件</span></span><br><span class=\"line\">                <span class=\"attr\">oneOf</span>: [&#123;</span><br><span class=\"line\">                        <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">                        use: [...commonCssLoader]</span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.less$/</span>,</span><br><span class=\"line\">                        use: [...commonCssLoader, <span class=\"string\">&#x27;less-loader&#x27;</span>]</span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">                      正常来讲，一个文件只能被一个loader处理。</span></span><br><span class=\"line\"><span class=\"comment\">                      当一个文件要被多个loader处理，那么一定要指定loader执行的先后顺序：</span></span><br><span class=\"line\"><span class=\"comment\">                        先执行eslint 在执行babel</span></span><br><span class=\"line\"><span class=\"comment\">                    */</span></span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">                        exclude: <span class=\"regexp\">/node_modules/</span>,</span><br><span class=\"line\">                        loader: <span class=\"string\">&#x27;babel-loader&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                            <span class=\"attr\">presets</span>: [</span><br><span class=\"line\">                                [</span><br><span class=\"line\">                                    <span class=\"string\">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class=\"line\">                                    &#123;</span><br><span class=\"line\">                                        <span class=\"attr\">useBuiltIns</span>: <span class=\"string\">&#x27;usage&#x27;</span>,</span><br><span class=\"line\">                                        <span class=\"attr\">corejs</span>: &#123; <span class=\"attr\">version</span>: <span class=\"number\">3</span> &#125;,</span><br><span class=\"line\">                                        <span class=\"attr\">targets</span>: &#123;</span><br><span class=\"line\">                                            <span class=\"attr\">chrome</span>: <span class=\"string\">&#x27;60&#x27;</span>,</span><br><span class=\"line\">                                            <span class=\"attr\">firefox</span>: <span class=\"string\">&#x27;50&#x27;</span></span><br><span class=\"line\">                                        &#125;</span><br><span class=\"line\">                                    &#125;</span><br><span class=\"line\">                                ]</span><br><span class=\"line\">                            ],</span><br><span class=\"line\">                            </span><br><span class=\"line\">                    <span class=\"comment\">//------------------------------------------------        </span></span><br><span class=\"line\">                            <span class=\"comment\">// 开启babel缓存</span></span><br><span class=\"line\">                            <span class=\"comment\">// 第二次构建时，会读取之前的缓存</span></span><br><span class=\"line\">                            <span class=\"attr\">cacheDirectory</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">                    <span class=\"comment\">//------------------------------------------------ </span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.(jpg|png|gif)/</span>,</span><br><span class=\"line\">                        loader: <span class=\"string\">&#x27;url-loader&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                            <span class=\"attr\">limit</span>: <span class=\"number\">8</span> * <span class=\"number\">1024</span>,</span><br><span class=\"line\">                            <span class=\"attr\">name</span>: <span class=\"string\">&#x27;[hash:10].[ext]&#x27;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;imgs&#x27;</span>,</span><br><span class=\"line\">                            <span class=\"attr\">esModule</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.html$/</span>,</span><br><span class=\"line\">                        loader: <span class=\"string\">&#x27;html-loader&#x27;</span></span><br><span class=\"line\">                    &#125;,</span><br><span class=\"line\">                    &#123;</span><br><span class=\"line\">                        <span class=\"attr\">exclude</span>: <span class=\"regexp\">/\\.(js|css|less|html|jpg|png|gif)/</span>,</span><br><span class=\"line\">                        loader: <span class=\"string\">&#x27;file-loader&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                            <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;media&#x27;</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                ]</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">    &#125;,</span><br><span class=\"line\">    <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">        <span class=\"keyword\">new</span> MiniCssExtractPlugin(&#123;</span><br><span class=\"line\">            <span class=\"comment\">//------------------------------------------------ </span></span><br><span class=\"line\">            <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;css/built.[contenthash:10].css&#x27;</span></span><br><span class=\"line\">            <span class=\"comment\">//------------------------------------------------ </span></span><br><span class=\"line\">        &#125;),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> OptimizeCssAssetsWebpackPlugin(),</span><br><span class=\"line\">        <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">            <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">minify</span>: &#123;</span><br><span class=\"line\">                <span class=\"attr\">collapseWhitespace</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">                <span class=\"attr\">removeComments</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;)</span><br><span class=\"line\">    ],</span><br><span class=\"line\">    <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">devtool</span>: <span class=\"string\">&#x27;source-map&#x27;</span></span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<h2 id=\"tree-shaking\"><a href=\"#tree-shaking\" class=\"headerlink\" title=\"tree shaking\"></a>tree shaking</h2><p>  <strong>tree shaking</strong>：去除无用代码<br>    &emsp;&emsp;前提：1. 必须使用ES6模块化  2. 开启production环境<br>    &emsp;&emsp;作用: 减少代码体积</p>\n<p><br></p>\n<p><span style=\"background-color:yellow\">在package.json中配置 </span><br>&emsp;&emsp;  “sideEffects”: false 所有代码都没有副作用（都可以进行tree shaking）<br>  &emsp;&emsp;  <strong>问题</strong>：可能会把css / @babel/polyfill （副作用）文件干掉<br>&emsp;&emsp;  “sideEffects”: [“<em>.css”, “</em>.less”]</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&quot;sideEffects&quot;: [&quot;*.css&quot;, &quot;*.less&quot;]</span><br></pre></td></tr></table></figure>\n<h2 id=\"code-split-代码分割\"><a href=\"#code-split-代码分割\" class=\"headerlink\" title=\"code split (代码分割)\"></a>code split (代码分割)</h2><p>将一个大的js代码块 分割成多个小的代码块，并行加载，总而加快速度。</p>\n<p>有三种分割方式：</p>\n<h3 id=\"第一种\"><a href=\"#第一种\" class=\"headerlink\" title=\"第一种\"></a>第一种</h3><p>有两种配置</p>\n<p>1、单入口   —-默认输出单个文件</p>\n<p>2、多入口   —-有几个入口输出几个入口</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200716155656.png\" alt=\"\"></p>\n<p>修改配置文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">  <span class=\"comment\">// 单入口</span></span><br><span class=\"line\">  <span class=\"comment\">// entry: &#x27;./src/js/index.js&#x27;,</span></span><br><span class=\"line\">  <span class=\"attr\">entry</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 多入口：有一个入口，最终输出就有一个bundle</span></span><br><span class=\"line\">    <span class=\"attr\">index</span>: <span class=\"string\">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">test</span>: <span class=\"string\">&#x27;./src/js/test.js&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// [name]：取文件名</span></span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/[name].[contenthash:10].js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">minify</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">collapseWhitespace</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">removeComments</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"第二种\"><a href=\"#第二种\" class=\"headerlink\" title=\"第二种\"></a>第二种</h3><p>有两种配置</p>\n<p>1、单入口   —-只将node_modules中代码封装打包</p>\n<p>2、多入口   —-除了打包node_modules中代码，还会分析这些多入口有没有公共的依赖。<strong>如果有会打包成单独一个chunk</strong></p>\n<p><span style=\"background-color:yellow\">第二种分割代码不经常使用</span></p>\n<p>我们在index.js和test.js中都引入jquery。</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200717090022.png\" alt=\"\"></p>\n<p>修改配置文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">  <span class=\"comment\">// 单入口</span></span><br><span class=\"line\">  <span class=\"comment\">// entry: &#x27;./src/js/index.js&#x27;,</span></span><br><span class=\"line\">  <span class=\"attr\">entry</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">index</span>: <span class=\"string\">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">test</span>: <span class=\"string\">&#x27;./src/js/test.js&#x27;</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// [name]：取文件名</span></span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/[name].[contenthash:10].js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">minify</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">collapseWhitespace</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">removeComments</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ],</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">  <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    1. 可以将node_modules中代码单独打包一个chunk最终输出</span></span><br><span class=\"line\"><span class=\"comment\">    2. 自动分析多入口chunk中，有没有公共的文件。如果有会打包成单独一个chunk</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\">  <span class=\"attr\">optimization</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">splitChunks</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">chunks</span>: <span class=\"string\">&#x27;all&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\">    </span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h3 id=\"第三种（常用）\"><a href=\"#第三种（常用）\" class=\"headerlink\" title=\"第三种（常用）\"></a>第三种（常用）</h3><p>1、我们一般采用单入口，配合<code>optimization</code>,将node_modules中代码单独打包一个chunk，</p>\n<p>2、其次我们还希望其他的js文件可以单独打包成一个文件，这样我们就使用js代码来实现。如：在头入口index.js中这样写。</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">  通过js代码，让某个文件被单独打包成一个chunk</span></span><br><span class=\"line\"><span class=\"comment\">  import动态导入语法：能将某个文件单独打包</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"comment\">//webpackChunkName: &#x27;test&#x27; 为它取一个名字。</span></span><br><span class=\"line\"><span class=\"keyword\">import</span>(<span class=\"comment\">/* webpackChunkName: &#x27;test&#x27; */</span><span class=\"string\">&#x27;./test&#x27;</span>)</span><br><span class=\"line\">\t.then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 文件加载成功~</span></span><br><span class=\"line\">        <span class=\"comment\">// eslint-disable-next-line</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;文件加载成功~&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    .catch(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">// eslint-disable-next-line</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;文件加载失败~&#x27;</span>);</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>修改 <code>webpack.config.js</code> 中的配置</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">  <span class=\"comment\">// 单入口</span></span><br><span class=\"line\">  <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// [name]：取文件名</span></span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/[name].[contenthash:10].js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">minify</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">collapseWhitespace</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">removeComments</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ],</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">    1. 可以将node_modules中代码单独打包一个chunk最终输出</span></span><br><span class=\"line\"><span class=\"comment\">    2. 自动分析多入口chunk中，有没有公共的文件。如果有会打包成单独一个chunk</span></span><br><span class=\"line\"><span class=\"comment\">  */</span></span><br><span class=\"line\">  <span class=\"attr\">optimization</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">splitChunks</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">chunks</span>: <span class=\"string\">&#x27;all&#x27;</span></span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">    <span class=\"comment\">//-----------------------------------------------------------------------------</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://qny.aqingya.cn/img/20200716164340.png\" alt=\"\"></p>\n<p><img src=\"https://qny.aqingya.cn/img/20200716164207.png\" alt=\"\"></p>\n<h2 id=\"懒加载和预加载\"><a href=\"#懒加载和预加载\" class=\"headerlink\" title=\"懒加载和预加载\"></a>懒加载和预加载</h2><p><strong>懒加载~</strong>：当文件需要使用时才加载~，不是上来就加载而是触发某些条件才会加载的。<span style=\"background-color:yellow\"><strong>利用代码分割的思路，将代码分割的语法import放到一个异步函数当中，等条件触发，再来加载懒加载这些代码。</strong></span></p>\n<p> <strong>预加载 prefetch</strong>：会在使用之前，提前加载js文件 </p>\n<p><br></p>\n<p> 正常加载可以认为是并行加载（同一时间加载多个文件） </p>\n<p> 预加载 prefetch：等其他资源加载完毕，浏览器空闲了，再偷偷加载资源。<span style=\"background-color:yellow\">(缺点：兼容性差)</span></p>\n<p><br></p>\n<p>index.js</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;index.js文件被加载了~&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// import &#123; mul &#125; from &#x27;./test&#x27;;</span></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">document</span>.getElementById(<span class=\"string\">&#x27;btn&#x27;</span>).onclick = <span class=\"function\"><span class=\"keyword\">function</span>(<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 懒加载~：当文件需要使用时才加载~</span></span><br><span class=\"line\">    <span class=\"comment\">// 预加载 prefetch：会在使用之前，提前加载js文件 </span></span><br><span class=\"line\">    <span class=\"comment\">// 正常加载可以认为是并行加载（同一时间加载多个文件）  </span></span><br><span class=\"line\">    <span class=\"comment\">// 预加载 prefetch：等其他资源加载完毕，浏览器空闲了，再偷偷加载资源</span></span><br><span class=\"line\">    <span class=\"comment\">//-------------------------------------------------------------------------------</span></span><br><span class=\"line\">    <span class=\"keyword\">import</span> ( <span class=\"comment\">/* webpackChunkName: &#x27;test&#x27;, webpackPrefetch: true */</span> <span class=\"string\">&#x27;./test&#x27;</span>).then(<span class=\"function\">(<span class=\"params\">&#123; mul &#125;</span>) =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(mul(<span class=\"number\">4</span>, <span class=\"number\">5</span>));</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">    <span class=\"comment\">//-------------------------------------------------------------------------------</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n<p>test.js</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;test.js文件被加载了~&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">mul</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> x * y;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"keyword\">export</span> <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">count</span>(<span class=\"params\">x, y</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> x - y;</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p><img src=\"https://qny.aqingya.cn/img/20200716171931.png\" alt=\"\"></p>\n<p><strong>同时利用前面的inport 进行代码分割，所以有两个js文件。</strong></p>\n<p><img src=\"https://qny.aqingya.cn/img/20200716171825.png\" alt=\"\"></p>\n<p><strong>点击按钮之后才会加载test.js文件</strong></p>\n<p><img src=\"https://qny.aqingya.cn/img/20200716172037.png\" alt=\"\"></p>\n<h2 id=\"pwd-离线可访问\"><a href=\"#pwd-离线可访问\" class=\"headerlink\" title=\"pwd(离线可访问)\"></a>pwd(离线可访问)</h2><p>PWA: 渐进式网络开发应用程序(离线可访问)</p>\n<p>workbox —&gt; workbox-webpack-plugin</p>\n<p>第一步：下载插件，引入插件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cnpm i workbox-webpack-plugin -D</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">//----------------------------------------------------------------------------</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> WorkboxWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;workbox-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"comment\">//----------------------------------------------------------------------------</span></span><br><span class=\"line\"></span><br><span class=\"line\">plugins: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> MiniCssExtractPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;css/built.[contenthash:10].css&#x27;</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> OptimizeCssAssetsWebpackPlugin(),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">minify</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">collapseWhitespace</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">removeComments</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\"><span class=\"comment\">//----------------------------------------------------------------------------</span></span><br><span class=\"line\">    </span><br><span class=\"line\">    <span class=\"keyword\">new</span> WorkboxWebpackPlugin.GenerateSW(&#123;</span><br><span class=\"line\">      <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        1. 帮助serviceworker快速启动</span></span><br><span class=\"line\"><span class=\"comment\">        2. 删除旧的 serviceworker</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        生成一个 serviceworker 配置文件~</span></span><br><span class=\"line\"><span class=\"comment\">      */</span></span><br><span class=\"line\">      <span class=\"attr\">clientsClaim</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      <span class=\"attr\">skipWaiting</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"comment\">//----------------------------------------------------------------------------</span></span><br><span class=\"line\">    </span><br><span class=\"line\">  ]</span><br></pre></td></tr></table></figure>\n<p>第二步：在入口文件中注册<code>serviceWorker</code></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">import</span> &#123; mul &#125; <span class=\"keyword\">from</span> <span class=\"string\">&#x27;./test&#x27;</span>;</span><br><span class=\"line\"><span class=\"keyword\">import</span> <span class=\"string\">&#x27;../css/index.css&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">sum</span>(<span class=\"params\">...args</span>) </span>&#123;</span><br><span class=\"line\">  <span class=\"keyword\">return</span> args.reduce(<span class=\"function\">(<span class=\"params\">p, c</span>) =&gt;</span> p + c, <span class=\"number\">0</span>);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// eslint-disable-next-line</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(mul(<span class=\"number\">2</span>, <span class=\"number\">3</span>));</span><br><span class=\"line\"><span class=\"comment\">// eslint-disable-next-line</span></span><br><span class=\"line\"><span class=\"built_in\">console</span>.log(sum(<span class=\"number\">1</span>, <span class=\"number\">2</span>, <span class=\"number\">3</span>, <span class=\"number\">4</span>));</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">//----------------------------------------------------------------------------</span></span><br><span class=\"line\"><span class=\"comment\">// 注册serviceWorker</span></span><br><span class=\"line\"><span class=\"comment\">// 处理兼容性问题</span></span><br><span class=\"line\"><span class=\"keyword\">if</span> (<span class=\"string\">&#x27;serviceWorker&#x27;</span> <span class=\"keyword\">in</span> navigator) &#123;</span><br><span class=\"line\">  <span class=\"built_in\">window</span>.addEventListener(<span class=\"string\">&#x27;load&#x27;</span>, <span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">    navigator.serviceWorker</span><br><span class=\"line\">      .register(<span class=\"string\">&#x27;/service-worker.js&#x27;</span>)</span><br><span class=\"line\">      .then(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//eslint-disable-next-line</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;sw注册成功了~&#x27;</span>);</span><br><span class=\"line\">      &#125;)</span><br><span class=\"line\">      .catch(<span class=\"function\">() =&gt;</span> &#123;</span><br><span class=\"line\">        <span class=\"comment\">//eslint-disable-next-line</span></span><br><span class=\"line\">        <span class=\"built_in\">console</span>.log(<span class=\"string\">&#x27;sw注册失败了~&#x27;</span>);</span><br><span class=\"line\">      &#125;);</span><br><span class=\"line\">  &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"><span class=\"comment\">//----------------------------------------------------------------------------</span></span><br></pre></td></tr></table></figure>\n<p>第三步： 我们要注意一些事项</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">1. eslint不认识 window、navigator全局变量</span><br><span class=\"line\"> 解决：需要修改package.json中eslintConfig配置</span><br><span class=\"line\">   &quot;env&quot;: &#123;</span><br><span class=\"line\">     &quot;browser&quot;: true // 支持浏览器端全局变量</span><br><span class=\"line\">   &#125;</span><br><span class=\"line\">2. sw代码必须运行在服务器上</span><br><span class=\"line\">   --&gt; nodejs</span><br><span class=\"line\">   --&gt;</span><br><span class=\"line\">     npm i serve -g</span><br><span class=\"line\">     serve -s build 启动服务器，将build目录下所有资源作为静态资源暴露出去</span><br></pre></td></tr></table></figure>\n<p><br></p>\n<p>完整 <code>webpack.config.js</code> 中的配置：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> MiniCssExtractPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mini-css-extract-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> OptimizeCssAssetsWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;optimize-css-assets-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> WorkboxWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;workbox-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 定义nodejs环境变量：决定使用browserslist的哪个环境</span></span><br><span class=\"line\">process.env.NODE_ENV = <span class=\"string\">&#x27;production&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 复用loader</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> commonCssLoader = [</span><br><span class=\"line\">  MiniCssExtractPlugin.loader,</span><br><span class=\"line\">  <span class=\"string\">&#x27;css-loader&#x27;</span>,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 还需要在package.json中定义browserslist</span></span><br><span class=\"line\">    <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;postcss-loader&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">ident</span>: <span class=\"string\">&#x27;postcss&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">plugins</span>: <span class=\"function\">() =&gt;</span> [<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;postcss-preset-env&#x27;</span>)()]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/built.[contenthash:10].js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">module</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">rules</span>: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 在package.json中eslintConfig --&gt; airbnb</span></span><br><span class=\"line\">        <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">        exclude: <span class=\"regexp\">/node_modules/</span>,</span><br><span class=\"line\">        <span class=\"comment\">// 优先执行</span></span><br><span class=\"line\">        enforce: <span class=\"string\">&#x27;pre&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;eslint-loader&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">fix</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 以下loader只会匹配一个</span></span><br><span class=\"line\">        <span class=\"comment\">// 注意：不能有两个配置处理同一种类型文件</span></span><br><span class=\"line\">        <span class=\"attr\">oneOf</span>: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">            use: [...commonCssLoader]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.less$/</span>,</span><br><span class=\"line\">            use: [...commonCssLoader, <span class=\"string\">&#x27;less-loader&#x27;</span>]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">            正常来讲，一个文件只能被一个loader处理。</span></span><br><span class=\"line\"><span class=\"comment\">            当一个文件要被多个loader处理，那么一定要指定loader执行的先后顺序：</span></span><br><span class=\"line\"><span class=\"comment\">              先执行eslint 在执行babel</span></span><br><span class=\"line\"><span class=\"comment\">          */</span></span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">            exclude: <span class=\"regexp\">/node_modules/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;babel-loader&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">presets</span>: [</span><br><span class=\"line\">                [</span><br><span class=\"line\">                  <span class=\"string\">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class=\"line\">                  &#123;</span><br><span class=\"line\">                    <span class=\"attr\">useBuiltIns</span>: <span class=\"string\">&#x27;usage&#x27;</span>,</span><br><span class=\"line\">                    <span class=\"attr\">corejs</span>: &#123; <span class=\"attr\">version</span>: <span class=\"number\">3</span> &#125;,</span><br><span class=\"line\">                    <span class=\"attr\">targets</span>: &#123;</span><br><span class=\"line\">                      <span class=\"attr\">chrome</span>: <span class=\"string\">&#x27;60&#x27;</span>,</span><br><span class=\"line\">                      <span class=\"attr\">firefox</span>: <span class=\"string\">&#x27;50&#x27;</span></span><br><span class=\"line\">                    &#125;</span><br><span class=\"line\">                  &#125;</span><br><span class=\"line\">                ]</span><br><span class=\"line\">              ],</span><br><span class=\"line\">              <span class=\"comment\">// 开启babel缓存</span></span><br><span class=\"line\">              <span class=\"comment\">// 第二次构建时，会读取之前的缓存</span></span><br><span class=\"line\">              <span class=\"attr\">cacheDirectory</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.(jpg|png|gif)/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;url-loader&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">limit</span>: <span class=\"number\">8</span> * <span class=\"number\">1024</span>,</span><br><span class=\"line\">              <span class=\"attr\">name</span>: <span class=\"string\">&#x27;[hash:10].[ext]&#x27;</span>,</span><br><span class=\"line\">              <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;imgs&#x27;</span>,</span><br><span class=\"line\">              <span class=\"attr\">esModule</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.html$/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;html-loader&#x27;</span></span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">exclude</span>: <span class=\"regexp\">/\\.(js|css|less|html|jpg|png|gif)/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;file-loader&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;media&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> MiniCssExtractPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;css/built.[contenthash:10].css&#x27;</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> OptimizeCssAssetsWebpackPlugin(),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">minify</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">collapseWhitespace</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">removeComments</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\"><span class=\"comment\">//----------------------------------------------------------------------------      </span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> WorkboxWebpackPlugin.GenerateSW(&#123;</span><br><span class=\"line\">      <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        1. 帮助serviceworker快速启动</span></span><br><span class=\"line\"><span class=\"comment\">        2. 删除旧的 serviceworker</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        生成一个 serviceworker 配置文件~</span></span><br><span class=\"line\"><span class=\"comment\">      */</span></span><br><span class=\"line\">      <span class=\"attr\">clientsClaim</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      <span class=\"attr\">skipWaiting</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\"><span class=\"comment\">//----------------------------------------------------------------------------      </span></span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">devtool</span>: <span class=\"string\">&#x27;source-map&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"多进程打包\"><a href=\"#多进程打包\" class=\"headerlink\" title=\"多进程打包\"></a>多进程打包</h2><p>我们一般给 babel-loader 来用 ,<span style=\"background-color:yellow\">如果babel-loader处理的js文件大可以使用，如果较小，不推荐使用多进程打包。</span></p>\n<p>1、下载安装包</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cnpm install  thread-loader -D</span><br></pre></td></tr></table></figure>\n<p>2、修改配置文件</p>\n<p>原配置文件：babel-loader</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200716191203.png\" alt=\"\"></p>\n<p>配置之后的文件</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br><span class=\"line\">91</span><br><span class=\"line\">92</span><br><span class=\"line\">93</span><br><span class=\"line\">94</span><br><span class=\"line\">95</span><br><span class=\"line\">96</span><br><span class=\"line\">97</span><br><span class=\"line\">98</span><br><span class=\"line\">99</span><br><span class=\"line\">100</span><br><span class=\"line\">101</span><br><span class=\"line\">102</span><br><span class=\"line\">103</span><br><span class=\"line\">104</span><br><span class=\"line\">105</span><br><span class=\"line\">106</span><br><span class=\"line\">107</span><br><span class=\"line\">108</span><br><span class=\"line\">109</span><br><span class=\"line\">110</span><br><span class=\"line\">111</span><br><span class=\"line\">112</span><br><span class=\"line\">113</span><br><span class=\"line\">114</span><br><span class=\"line\">115</span><br><span class=\"line\">116</span><br><span class=\"line\">117</span><br><span class=\"line\">118</span><br><span class=\"line\">119</span><br><span class=\"line\">120</span><br><span class=\"line\">121</span><br><span class=\"line\">122</span><br><span class=\"line\">123</span><br><span class=\"line\">124</span><br><span class=\"line\">125</span><br><span class=\"line\">126</span><br><span class=\"line\">127</span><br><span class=\"line\">128</span><br><span class=\"line\">129</span><br><span class=\"line\">130</span><br><span class=\"line\">131</span><br><span class=\"line\">132</span><br><span class=\"line\">133</span><br><span class=\"line\">134</span><br><span class=\"line\">135</span><br><span class=\"line\">136</span><br><span class=\"line\">137</span><br><span class=\"line\">138</span><br><span class=\"line\">139</span><br><span class=\"line\">140</span><br><span class=\"line\">141</span><br><span class=\"line\">142</span><br><span class=\"line\">143</span><br><span class=\"line\">144</span><br><span class=\"line\">145</span><br><span class=\"line\">146</span><br><span class=\"line\">147</span><br><span class=\"line\">148</span><br><span class=\"line\">149</span><br><span class=\"line\">150</span><br><span class=\"line\">151</span><br><span class=\"line\">152</span><br><span class=\"line\">153</span><br><span class=\"line\">154</span><br><span class=\"line\">155</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> MiniCssExtractPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;mini-css-extract-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> OptimizeCssAssetsWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;optimize-css-assets-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> WorkboxWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;workbox-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 定义nodejs环境变量：决定使用browserslist的哪个环境</span></span><br><span class=\"line\">process.env.NODE_ENV = <span class=\"string\">&#x27;production&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">// 复用loader</span></span><br><span class=\"line\"><span class=\"keyword\">const</span> commonCssLoader = [</span><br><span class=\"line\">  MiniCssExtractPlugin.loader,</span><br><span class=\"line\">  <span class=\"string\">&#x27;css-loader&#x27;</span>,</span><br><span class=\"line\">  &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 还需要在package.json中定义browserslist</span></span><br><span class=\"line\">    <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;postcss-loader&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">      <span class=\"attr\">ident</span>: <span class=\"string\">&#x27;postcss&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">plugins</span>: <span class=\"function\">() =&gt;</span> [<span class=\"built_in\">require</span>(<span class=\"string\">&#x27;postcss-preset-env&#x27;</span>)()]</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">];</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/built.[contenthash:10].js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">module</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">rules</span>: [</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 在package.json中eslintConfig --&gt; airbnb</span></span><br><span class=\"line\">        <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">        exclude: <span class=\"regexp\">/node_modules/</span>,</span><br><span class=\"line\">        <span class=\"comment\">// 优先执行</span></span><br><span class=\"line\">        enforce: <span class=\"string\">&#x27;pre&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;eslint-loader&#x27;</span>,</span><br><span class=\"line\">        <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">          <span class=\"attr\">fix</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">      &#125;,</span><br><span class=\"line\">      &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 以下loader只会匹配一个</span></span><br><span class=\"line\">        <span class=\"comment\">// 注意：不能有两个配置处理同一种类型文件</span></span><br><span class=\"line\">        <span class=\"attr\">oneOf</span>: [</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.css$/</span>,</span><br><span class=\"line\">            use: [...commonCssLoader]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.less$/</span>,</span><br><span class=\"line\">            use: [...commonCssLoader, <span class=\"string\">&#x27;less-loader&#x27;</span>]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">            正常来讲，一个文件只能被一个loader处理。</span></span><br><span class=\"line\"><span class=\"comment\">            当一个文件要被多个loader处理，那么一定要指定loader执行的先后顺序：</span></span><br><span class=\"line\"><span class=\"comment\">              先执行eslint 在执行babel</span></span><br><span class=\"line\"><span class=\"comment\">          */</span></span><br><span class=\"line\">            </span><br><span class=\"line\"> <span class=\"comment\">//------------------------------------------------------------------------------</span></span><br><span class=\"line\">            </span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.js$/</span>,</span><br><span class=\"line\">            exclude: <span class=\"regexp\">/node_modules/</span>,</span><br><span class=\"line\">            use: [</span><br><span class=\"line\">              <span class=\"comment\">/* </span></span><br><span class=\"line\"><span class=\"comment\">                开启多进程打包。 </span></span><br><span class=\"line\"><span class=\"comment\">                进程启动大概为600ms，进程通信也有开销。</span></span><br><span class=\"line\"><span class=\"comment\">                只有工作消耗时间比较长，才需要多进程打包</span></span><br><span class=\"line\"><span class=\"comment\">              */</span></span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;thread-loader&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                  <span class=\"attr\">workers</span>: <span class=\"number\">2</span> <span class=\"comment\">// 进程2个</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">              &#125;,</span><br><span class=\"line\">              &#123;</span><br><span class=\"line\">                <span class=\"attr\">loader</span>: <span class=\"string\">&#x27;babel-loader&#x27;</span>,</span><br><span class=\"line\">                <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">                  <span class=\"attr\">presets</span>: [</span><br><span class=\"line\">                    [</span><br><span class=\"line\">                      <span class=\"string\">&#x27;@babel/preset-env&#x27;</span>,</span><br><span class=\"line\">                      &#123;</span><br><span class=\"line\">                        <span class=\"attr\">useBuiltIns</span>: <span class=\"string\">&#x27;usage&#x27;</span>,</span><br><span class=\"line\">                        <span class=\"attr\">corejs</span>: &#123; <span class=\"attr\">version</span>: <span class=\"number\">3</span> &#125;,</span><br><span class=\"line\">                        <span class=\"attr\">targets</span>: &#123;</span><br><span class=\"line\">                          <span class=\"attr\">chrome</span>: <span class=\"string\">&#x27;60&#x27;</span>,</span><br><span class=\"line\">                          <span class=\"attr\">firefox</span>: <span class=\"string\">&#x27;50&#x27;</span></span><br><span class=\"line\">                        &#125;</span><br><span class=\"line\">                      &#125;</span><br><span class=\"line\">                    ]</span><br><span class=\"line\">                  ],</span><br><span class=\"line\">                  <span class=\"comment\">// 开启babel缓存</span></span><br><span class=\"line\">                  <span class=\"comment\">// 第二次构建时，会读取之前的缓存</span></span><br><span class=\"line\">                  <span class=\"attr\">cacheDirectory</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">                &#125;</span><br><span class=\"line\">              &#125;</span><br><span class=\"line\">            ]</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\"> <span class=\"comment\">//------------------------------------------------------------------------------</span></span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.(jpg|png|gif)/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;url-loader&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">limit</span>: <span class=\"number\">8</span> * <span class=\"number\">1024</span>,</span><br><span class=\"line\">              <span class=\"attr\">name</span>: <span class=\"string\">&#x27;[hash:10].[ext]&#x27;</span>,</span><br><span class=\"line\">              <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;imgs&#x27;</span>,</span><br><span class=\"line\">              <span class=\"attr\">esModule</span>: <span class=\"literal\">false</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">test</span>: <span class=\"regexp\">/\\.html$/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;html-loader&#x27;</span></span><br><span class=\"line\">          &#125;,</span><br><span class=\"line\">          &#123;</span><br><span class=\"line\">            <span class=\"attr\">exclude</span>: <span class=\"regexp\">/\\.(js|css|less|html|jpg|png|gif)/</span>,</span><br><span class=\"line\">            loader: <span class=\"string\">&#x27;file-loader&#x27;</span>,</span><br><span class=\"line\">            <span class=\"attr\">options</span>: &#123;</span><br><span class=\"line\">              <span class=\"attr\">outputPath</span>: <span class=\"string\">&#x27;media&#x27;</span></span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">          &#125;</span><br><span class=\"line\">        ]</span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    ]</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> MiniCssExtractPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;css/built.[contenthash:10].css&#x27;</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> OptimizeCssAssetsWebpackPlugin(),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span>,</span><br><span class=\"line\">      <span class=\"attr\">minify</span>: &#123;</span><br><span class=\"line\">        <span class=\"attr\">collapseWhitespace</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">        <span class=\"attr\">removeComments</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">      &#125;</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"keyword\">new</span> WorkboxWebpackPlugin.GenerateSW(&#123;</span><br><span class=\"line\">      <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">        1. 帮助serviceworker快速启动</span></span><br><span class=\"line\"><span class=\"comment\">        2. 删除旧的 serviceworker</span></span><br><span class=\"line\"><span class=\"comment\"></span></span><br><span class=\"line\"><span class=\"comment\">        生成一个 serviceworker 配置文件~</span></span><br><span class=\"line\"><span class=\"comment\">      */</span></span><br><span class=\"line\">      <span class=\"attr\">clientsClaim</span>: <span class=\"literal\">true</span>,</span><br><span class=\"line\">      <span class=\"attr\">skipWaiting</span>: <span class=\"literal\">true</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">devtool</span>: <span class=\"string\">&#x27;source-map&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"externals\"><a href=\"#externals\" class=\"headerlink\" title=\"externals\"></a>externals</h2><p>彻底不打包，通过一些外链的cdn ：jQuery，vue等等，用到时需用用cdn引入。</p>\n<p>然后禁止一些包不会被打包到最后输出的 built.js 中，</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200716194524.png\" alt=\"\"></p>\n<p>修改配置文件：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;./src/js/index.js&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;js/built.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span>,</span><br><span class=\"line\">  <span class=\"comment\">//------------------------------------------------------------------------------</span></span><br><span class=\"line\">  <span class=\"attr\">externals</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 拒绝jQuery被打包进来</span></span><br><span class=\"line\">    <span class=\"attr\">jquery</span>: <span class=\"string\">&#x27;jQuery&#x27;</span></span><br><span class=\"line\">  &#125;</span><br><span class=\"line\">  <span class=\"comment\">//------------------------------------------------------------------------------</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h2 id=\"dll\"><a href=\"#dll\" class=\"headerlink\" title=\"dll\"></a>dll</h2><p>对第三方库进行打包，需要打包，打包一次，将来不用重复打包。所以使我们第二次打包的时候，变得很快，因为少了第三方库的打包。</p>\n<p>第一步：创建 <code>webpack.dll.js</code>文件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">使用dll技术，对某些库（第三方库：jquery、react、vue...）进行单独打包</span><br><span class=\"line\">  当你运行 webpack 时，默认查找 webpack.config.js 配置文件</span><br><span class=\"line\">  需求：需要运行 webpack.dll.js 文件</span><br><span class=\"line\">    --&gt; webpack --config webpack.dll.js</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;webpack&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"attr\">entry</span>: &#123;</span><br><span class=\"line\">    <span class=\"comment\">// 最终打包生成的[name] --&gt; jquery</span></span><br><span class=\"line\">    <span class=\"comment\">// [&#x27;jquery&#x27;] --&gt; 要打包的库是jquery</span></span><br><span class=\"line\">    <span class=\"attr\">jquery</span>: [<span class=\"string\">&#x27;jquery&#x27;</span>],</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;[name].js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;dll&#x27;</span>),</span><br><span class=\"line\">    <span class=\"attr\">library</span>: <span class=\"string\">&#x27;[name]_[hash]&#x27;</span> <span class=\"comment\">// 打包的库里面向外暴露出去的内容叫什么名字</span></span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"comment\">// 打包生成一个 manifest.json --&gt; 提供和jquery映射</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> webpack.DllPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">name</span>: <span class=\"string\">&#x27;[name]_[hash]&#x27;</span>, <span class=\"comment\">// 映射库的暴露的内容名称</span></span><br><span class=\"line\">      <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;dll/manifest.json&#x27;</span>) <span class=\"comment\">// 输出文件路径</span></span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<p>运行命令</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">webpack --config webpack.dll.js</span><br></pre></td></tr></table></figure>\n<p>生成dll文件夹</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200716214613.png\" alt=\"\"></p>\n<p><code>jquery.js</code>是要打包的库是jquery，<code>manifest.json</code> 是 提供和jquery映射,这样以后jquery就不用重复打包了。</p>\n<p>第二步：</p>\n<p>下载一个插件</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">cnpm i add-asset-html-webpack-plugin -D</span><br></pre></td></tr></table></figure>\n<p>告诉webpack哪些库不参与打包，同时使用时的名称也得变~</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">manifest</span>: resolve(__dirname, <span class=\"string\">&#x27;dll/manifest.json&#x27;</span>)</span><br><span class=\"line\">    &#125;),</span><br></pre></td></tr></table></figure>\n<p>将某个文件打包输出去，并在html中自动引入该资源</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">new</span> AddAssetHtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">filepath</span>: resolve(__dirname, <span class=\"string\">&#x27;dll/jquery.js&#x27;</span>)</span><br><span class=\"line\">    &#125;)</span><br></pre></td></tr></table></figure>\n<p>修改<code>webpack.config.js</code> 中的配置：</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">const</span> &#123; resolve &#125; = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;path&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> HtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> webpack = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;webpack&#x27;</span>);</span><br><span class=\"line\"><span class=\"keyword\">const</span> AddAssetHtmlWebpackPlugin = <span class=\"built_in\">require</span>(<span class=\"string\">&#x27;add-asset-html-webpack-plugin&#x27;</span>);</span><br><span class=\"line\"></span><br><span class=\"line\"><span class=\"built_in\">module</span>.exports = &#123;</span><br><span class=\"line\">  <span class=\"attr\">entry</span>: <span class=\"string\">&#x27;./src/index.js&#x27;</span>,</span><br><span class=\"line\">  <span class=\"attr\">output</span>: &#123;</span><br><span class=\"line\">    <span class=\"attr\">filename</span>: <span class=\"string\">&#x27;built.js&#x27;</span>,</span><br><span class=\"line\">    <span class=\"attr\">path</span>: resolve(__dirname, <span class=\"string\">&#x27;build&#x27;</span>)</span><br><span class=\"line\">  &#125;,</span><br><span class=\"line\">  <span class=\"attr\">plugins</span>: [</span><br><span class=\"line\">    <span class=\"keyword\">new</span> HtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">template</span>: <span class=\"string\">&#x27;./src/index.html&#x27;</span></span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"comment\">//--------------------------------------------------------------------------</span></span><br><span class=\"line\">    <span class=\"comment\">// 告诉webpack哪些库不参与打包，同时使用时的名称也得变~</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> webpack.DllReferencePlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">manifest</span>: resolve(__dirname, <span class=\"string\">&#x27;dll/manifest.json&#x27;</span>)</span><br><span class=\"line\">    &#125;),</span><br><span class=\"line\">    <span class=\"comment\">// 将某个文件打包输出去，并在html中自动引入该资源</span></span><br><span class=\"line\">    <span class=\"keyword\">new</span> AddAssetHtmlWebpackPlugin(&#123;</span><br><span class=\"line\">      <span class=\"attr\">filepath</span>: resolve(__dirname, <span class=\"string\">&#x27;dll/jquery.js&#x27;</span>)</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">    <span class=\"comment\">//--------------------------------------------------------------------------</span></span><br><span class=\"line\">      </span><br><span class=\"line\">  ],</span><br><span class=\"line\">  <span class=\"attr\">mode</span>: <span class=\"string\">&#x27;production&#x27;</span></span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br></pre></td></tr></table></figure>\n<h1 id=\"总结\"><a href=\"#总结\" class=\"headerlink\" title=\"总结\"></a>总结</h1><h2 id=\"webpack性能优化\"><a href=\"#webpack性能优化\" class=\"headerlink\" title=\"webpack性能优化\"></a>webpack性能优化</h2><ul>\n<li><p>开发环境性能优化</p>\n</li>\n<li><p>生产环境性能优化</p>\n</li>\n</ul>\n<h2 id=\"开发环境性能优化\"><a href=\"#开发环境性能优化\" class=\"headerlink\" title=\"开发环境性能优化\"></a>开发环境性能优化</h2><ul>\n<li>优化打包构建速度<ul>\n<li>HMR</li>\n</ul>\n</li>\n<li>优化代码调试<ul>\n<li>source-map</li>\n</ul>\n</li>\n</ul>\n<h2 id=\"生产环境性能优化\"><a href=\"#生产环境性能优化\" class=\"headerlink\" title=\"生产环境性能优化\"></a>生产环境性能优化</h2><ul>\n<li>优化打包构建速度<ul>\n<li>oneOf</li>\n<li>babel缓存</li>\n<li>多进程打包</li>\n<li>externals</li>\n<li>dll</li>\n</ul>\n</li>\n<li>优化代码运行的性能<ul>\n<li>缓存(hash-chunkhash-contenthash)</li>\n<li>tree shaking</li>\n<li>code split</li>\n<li>懒加载/预加载</li>\n<li>pwa</li>\n</ul>\n</li>\n</ul>","categories":[{"name":"WebPack","path":"api/categories/WebPack.json"}],"tags":[{"name":"WebPack","path":"api/tags/WebPack.json"}]}