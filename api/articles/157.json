{"title":"uniapp中微信小程序的分包处理","slug":"157","date":"2021-11-04T10:04:37.000Z","updated":"2022-07-29T04:22:04.786Z","comments":true,"path":"api/articles/157.json","excerpt":null,"covers":["https://qny.aqingya.cn/img/20211104180618.png","https://qny.aqingya.cn/img/20211104180626.png","https://qny.aqingya.cn/img/20211104180644.png","https://qny.aqingya.cn/img/20211104180703.png","https://qny.aqingya.cn/img/20211104180722.png","https://qny.aqingya.cn/img/20211104180731.png","https://qny.aqingya.cn/img/20211104180829.png"],"content":"<h1 id=\"0-缘由\"><a href=\"#0-缘由\" class=\"headerlink\" title=\"0. 缘由\"></a>0. 缘由</h1><p> 最近工作在接触uni-app,用它来开发微信小程序,也是第一次接触,找了很久,还有大佬用自己写的函数做的,俺觉得我不会也不配,刚好看到下面评论是官方也支持了,所以就用官方的了,这里记录一下</p>\n<h1 id=\"1-关于分包\"><a href=\"#1-关于分包\" class=\"headerlink\" title=\"1. 关于分包\"></a>1. 关于分包</h1><p> 好像是规定小程序不能超过2M,一旦超过就需要分包,因为是公司项目,肯定超过,所以就做个演示,权当记录吧</p>\n<h2 id=\"1-0-这是-官方文档\"><a href=\"#1-0-这是-官方文档\" class=\"headerlink\" title=\"1.0 这是 官方文档\"></a>1.0 这是 <a href=\"https://uniapp.dcloud.io/collocation/pages?id=subpackages\">官方文档</a></h2><h2 id=\"1-1-注意事项\"><a href=\"#1-1-注意事项\" class=\"headerlink\" title=\"1.1 注意事项\"></a>1.1 注意事项</h2><blockquote>\n<ol>\n<li><p><code>subPackages</code> 里的pages的路径是 <code>root</code> 下的相对路径，不是全路径。</p>\n</li>\n<li><p>微信小程序每个分包的大小是2M，总体积一共不能超过16M。</p>\n</li>\n<li><p>百度小程序每个分包的大小是2M，总体积一共不能超过8M。</p>\n</li>\n<li><p>支付宝小程序每个分包的大小是2M，总体积一共不能超过4M。</p>\n</li>\n<li><p>QQ小程序每个分包的大小是2M，总体积一共不能超过24M。</p>\n</li>\n<li><p>分包下支持独立的 <code>static</code> 目录，用来对静态资源进行分包。</p>\n</li>\n<li><p><code>uni-app</code>内支持对微信小程序、QQ小程序、百度小程序分包优化，即将静态资源或者js文件放入分包内不占用主包大小。详情请参考：<a href=\"https://uniapp.dcloud.io/collocation/manifest?id=%E5%85%B3%E4%BA%8E%E5%88%86%E5%8C%85%E4%BC%98%E5%8C%96%E7%9A%84%E8%AF%B4%E6%98%8E\">关于分包优化的说明</a></p>\n</li>\n<li><p>针对</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vendor.js</span><br></pre></td></tr></table></figure>\n\n<p>过大的情况可以使用运行时压缩代码</p>\n<ul>\n<li><code>HBuilderX</code>创建的项目勾选<code>运行--&gt;运行到小程序模拟器--&gt;运行时是否压缩代码</code></li>\n<li><code>cli</code>创建的项目可以在<code>pacakge.json</code>中添加参数<code>--minimize</code>，示例：<code>&quot;dev:mp-weixin&quot;: &quot;cross-env NODE_ENV=development UNI_PLATFORM=mp-weixin vue-cli-service uni-build --watch --minimize&quot;</code></li>\n</ul>\n</li>\n</ol>\n</blockquote>\n<h1 id=\"2-使用方法\"><a href=\"#2-使用方法\" class=\"headerlink\" title=\"2.使用方法\"></a>2.使用方法</h1><h2 id=\"2-1-首先你得有个uniapp的微信小程序项目\"><a href=\"#2-1-首先你得有个uniapp的微信小程序项目\" class=\"headerlink\" title=\"2.1 首先你得有个uniapp的微信小程序项目\"></a>2.1 首先你得有个uniapp的微信小程序项目</h2><p> 这里假设你有了,原始项目结构</p>\n<p><img src=\"https://qny.aqingya.cn/img/20211104180618.png\"></p>\n<p><img src=\"https://qny.aqingya.cn/img/20211104180626.png\"></p>\n<h2 id=\"2-2-在pages同级创建分包\"><a href=\"#2-2-在pages同级创建分包\" class=\"headerlink\" title=\"2.2 在pages同级创建分包\"></a>2.2 在pages同级创建分包</h2><p><img src=\"https://qny.aqingya.cn/img/20211104180644.png\"></p>\n<h2 id=\"2-3-pages-json配置\"><a href=\"#2-3-pages-json配置\" class=\"headerlink\" title=\"2.3 pages.json配置\"></a>2.3 <code>pages.json</code>配置</h2><p><img src=\"https://qny.aqingya.cn/img/20211104180703.png\"></p>\n<h2 id=\"2-4-然后呢-官网支持了-分包优化\"><a href=\"#2-4-然后呢-官网支持了-分包优化\" class=\"headerlink\" title=\"2.4 然后呢,官网支持了 分包优化\"></a>2.4 然后呢,官网支持了 <a href=\"https://uniapp.dcloud.io/collocation/manifest?id=%E5%85%B3%E4%BA%8E%E5%88%86%E5%8C%85%E4%BC%98%E5%8C%96%E7%9A%84%E8%AF%B4%E6%98%8E\">分包优化</a></h2><blockquote>\n<ul>\n<li>在对应平台的配置下添加<code>&quot;optimization&quot;:&#123;&quot;subPackages&quot;:true&#125;</code>开启分包优化</li>\n<li>目前只支持<code>mp-weixin</code>、<code>mp-qq</code>、<code>mp-baidu</code>的分包优化</li>\n<li>分包优化具体逻辑：<ul>\n<li>静态文件：分包下支持 static 等静态资源拷贝，即分包目录内放置的静态资源不会被打包到主包中，也不可在主包中使用</li>\n<li>js文件：当某个 js 仅被一个分包引用时，该 js 会被打包到该分包内，否则仍打到主包（即被主包引用，或被超过 1 个分包引用）</li>\n<li>自定义组件：若某个自定义组件仅被一个分包引用时，且未放入到分包内，编译时会输出提示信息</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<blockquote>\n<p><em>我的理解呢就是,既然你分包了功能模块,那相应的静态资源你得分吧,用图片的时候直接是分包下的路径,这才是个完整的分包.</em></p>\n</blockquote>\n<p>这里我以微信小程序为例,</p>\n<p><img src=\"https://qny.aqingya.cn/img/20211104180722.png\"></p>\n<p><img src=\"https://qny.aqingya.cn/img/20211104180731.png\"></p>\n<h2 id=\"2-5-怎么跳转呢\"><a href=\"#2-5-怎么跳转呢\" class=\"headerlink\" title=\"2.5 怎么跳转呢?\"></a>2.5 怎么跳转呢?</h2><p>在需要点击跳转的地方就好啦</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uni.navigateTo(&#123;</span><br><span class=\"line\">  url: &#x27;/myPackageA/pages/piece/piece&#x27;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-6-然后重启微信开发工具运行\"><a href=\"#2-6-然后重启微信开发工具运行\" class=\"headerlink\" title=\"2.6 然后重启微信开发工具运行\"></a>2.6 然后重启微信开发工具运行</h2><p><img src=\"https://qny.aqingya.cn/img/20211104180829.png\"></p>\n<p>可以看到已经分包成功</p>\n<p><br><br></p>\n<p>参考：<code>https://www.cnblogs.com/jsccc520/p/13930358.html</code></p>\n","more":"<h1 id=\"0-缘由\"><a href=\"#0-缘由\" class=\"headerlink\" title=\"0. 缘由\"></a>0. 缘由</h1><p> 最近工作在接触uni-app,用它来开发微信小程序,也是第一次接触,找了很久,还有大佬用自己写的函数做的,俺觉得我不会也不配,刚好看到下面评论是官方也支持了,所以就用官方的了,这里记录一下</p>\n<h1 id=\"1-关于分包\"><a href=\"#1-关于分包\" class=\"headerlink\" title=\"1. 关于分包\"></a>1. 关于分包</h1><p> 好像是规定小程序不能超过2M,一旦超过就需要分包,因为是公司项目,肯定超过,所以就做个演示,权当记录吧</p>\n<h2 id=\"1-0-这是-官方文档\"><a href=\"#1-0-这是-官方文档\" class=\"headerlink\" title=\"1.0 这是 官方文档\"></a>1.0 这是 <a href=\"https://uniapp.dcloud.io/collocation/pages?id=subpackages\">官方文档</a></h2><h2 id=\"1-1-注意事项\"><a href=\"#1-1-注意事项\" class=\"headerlink\" title=\"1.1 注意事项\"></a>1.1 注意事项</h2><blockquote>\n<ol>\n<li><p><code>subPackages</code> 里的pages的路径是 <code>root</code> 下的相对路径，不是全路径。</p>\n</li>\n<li><p>微信小程序每个分包的大小是2M，总体积一共不能超过16M。</p>\n</li>\n<li><p>百度小程序每个分包的大小是2M，总体积一共不能超过8M。</p>\n</li>\n<li><p>支付宝小程序每个分包的大小是2M，总体积一共不能超过4M。</p>\n</li>\n<li><p>QQ小程序每个分包的大小是2M，总体积一共不能超过24M。</p>\n</li>\n<li><p>分包下支持独立的 <code>static</code> 目录，用来对静态资源进行分包。</p>\n</li>\n<li><p><code>uni-app</code>内支持对微信小程序、QQ小程序、百度小程序分包优化，即将静态资源或者js文件放入分包内不占用主包大小。详情请参考：<a href=\"https://uniapp.dcloud.io/collocation/manifest?id=%E5%85%B3%E4%BA%8E%E5%88%86%E5%8C%85%E4%BC%98%E5%8C%96%E7%9A%84%E8%AF%B4%E6%98%8E\">关于分包优化的说明</a></p>\n</li>\n<li><p>针对</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">vendor.js</span><br></pre></td></tr></table></figure>\n\n<p>过大的情况可以使用运行时压缩代码</p>\n<ul>\n<li><code>HBuilderX</code>创建的项目勾选<code>运行--&gt;运行到小程序模拟器--&gt;运行时是否压缩代码</code></li>\n<li><code>cli</code>创建的项目可以在<code>pacakge.json</code>中添加参数<code>--minimize</code>，示例：<code>&quot;dev:mp-weixin&quot;: &quot;cross-env NODE_ENV=development UNI_PLATFORM=mp-weixin vue-cli-service uni-build --watch --minimize&quot;</code></li>\n</ul>\n</li>\n</ol>\n</blockquote>\n<h1 id=\"2-使用方法\"><a href=\"#2-使用方法\" class=\"headerlink\" title=\"2.使用方法\"></a>2.使用方法</h1><h2 id=\"2-1-首先你得有个uniapp的微信小程序项目\"><a href=\"#2-1-首先你得有个uniapp的微信小程序项目\" class=\"headerlink\" title=\"2.1 首先你得有个uniapp的微信小程序项目\"></a>2.1 首先你得有个uniapp的微信小程序项目</h2><p> 这里假设你有了,原始项目结构</p>\n<p><img src=\"https://qny.aqingya.cn/img/20211104180618.png\"></p>\n<p><img src=\"https://qny.aqingya.cn/img/20211104180626.png\"></p>\n<h2 id=\"2-2-在pages同级创建分包\"><a href=\"#2-2-在pages同级创建分包\" class=\"headerlink\" title=\"2.2 在pages同级创建分包\"></a>2.2 在pages同级创建分包</h2><p><img src=\"https://qny.aqingya.cn/img/20211104180644.png\"></p>\n<h2 id=\"2-3-pages-json配置\"><a href=\"#2-3-pages-json配置\" class=\"headerlink\" title=\"2.3 pages.json配置\"></a>2.3 <code>pages.json</code>配置</h2><p><img src=\"https://qny.aqingya.cn/img/20211104180703.png\"></p>\n<h2 id=\"2-4-然后呢-官网支持了-分包优化\"><a href=\"#2-4-然后呢-官网支持了-分包优化\" class=\"headerlink\" title=\"2.4 然后呢,官网支持了 分包优化\"></a>2.4 然后呢,官网支持了 <a href=\"https://uniapp.dcloud.io/collocation/manifest?id=%E5%85%B3%E4%BA%8E%E5%88%86%E5%8C%85%E4%BC%98%E5%8C%96%E7%9A%84%E8%AF%B4%E6%98%8E\">分包优化</a></h2><blockquote>\n<ul>\n<li>在对应平台的配置下添加<code>&quot;optimization&quot;:&#123;&quot;subPackages&quot;:true&#125;</code>开启分包优化</li>\n<li>目前只支持<code>mp-weixin</code>、<code>mp-qq</code>、<code>mp-baidu</code>的分包优化</li>\n<li>分包优化具体逻辑：<ul>\n<li>静态文件：分包下支持 static 等静态资源拷贝，即分包目录内放置的静态资源不会被打包到主包中，也不可在主包中使用</li>\n<li>js文件：当某个 js 仅被一个分包引用时，该 js 会被打包到该分包内，否则仍打到主包（即被主包引用，或被超过 1 个分包引用）</li>\n<li>自定义组件：若某个自定义组件仅被一个分包引用时，且未放入到分包内，编译时会输出提示信息</li>\n</ul>\n</li>\n</ul>\n</blockquote>\n<blockquote>\n<p><em>我的理解呢就是,既然你分包了功能模块,那相应的静态资源你得分吧,用图片的时候直接是分包下的路径,这才是个完整的分包.</em></p>\n</blockquote>\n<p>这里我以微信小程序为例,</p>\n<p><img src=\"https://qny.aqingya.cn/img/20211104180722.png\"></p>\n<p><img src=\"https://qny.aqingya.cn/img/20211104180731.png\"></p>\n<h2 id=\"2-5-怎么跳转呢\"><a href=\"#2-5-怎么跳转呢\" class=\"headerlink\" title=\"2.5 怎么跳转呢?\"></a>2.5 怎么跳转呢?</h2><p>在需要点击跳转的地方就好啦</p>\n<figure class=\"highlight plaintext\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">uni.navigateTo(&#123;</span><br><span class=\"line\">  url: &#x27;/myPackageA/pages/piece/piece&#x27;</span><br><span class=\"line\">&#125;)</span><br></pre></td></tr></table></figure>\n\n<h2 id=\"2-6-然后重启微信开发工具运行\"><a href=\"#2-6-然后重启微信开发工具运行\" class=\"headerlink\" title=\"2.6 然后重启微信开发工具运行\"></a>2.6 然后重启微信开发工具运行</h2><p><img src=\"https://qny.aqingya.cn/img/20211104180829.png\"></p>\n<p>可以看到已经分包成功</p>\n<p><br><br></p>\n<p>参考：<code>https://www.cnblogs.com/jsccc520/p/13930358.html</code></p>\n","categories":[{"name":"uni-app开发","path":"api/categories/uni-app开发.json"}],"tags":[{"name":"微信小程序","path":"api/tags/微信小程序.json"},{"name":"uni-app开发","path":"api/tags/uni-app开发.json"}]}