{"title":"JavaScript ---鼠标拖拽元素问题总结","slug":"sixteen","date":"2020-04-25T05:04:44.000Z","updated":"2022-07-29T04:22:04.753Z","comments":true,"path":"api/articles/sixteen.json","excerpt":" [Figure] ","covers":["https://qny.aqingya.cn/img/6982b2ca728b489ead7ed596fe50552c.jpg"],"content":"<p><img src=\"https://qny.aqingya.cn/img/6982b2ca728b489ead7ed596fe50552c.jpg\"></p>\n<span id=\"more\"></span>\n\n<p>大致分为三个步骤：</p>\n<ol>\n<li>鼠标摁下       onmousedown</li>\n<li>鼠标移动    onmousemove</li>\n<li>鼠标抬起    onmouseup</li>\n</ol>\n<p> <strong>注意的一点是 onmousemove事件和onmouseup事件是在onmousedown事件里面的</strong></p>\n<h2 id=\"代码如下（不支持IE8及以下浏览器）：代码一\"><a href=\"#代码如下（不支持IE8及以下浏览器）：代码一\" class=\"headerlink\" title=\"代码如下（不支持IE8及以下浏览器）：代码一\"></a>代码如下（不支持IE8及以下浏览器）：代码一</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=<span class=\"string\">&quot;en&quot;</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span><br><span class=\"line\">    &lt;meta name=<span class=\"string\">&quot;viewport&quot;</span> content=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class=\"line\">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class=\"line\">    &lt;style&gt;</span><br><span class=\"line\">        body &#123;</span><br><span class=\"line\">            height: 3000px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        #box1 &#123;</span><br><span class=\"line\">            width: 100px;</span><br><span class=\"line\">            height: 100px;</span><br><span class=\"line\">            background-color: #bbffaa;</span><br><span class=\"line\">            position: absolute;</span><br><span class=\"line\">            margin-left: 100px;</span><br><span class=\"line\">            z-index: <span class=\"number\">33</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        #box2 &#123;</span><br><span class=\"line\">            width: 100px;</span><br><span class=\"line\">            height: 100px;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            position: absolute;</span><br><span class=\"line\">            top: 300px;</span><br><span class=\"line\">            left: 300px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &lt;/style&gt;</span><br><span class=\"line\">    &lt;script&gt;</span><br><span class=\"line\">        window.onload = function() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">var</span> box1 = document.getElementById(<span class=\"string\">&quot;box1&quot;</span>);</span><br><span class=\"line\">            dary(box1);</span><br><span class=\"line\">            dary(box2);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\">function <span class=\"title\">dary</span><span class=\"params\">(obj)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 为box设置鼠标按下事件  </span></span><br><span class=\"line\">            obj.onmousedown = function(event) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 解决 event兼容性</span></span><br><span class=\"line\">                event = event || window.event;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">//元素上偏移量 = 鼠标.clientY-元素。offsetTop +元素的上外边距 </span></span><br><span class=\"line\">                <span class=\"comment\">//元素左偏移量 = 鼠标.clientX-元素。offsetleft +元素的下外边距</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> ot = event.pageY - obj.offsetTop + parseInt(getComputedStyle(obj, <span class=\"keyword\">null</span>)[<span class=\"string\">&quot;margin-top&quot;</span>]);</span><br><span class=\"line\">                <span class=\"keyword\">var</span> ol = event.pageX - obj.offsetLeft + parseInt(getComputedStyle(obj, <span class=\"keyword\">null</span>)[<span class=\"string\">&quot;margin-left&quot;</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 设置鼠标在box上的移动事件</span></span><br><span class=\"line\">                document.onmousemove = function(event) &#123;</span><br><span class=\"line\">                    event = event || window.event;</span><br><span class=\"line\">                    <span class=\"comment\">// 获取鼠标的位置坐标</span></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> top = event.pageY - ot;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> left = event.pageX - ol;</span><br><span class=\"line\">                    <span class=\"comment\">// 设置元素的位置</span></span><br><span class=\"line\">                    obj.style.top = top + <span class=\"string\">&quot;px&quot;</span>;</span><br><span class=\"line\">                    obj.style.left = left + <span class=\"string\">&quot;px&quot;</span>;</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">                <span class=\"comment\">// 设置鼠标在box上的抬起事件</span></span><br><span class=\"line\">                document.onmouseup = function() &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 当鼠标抬起时，取消onmousemove事件</span></span><br><span class=\"line\">                    document.onmousemove = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                    <span class=\"comment\">// 当鼠标抬起时，取消onmouseup事件</span></span><br><span class=\"line\">                    document.onmouseup = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">                        当我们拖拽一个网页中的内容时，浏览器会默认去搜索引擎汇总的搜索内容，</span></span><br><span class=\"line\"><span class=\"comment\">                        此时会导致拖拽功能的异常，这个是浏览器提供的默认行为，</span></span><br><span class=\"line\"><span class=\"comment\">                        如果不希望发生这个行为 ，则可以通过return false来取消默认行为</span></span><br><span class=\"line\"><span class=\"comment\">    </span></span><br><span class=\"line\"><span class=\"comment\">                        该方法解决对IE8及以下浏览器 不适用， 其他都好使</span></span><br><span class=\"line\"><span class=\"comment\">                    */</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &lt;/script&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;p&gt;asdfasd&lt;/p&gt;</span><br><span class=\"line\">    &lt;div id=<span class=\"string\">&quot;box1&quot;</span>&gt;&lt;/div&gt;</span><br><span class=\"line\">    &lt;div id=<span class=\"string\">&quot;box2&quot;</span>&gt;&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n<br>\n\n<hr>\n<br>\n<br>\n<br>\n愿你的坚持终有收获。\n\n\n\n","more":"<p>大致分为三个步骤：</p>\n<ol>\n<li>鼠标摁下       onmousedown</li>\n<li>鼠标移动    onmousemove</li>\n<li>鼠标抬起    onmouseup</li>\n</ol>\n<p> <strong>注意的一点是 onmousemove事件和onmouseup事件是在onmousedown事件里面的</strong></p>\n<h2 id=\"代码如下（不支持IE8及以下浏览器）：代码一\"><a href=\"#代码如下（不支持IE8及以下浏览器）：代码一\" class=\"headerlink\" title=\"代码如下（不支持IE8及以下浏览器）：代码一\"></a>代码如下（不支持IE8及以下浏览器）：代码一</h2><figure class=\"highlight java\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br><span class=\"line\">67</span><br><span class=\"line\">68</span><br><span class=\"line\">69</span><br><span class=\"line\">70</span><br><span class=\"line\">71</span><br><span class=\"line\">72</span><br><span class=\"line\">73</span><br><span class=\"line\">74</span><br><span class=\"line\">75</span><br><span class=\"line\">76</span><br><span class=\"line\">77</span><br><span class=\"line\">78</span><br><span class=\"line\">79</span><br><span class=\"line\">80</span><br><span class=\"line\">81</span><br><span class=\"line\">82</span><br><span class=\"line\">83</span><br><span class=\"line\">84</span><br><span class=\"line\">85</span><br><span class=\"line\">86</span><br><span class=\"line\">87</span><br><span class=\"line\">88</span><br><span class=\"line\">89</span><br><span class=\"line\">90</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;!DOCTYPE html&gt;</span><br><span class=\"line\">&lt;html lang=<span class=\"string\">&quot;en&quot;</span>&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;head&gt;</span><br><span class=\"line\">    &lt;meta charset=<span class=\"string\">&quot;UTF-8&quot;</span>&gt;</span><br><span class=\"line\">    &lt;meta name=<span class=\"string\">&quot;viewport&quot;</span> content=<span class=\"string\">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span><br><span class=\"line\">    &lt;title&gt;Document&lt;/title&gt;</span><br><span class=\"line\">    &lt;style&gt;</span><br><span class=\"line\">        body &#123;</span><br><span class=\"line\">            height: 3000px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        #box1 &#123;</span><br><span class=\"line\">            width: 100px;</span><br><span class=\"line\">            height: 100px;</span><br><span class=\"line\">            background-color: #bbffaa;</span><br><span class=\"line\">            position: absolute;</span><br><span class=\"line\">            margin-left: 100px;</span><br><span class=\"line\">            z-index: <span class=\"number\">33</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        </span><br><span class=\"line\">        #box2 &#123;</span><br><span class=\"line\">            width: 100px;</span><br><span class=\"line\">            height: 100px;</span><br><span class=\"line\">            background-color: red;</span><br><span class=\"line\">            position: absolute;</span><br><span class=\"line\">            top: 300px;</span><br><span class=\"line\">            left: 300px;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &lt;/style&gt;</span><br><span class=\"line\">    &lt;script&gt;</span><br><span class=\"line\">        window.onload = function() &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            <span class=\"keyword\">var</span> box1 = document.getElementById(<span class=\"string\">&quot;box1&quot;</span>);</span><br><span class=\"line\">            dary(box1);</span><br><span class=\"line\">            dary(box2);</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">        <span class=\"function\">function <span class=\"title\">dary</span><span class=\"params\">(obj)</span> </span>&#123;</span><br><span class=\"line\">            <span class=\"comment\">// 为box设置鼠标按下事件  </span></span><br><span class=\"line\">            obj.onmousedown = function(event) &#123;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 解决 event兼容性</span></span><br><span class=\"line\">                event = event || window.event;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">//元素上偏移量 = 鼠标.clientY-元素。offsetTop +元素的上外边距 </span></span><br><span class=\"line\">                <span class=\"comment\">//元素左偏移量 = 鼠标.clientX-元素。offsetleft +元素的下外边距</span></span><br><span class=\"line\">                <span class=\"keyword\">var</span> ot = event.pageY - obj.offsetTop + parseInt(getComputedStyle(obj, <span class=\"keyword\">null</span>)[<span class=\"string\">&quot;margin-top&quot;</span>]);</span><br><span class=\"line\">                <span class=\"keyword\">var</span> ol = event.pageX - obj.offsetLeft + parseInt(getComputedStyle(obj, <span class=\"keyword\">null</span>)[<span class=\"string\">&quot;margin-left&quot;</span>]);</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">// 设置鼠标在box上的移动事件</span></span><br><span class=\"line\">                document.onmousemove = function(event) &#123;</span><br><span class=\"line\">                    event = event || window.event;</span><br><span class=\"line\">                    <span class=\"comment\">// 获取鼠标的位置坐标</span></span><br><span class=\"line\">                    <span class=\"keyword\">var</span> top = event.pageY - ot;</span><br><span class=\"line\">                    <span class=\"keyword\">var</span> left = event.pageX - ol;</span><br><span class=\"line\">                    <span class=\"comment\">// 设置元素的位置</span></span><br><span class=\"line\">                    obj.style.top = top + <span class=\"string\">&quot;px&quot;</span>;</span><br><span class=\"line\">                    obj.style.left = left + <span class=\"string\">&quot;px&quot;</span>;</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">                <span class=\"comment\">// 设置鼠标在box上的抬起事件</span></span><br><span class=\"line\">                document.onmouseup = function() &#123;</span><br><span class=\"line\">                    <span class=\"comment\">// 当鼠标抬起时，取消onmousemove事件</span></span><br><span class=\"line\">                    document.onmousemove = <span class=\"keyword\">null</span>;</span><br><span class=\"line\">                    <span class=\"comment\">// 当鼠标抬起时，取消onmouseup事件</span></span><br><span class=\"line\">                    document.onmouseup = <span class=\"keyword\">null</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">                <span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">                        当我们拖拽一个网页中的内容时，浏览器会默认去搜索引擎汇总的搜索内容，</span></span><br><span class=\"line\"><span class=\"comment\">                        此时会导致拖拽功能的异常，这个是浏览器提供的默认行为，</span></span><br><span class=\"line\"><span class=\"comment\">                        如果不希望发生这个行为 ，则可以通过return false来取消默认行为</span></span><br><span class=\"line\"><span class=\"comment\">    </span></span><br><span class=\"line\"><span class=\"comment\">                        该方法解决对IE8及以下浏览器 不适用， 其他都好使</span></span><br><span class=\"line\"><span class=\"comment\">                    */</span></span><br><span class=\"line\">                <span class=\"keyword\">return</span> <span class=\"keyword\">false</span>;</span><br><span class=\"line\">            &#125;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &lt;/script&gt;</span><br><span class=\"line\">&lt;/head&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;body&gt;</span><br><span class=\"line\">    &lt;p&gt;asdfasd&lt;/p&gt;</span><br><span class=\"line\">    &lt;div id=<span class=\"string\">&quot;box1&quot;</span>&gt;&lt;/div&gt;</span><br><span class=\"line\">    &lt;div id=<span class=\"string\">&quot;box2&quot;</span>&gt;&lt;/div&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/body&gt;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;/html&gt;</span><br></pre></td></tr></table></figure>\n<br>\n\n<hr>\n<br>\n<br>\n<br>\n愿你的坚持终有收获。","categories":[{"name":"JavaScript","path":"api/categories/JavaScript.json"}],"tags":[{"name":"JavaScript","path":"api/tags/JavaScript.json"}]}