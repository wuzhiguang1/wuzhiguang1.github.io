{"title":"时间戳转化日期格式","slug":"94","date":"2020-08-18T13:24:41.000Z","updated":"2022-07-29T04:22:04.755Z","comments":true,"path":"api/articles/94.json","excerpt":" [Figure] ","covers":["https://cdn.jsdelivr.net/gh/wuzhiguang1/bolgfile@1.2/photo/IMG_0049.JPG","https://qny.aqingya.cn/img/20200830123431.png","https://qny.aqingya.cn/img/20200830123537.png"],"content":"<p><img src=\"https://cdn.jsdelivr.net/gh/wuzhiguang1/bolgfile@1.2/photo/IMG_0049.JPG\"></p>\n<span id=\"more\"></span>\n\n<p>什么是Unix时间戳(Unix timestamp)： Unix时间戳(Unix timestamp)，或称Unix时间(Unix time)、POSIX时间(POSIX time)，是一种时间表示方式，定义为从格林威治时间1970年01月01日00时00分00秒起至现在的总秒数。Unix时间戳不仅被使用在Unix系统、类Unix系统中，也在许多其他操作系统中被广泛采用。</p>\n<p>目前相当一部分操作系统使用32位二进制数字表示时间。此类系统的Unix时间戳最多可以使用到格林威治时间2038年01月19日03时14分07秒（二进制：01111111 11111111 11111111 11111111）。其后一秒，二进制数字会变为10000000 00000000 00000000 00000000，发生溢出错误，造成系统将时间误解为1901年12月13日20时45分52秒。这很可能会引起软件故障，甚至是系统瘫痪。使用64位二进制数字表示时间的系统（最多可以使用到格林威治时间292,277,026,596年12月04日15时30分08秒）则基本不会遇到这类溢出问题。</p>\n<br>\n\n<h2 id=\"JS获取当前时间戳的方法\"><a href=\"#JS获取当前时间戳的方法\" class=\"headerlink\" title=\"JS获取当前时间戳的方法\"></a>JS获取当前时间戳的方法</h2><p><strong>JavaScript 获取当前时间戳：</strong><br><strong>第一种方法：(这种方法只精确到秒)</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> timestamp = <span class=\"built_in\">Date</span>.parse(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>());</span><br></pre></td></tr></table></figure>\n\n<p><strong>结果：1597729790000</strong></p>\n<br>\n\n<p><strong>第二种方法：</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> timestamp = (<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()).valueOf();</span><br></pre></td></tr></table></figure>\n\n<p><strong>结果：1597729790268</strong></p>\n<br>\n\n<p><strong>第三种方法：</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> timestamp=<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime();</span><br></pre></td></tr></table></figure>\n\n<p><strong>结果：1597729790269</strong></p>\n<h2 id=\"一-js将时间转换成时间戳\"><a href=\"#一-js将时间转换成时间戳\" class=\"headerlink\" title=\"一.js将时间转换成时间戳\"></a>一.js将时间转换成时间戳</h2><p>1.js获取当前时间戳的方法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> timestamp1 = <span class=\"built_in\">Date</span>.parse(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>());</span><br><span class=\"line\"><span class=\"keyword\">var</span> timestamp2 = (<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()).valueOf();</span><br><span class=\"line\"><span class=\"keyword\">var</span> timestamp3 = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime();</span><br></pre></td></tr></table></figure>\n\n<p>第一种：获取的时间戳是把毫秒改成000显示，第二种和第三种是获取了当前毫秒的时间戳。</p>\n<p>2.js获取指定时间戳的方法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> oldTime = (<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(<span class=\"string\">&quot;2015/06/23 08:00:20&quot;</span>)).getTime()/<span class=\"number\">1000</span>;</span><br></pre></td></tr></table></figure>\n\n<p>getTime()返回数值的单位是毫秒。</p>\n<p><a href=\"http://codepen.io/jingwhale/pen/OVBLqg\">演示</a></p>\n<h2 id=\"二-js把时间戳转为为普通日期格式\"><a href=\"#二-js把时间戳转为为普通日期格式\" class=\"headerlink\" title=\"二.js把时间戳转为为普通日期格式\"></a>二.js把时间戳转为为普通日期格式</h2><p>1.Date toLocaleString方法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getLocalTime</span>(<span class=\"params\">nS</span>) </span>&#123;     </span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(<span class=\"built_in\">parseInt</span>(nS) * <span class=\"number\">1000</span>).toLocaleString().replace(<span class=\"regexp\">/:\\d&#123;1,2&#125;$/</span>,<span class=\"string\">&#x27; &#x27;</span>);     </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>parseInt() 函数可解析一个字符串，并返回一个整数。</p>\n<p>js中时间操作单位是毫秒。</p>\n<p>toLocaleString() 方法可根据本地时间把 Date 对象转换为字符串，并返回结果。</p>\n<p>replace() 方法用于在字符串中用一些字符替换另一些字符，或替换一个与正则表达式匹配的子串。</p>\n<p>replace(/:\\d{1,2}$/,’ ‘)验证替换以：开始有一位或二位数字的结束字符串，就是秒；替换为空</p>\n<p>显示如下：</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200830123431.png\"></p>\n<p><a href=\"http://codepen.io/jingwhale/pen/GJYKyq\">演示</a></p>\n<p>所以我们可以利用正则表达式改变我们想要的日期格式。</p>\n<p>2.Date 属性方法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add0</span>(<span class=\"params\">m</span>)</span>&#123;<span class=\"keyword\">return</span> m&lt;<span class=\"number\">10</span>?<span class=\"string\">&#x27;0&#x27;</span>+m:m &#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">format</span>(<span class=\"params\">shijianchuo</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//shijianchuo是整数，否则要parseInt转换</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> time = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(shijianchuo);</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> y = time.getFullYear();</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> m = time.getMonth()+<span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> d = time.getDate();</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> h = time.getHours();</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> mm = time.getMinutes();</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> s = time.getSeconds();</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> y+<span class=\"string\">&#x27;-&#x27;</span>+add0(m)+<span class=\"string\">&#x27;-&#x27;</span>+add0(d)+<span class=\"string\">&#x27; &#x27;</span>+add0(h)+<span class=\"string\">&#x27;:&#x27;</span>+add0(mm)+<span class=\"string\">&#x27;:&#x27;</span>+add0(s);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://qny.aqingya.cn/img/20200830123537.png\"></p>\n<h2 id=\"三-时间戳转化日期格式\"><a href=\"#三-时间戳转化日期格式\" class=\"headerlink\" title=\"三.时间戳转化日期格式\"></a>三.时间戳转化日期格式</h2><p>在开发中，我们通常请求到时间是以时间戳的形式返回给我们的，那我们怎么将时间戳转换成正常的日期形式呢？</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 假设从请求的数据中拿到的时间戳</span></span><br><span class=\"line\">   <span class=\"keyword\">const</span> timestamp = <span class=\"string\">&#x27;1597727634&#x27;</span></span><br><span class=\"line\">   <span class=\"built_in\">console</span>.log(timestamp);</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">// 将时间戳转化为Date类型，并将时间戳转化为 ms</span></span><br><span class=\"line\">   <span class=\"keyword\">const</span> date = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(timestamp * <span class=\"number\">1000</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">// 使用工具函数 形式一</span></span><br><span class=\"line\">   <span class=\"keyword\">const</span> showdate = formatDate(date, <span class=\"string\">&#x27;yyyy-MM-dd&#x27;</span>)</span><br><span class=\"line\">   <span class=\"built_in\">console</span>.log(showdate);</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">// 使用工具函数 形式二</span></span><br><span class=\"line\">   <span class=\"keyword\">const</span> showdate1 = formatDate(date, <span class=\"string\">&#x27;yyyy:MM:dd&#x27;</span>)</span><br><span class=\"line\">   <span class=\"built_in\">console</span>.log(showdate1);</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">// 使用工具函数 形式三</span></span><br><span class=\"line\">   <span class=\"keyword\">const</span> showdate2 = formatDate(date, <span class=\"string\">&#x27;yyyy:MM:dd hh:mm:ss&#x27;</span>)</span><br><span class=\"line\">   <span class=\"built_in\">console</span>.log(showdate2);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 工具函数</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">formatDate</span>(<span class=\"params\">date, fmt</span>) </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (<span class=\"regexp\">/(y+)/</span>.test(fmt)) &#123;</span><br><span class=\"line\">       fmt = fmt.replace(<span class=\"built_in\">RegExp</span>.$1, (date.getFullYear() + <span class=\"string\">&#x27;&#x27;</span>).substr(<span class=\"number\">4</span> - <span class=\"built_in\">RegExp</span>.$1.length));</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"keyword\">let</span> o = &#123;</span><br><span class=\"line\">       <span class=\"string\">&#x27;M+&#x27;</span>: date.getMonth() + <span class=\"number\">1</span>,</span><br><span class=\"line\">       <span class=\"string\">&#x27;d+&#x27;</span>: date.getDate(),</span><br><span class=\"line\">       <span class=\"string\">&#x27;h+&#x27;</span>: date.getHours(),</span><br><span class=\"line\">       <span class=\"string\">&#x27;m+&#x27;</span>: date.getMinutes(),</span><br><span class=\"line\">       <span class=\"string\">&#x27;s+&#x27;</span>: date.getSeconds()</span><br><span class=\"line\">     &#125;;</span><br><span class=\"line\">     <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> k <span class=\"keyword\">in</span> o) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">if</span> (<span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">`(<span class=\"subst\">$&#123;k&#125;</span>)`</span>).test(fmt)) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">let</span> str = o[k] + <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">         fmt = fmt.replace(<span class=\"built_in\">RegExp</span>.$1, (<span class=\"built_in\">RegExp</span>.$1.length === <span class=\"number\">1</span>) ? str : padLeftZero(str));</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"keyword\">return</span> fmt;</span><br><span class=\"line\">   &#125;;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">padLeftZero</span>(<span class=\"params\">str</span>) </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">return</span> (<span class=\"string\">&#x27;00&#x27;</span> + str).substr(str.length);</span><br><span class=\"line\">   &#125;;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><a href=\"https://www.zhangxinxu.com/php/microCodeDetail?id=10\">https://www.zhangxinxu.com/php/microCodeDetail?id=10</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">** 时间戳转换成指定格式日期</span></span><br><span class=\"line\"><span class=\"comment\">** eg. </span></span><br><span class=\"line\"><span class=\"comment\">** dateFormat(11111111111111, &#x27;Y年m月d日 H时i分&#x27;)</span></span><br><span class=\"line\"><span class=\"comment\">** → &quot;2322年02月06日 03时45分&quot;</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> dateFormat = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">timestamp, formats</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// formats格式包括</span></span><br><span class=\"line\">    <span class=\"comment\">// 1. Y-m-d</span></span><br><span class=\"line\">    <span class=\"comment\">// 2. Y-m-d H:i:s</span></span><br><span class=\"line\">    <span class=\"comment\">// 3. Y年m月d日</span></span><br><span class=\"line\">    <span class=\"comment\">// 4. Y年m月d日 H时i分</span></span><br><span class=\"line\">    formats = formats || <span class=\"string\">&#x27;Y-m-d&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> zero = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (value &lt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&#x27;0&#x27;</span> + value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> value;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> myDate = timestamp? <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(timestamp): <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> year = myDate.getFullYear();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> month = zero(myDate.getMonth() + <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> day = zero(myDate.getDate());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> hour = zero(myDate.getHours());</span><br><span class=\"line\">    <span class=\"keyword\">var</span> minite = zero(myDate.getMinutes());</span><br><span class=\"line\">    <span class=\"keyword\">var</span> second = zero(myDate.getSeconds());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> formats.replace(<span class=\"regexp\">/Y|m|d|H|i|s/ig</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">matches</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (&#123;</span><br><span class=\"line\">            <span class=\"attr\">Y</span>: year,</span><br><span class=\"line\">            <span class=\"attr\">m</span>: month,</span><br><span class=\"line\">            <span class=\"attr\">d</span>: day,</span><br><span class=\"line\">            <span class=\"attr\">H</span>: hour,</span><br><span class=\"line\">            <span class=\"attr\">i</span>: minite,</span><br><span class=\"line\">            <span class=\"attr\">s</span>: second</span><br><span class=\"line\">        &#125;)[matches];</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<hr>\n<h2 id=\"四-指定时间到当前时间的计算\"><a href=\"#四-指定时间到当前时间的计算\" class=\"headerlink\" title=\"四.指定时间到当前时间的计算\"></a>四.指定时间到当前时间的计算</h2><p><a href=\"https://www.zhangxinxu.com/php/microCodeDetail?id=11\">https://www.zhangxinxu.com/php/microCodeDetail?id=11</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> dateDiff = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">timestamp</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 补全为13位</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> arrTimestamp = (timestamp + <span class=\"string\">&#x27;&#x27;</span>).split(<span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> start = <span class=\"number\">0</span>; start &lt; <span class=\"number\">13</span>; start++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!arrTimestamp[start]) &#123;</span><br><span class=\"line\">            arrTimestamp[start] = <span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    timestamp = arrTimestamp.join(<span class=\"string\">&#x27;&#x27;</span>) * <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">var</span> minute = <span class=\"number\">1000</span> * <span class=\"number\">60</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> hour = minute * <span class=\"number\">60</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> day = hour * <span class=\"number\">24</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> halfamonth = day * <span class=\"number\">15</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> month = day * <span class=\"number\">30</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> now = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> diffValue = now - timestamp;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// 如果本地时间反而小于变量时间</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (diffValue &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;不久前&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// 计算差异时间的量级</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> monthC = diffValue / month;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> weekC = diffValue / (<span class=\"number\">7</span> * day);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> dayC = diffValue / day;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> hourC = diffValue / hour;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> minC = diffValue / minute;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// 数值补0方法</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> zero = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (value &lt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&#x27;0&#x27;</span> + value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> value;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// 使用</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (monthC &gt; <span class=\"number\">12</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 超过1年，直接显示年月日</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> date = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(timestamp);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> date.getFullYear() + <span class=\"string\">&#x27;年&#x27;</span> + zero(date.getMonth() + <span class=\"number\">1</span>) + <span class=\"string\">&#x27;月&#x27;</span> + zero(date.getDate()) + <span class=\"string\">&#x27;日&#x27;</span>;</span><br><span class=\"line\">        &#125;)();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (monthC &gt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">parseInt</span>(monthC) + <span class=\"string\">&quot;月前&quot;</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (weekC &gt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">parseInt</span>(weekC) + <span class=\"string\">&quot;周前&quot;</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (dayC &gt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">parseInt</span>(dayC) + <span class=\"string\">&quot;天前&quot;</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (hourC &gt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">parseInt</span>(hourC) + <span class=\"string\">&quot;小时前&quot;</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (minC &gt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">parseInt</span>(minC) + <span class=\"string\">&quot;分钟前&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;刚刚&#x27;</span>;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p><br><br><br></p>\n","more":"<p>什么是Unix时间戳(Unix timestamp)： Unix时间戳(Unix timestamp)，或称Unix时间(Unix time)、POSIX时间(POSIX time)，是一种时间表示方式，定义为从格林威治时间1970年01月01日00时00分00秒起至现在的总秒数。Unix时间戳不仅被使用在Unix系统、类Unix系统中，也在许多其他操作系统中被广泛采用。</p>\n<p>目前相当一部分操作系统使用32位二进制数字表示时间。此类系统的Unix时间戳最多可以使用到格林威治时间2038年01月19日03时14分07秒（二进制：01111111 11111111 11111111 11111111）。其后一秒，二进制数字会变为10000000 00000000 00000000 00000000，发生溢出错误，造成系统将时间误解为1901年12月13日20时45分52秒。这很可能会引起软件故障，甚至是系统瘫痪。使用64位二进制数字表示时间的系统（最多可以使用到格林威治时间292,277,026,596年12月04日15时30分08秒）则基本不会遇到这类溢出问题。</p>\n<br>\n\n<h2 id=\"JS获取当前时间戳的方法\"><a href=\"#JS获取当前时间戳的方法\" class=\"headerlink\" title=\"JS获取当前时间戳的方法\"></a>JS获取当前时间戳的方法</h2><p><strong>JavaScript 获取当前时间戳：</strong><br><strong>第一种方法：(这种方法只精确到秒)</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> timestamp = <span class=\"built_in\">Date</span>.parse(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>());</span><br></pre></td></tr></table></figure>\n\n<p><strong>结果：1597729790000</strong></p>\n<br>\n\n<p><strong>第二种方法：</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> timestamp = (<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()).valueOf();</span><br></pre></td></tr></table></figure>\n\n<p><strong>结果：1597729790268</strong></p>\n<br>\n\n<p><strong>第三种方法：</strong></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> timestamp=<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime();</span><br></pre></td></tr></table></figure>\n\n<p><strong>结果：1597729790269</strong></p>\n<h2 id=\"一-js将时间转换成时间戳\"><a href=\"#一-js将时间转换成时间戳\" class=\"headerlink\" title=\"一.js将时间转换成时间戳\"></a>一.js将时间转换成时间戳</h2><p>1.js获取当前时间戳的方法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> timestamp1 = <span class=\"built_in\">Date</span>.parse(<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>());</span><br><span class=\"line\"><span class=\"keyword\">var</span> timestamp2 = (<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>()).valueOf();</span><br><span class=\"line\"><span class=\"keyword\">var</span> timestamp3 = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime();</span><br></pre></td></tr></table></figure>\n\n<p>第一种：获取的时间戳是把毫秒改成000显示，第二种和第三种是获取了当前毫秒的时间戳。</p>\n<p>2.js获取指定时间戳的方法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> oldTime = (<span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(<span class=\"string\">&quot;2015/06/23 08:00:20&quot;</span>)).getTime()/<span class=\"number\">1000</span>;</span><br></pre></td></tr></table></figure>\n\n<p>getTime()返回数值的单位是毫秒。</p>\n<p><a href=\"http://codepen.io/jingwhale/pen/OVBLqg\">演示</a></p>\n<h2 id=\"二-js把时间戳转为为普通日期格式\"><a href=\"#二-js把时间戳转为为普通日期格式\" class=\"headerlink\" title=\"二.js把时间戳转为为普通日期格式\"></a>二.js把时间戳转为为普通日期格式</h2><p>1.Date toLocaleString方法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">getLocalTime</span>(<span class=\"params\">nS</span>) </span>&#123;     </span><br><span class=\"line\">   <span class=\"keyword\">return</span> <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(<span class=\"built_in\">parseInt</span>(nS) * <span class=\"number\">1000</span>).toLocaleString().replace(<span class=\"regexp\">/:\\d&#123;1,2&#125;$/</span>,<span class=\"string\">&#x27; &#x27;</span>);     </span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p>parseInt() 函数可解析一个字符串，并返回一个整数。</p>\n<p>js中时间操作单位是毫秒。</p>\n<p>toLocaleString() 方法可根据本地时间把 Date 对象转换为字符串，并返回结果。</p>\n<p>replace() 方法用于在字符串中用一些字符替换另一些字符，或替换一个与正则表达式匹配的子串。</p>\n<p>replace(/:\\d{1,2}$/,’ ‘)验证替换以：开始有一位或二位数字的结束字符串，就是秒；替换为空</p>\n<p>显示如下：</p>\n<p><img src=\"https://qny.aqingya.cn/img/20200830123431.png\"></p>\n<p><a href=\"http://codepen.io/jingwhale/pen/GJYKyq\">演示</a></p>\n<p>所以我们可以利用正则表达式改变我们想要的日期格式。</p>\n<p>2.Date 属性方法</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">add0</span>(<span class=\"params\">m</span>)</span>&#123;<span class=\"keyword\">return</span> m&lt;<span class=\"number\">10</span>?<span class=\"string\">&#x27;0&#x27;</span>+m:m &#125;</span><br><span class=\"line\"><span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">format</span>(<span class=\"params\">shijianchuo</span>)</span></span><br><span class=\"line\"><span class=\"function\"></span>&#123;</span><br><span class=\"line\">\t<span class=\"comment\">//shijianchuo是整数，否则要parseInt转换</span></span><br><span class=\"line\">\t<span class=\"keyword\">var</span> time = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(shijianchuo);</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> y = time.getFullYear();</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> m = time.getMonth()+<span class=\"number\">1</span>;</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> d = time.getDate();</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> h = time.getHours();</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> mm = time.getMinutes();</span><br><span class=\"line\">\t<span class=\"keyword\">var</span> s = time.getSeconds();</span><br><span class=\"line\">\t<span class=\"keyword\">return</span> y+<span class=\"string\">&#x27;-&#x27;</span>+add0(m)+<span class=\"string\">&#x27;-&#x27;</span>+add0(d)+<span class=\"string\">&#x27; &#x27;</span>+add0(h)+<span class=\"string\">&#x27;:&#x27;</span>+add0(mm)+<span class=\"string\">&#x27;:&#x27;</span>+add0(s);</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>\n\n<p><img src=\"https://qny.aqingya.cn/img/20200830123537.png\"></p>\n<h2 id=\"三-时间戳转化日期格式\"><a href=\"#三-时间戳转化日期格式\" class=\"headerlink\" title=\"三.时间戳转化日期格式\"></a>三.时间戳转化日期格式</h2><p>在开发中，我们通常请求到时间是以时间戳的形式返回给我们的，那我们怎么将时间戳转换成正常的日期形式呢？</p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"comment\">// 假设从请求的数据中拿到的时间戳</span></span><br><span class=\"line\">   <span class=\"keyword\">const</span> timestamp = <span class=\"string\">&#x27;1597727634&#x27;</span></span><br><span class=\"line\">   <span class=\"built_in\">console</span>.log(timestamp);</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">// 将时间戳转化为Date类型，并将时间戳转化为 ms</span></span><br><span class=\"line\">   <span class=\"keyword\">const</span> date = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(timestamp * <span class=\"number\">1000</span>)</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">// 使用工具函数 形式一</span></span><br><span class=\"line\">   <span class=\"keyword\">const</span> showdate = formatDate(date, <span class=\"string\">&#x27;yyyy-MM-dd&#x27;</span>)</span><br><span class=\"line\">   <span class=\"built_in\">console</span>.log(showdate);</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">// 使用工具函数 形式二</span></span><br><span class=\"line\">   <span class=\"keyword\">const</span> showdate1 = formatDate(date, <span class=\"string\">&#x27;yyyy:MM:dd&#x27;</span>)</span><br><span class=\"line\">   <span class=\"built_in\">console</span>.log(showdate1);</span><br><span class=\"line\"></span><br><span class=\"line\">   <span class=\"comment\">// 使用工具函数 形式三</span></span><br><span class=\"line\">   <span class=\"keyword\">const</span> showdate2 = formatDate(date, <span class=\"string\">&#x27;yyyy:MM:dd hh:mm:ss&#x27;</span>)</span><br><span class=\"line\">   <span class=\"built_in\">console</span>.log(showdate2);</span><br><span class=\"line\"></span><br><span class=\"line\">  <span class=\"comment\">// 工具函数</span></span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">formatDate</span>(<span class=\"params\">date, fmt</span>) </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">if</span> (<span class=\"regexp\">/(y+)/</span>.test(fmt)) &#123;</span><br><span class=\"line\">       fmt = fmt.replace(<span class=\"built_in\">RegExp</span>.$1, (date.getFullYear() + <span class=\"string\">&#x27;&#x27;</span>).substr(<span class=\"number\">4</span> - <span class=\"built_in\">RegExp</span>.$1.length));</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"keyword\">let</span> o = &#123;</span><br><span class=\"line\">       <span class=\"string\">&#x27;M+&#x27;</span>: date.getMonth() + <span class=\"number\">1</span>,</span><br><span class=\"line\">       <span class=\"string\">&#x27;d+&#x27;</span>: date.getDate(),</span><br><span class=\"line\">       <span class=\"string\">&#x27;h+&#x27;</span>: date.getHours(),</span><br><span class=\"line\">       <span class=\"string\">&#x27;m+&#x27;</span>: date.getMinutes(),</span><br><span class=\"line\">       <span class=\"string\">&#x27;s+&#x27;</span>: date.getSeconds()</span><br><span class=\"line\">     &#125;;</span><br><span class=\"line\">     <span class=\"keyword\">for</span> (<span class=\"keyword\">let</span> k <span class=\"keyword\">in</span> o) &#123;</span><br><span class=\"line\">       <span class=\"keyword\">if</span> (<span class=\"keyword\">new</span> <span class=\"built_in\">RegExp</span>(<span class=\"string\">`(<span class=\"subst\">$&#123;k&#125;</span>)`</span>).test(fmt)) &#123;</span><br><span class=\"line\">         <span class=\"keyword\">let</span> str = o[k] + <span class=\"string\">&#x27;&#x27;</span>;</span><br><span class=\"line\">         fmt = fmt.replace(<span class=\"built_in\">RegExp</span>.$1, (<span class=\"built_in\">RegExp</span>.$1.length === <span class=\"number\">1</span>) ? str : padLeftZero(str));</span><br><span class=\"line\">       &#125;</span><br><span class=\"line\">     &#125;</span><br><span class=\"line\">     <span class=\"keyword\">return</span> fmt;</span><br><span class=\"line\">   &#125;;</span><br><span class=\"line\">   <span class=\"function\"><span class=\"keyword\">function</span> <span class=\"title\">padLeftZero</span>(<span class=\"params\">str</span>) </span>&#123;</span><br><span class=\"line\">     <span class=\"keyword\">return</span> (<span class=\"string\">&#x27;00&#x27;</span> + str).substr(str.length);</span><br><span class=\"line\">   &#125;;</span><br></pre></td></tr></table></figure>\n\n<hr>\n<p><a href=\"https://www.zhangxinxu.com/php/microCodeDetail?id=10\">https://www.zhangxinxu.com/php/microCodeDetail?id=10</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\"><span class=\"comment\">/*</span></span><br><span class=\"line\"><span class=\"comment\">** 时间戳转换成指定格式日期</span></span><br><span class=\"line\"><span class=\"comment\">** eg. </span></span><br><span class=\"line\"><span class=\"comment\">** dateFormat(11111111111111, &#x27;Y年m月d日 H时i分&#x27;)</span></span><br><span class=\"line\"><span class=\"comment\">** → &quot;2322年02月06日 03时45分&quot;</span></span><br><span class=\"line\"><span class=\"comment\">*/</span></span><br><span class=\"line\"><span class=\"keyword\">var</span> dateFormat = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">timestamp, formats</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// formats格式包括</span></span><br><span class=\"line\">    <span class=\"comment\">// 1. Y-m-d</span></span><br><span class=\"line\">    <span class=\"comment\">// 2. Y-m-d H:i:s</span></span><br><span class=\"line\">    <span class=\"comment\">// 3. Y年m月d日</span></span><br><span class=\"line\">    <span class=\"comment\">// 4. Y年m月d日 H时i分</span></span><br><span class=\"line\">    formats = formats || <span class=\"string\">&#x27;Y-m-d&#x27;</span>;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> zero = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (value &lt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&#x27;0&#x27;</span> + value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> value;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> myDate = timestamp? <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(timestamp): <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>();</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> year = myDate.getFullYear();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> month = zero(myDate.getMonth() + <span class=\"number\">1</span>);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> day = zero(myDate.getDate());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">var</span> hour = zero(myDate.getHours());</span><br><span class=\"line\">    <span class=\"keyword\">var</span> minite = zero(myDate.getMinutes());</span><br><span class=\"line\">    <span class=\"keyword\">var</span> second = zero(myDate.getSeconds());</span><br><span class=\"line\"></span><br><span class=\"line\">    <span class=\"keyword\">return</span> formats.replace(<span class=\"regexp\">/Y|m|d|H|i|s/ig</span>, <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">matches</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> (&#123;</span><br><span class=\"line\">            <span class=\"attr\">Y</span>: year,</span><br><span class=\"line\">            <span class=\"attr\">m</span>: month,</span><br><span class=\"line\">            <span class=\"attr\">d</span>: day,</span><br><span class=\"line\">            <span class=\"attr\">H</span>: hour,</span><br><span class=\"line\">            <span class=\"attr\">i</span>: minite,</span><br><span class=\"line\">            <span class=\"attr\">s</span>: second</span><br><span class=\"line\">        &#125;)[matches];</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"> </span><br></pre></td></tr></table></figure>\n\n\n\n<hr>\n<h2 id=\"四-指定时间到当前时间的计算\"><a href=\"#四-指定时间到当前时间的计算\" class=\"headerlink\" title=\"四.指定时间到当前时间的计算\"></a>四.指定时间到当前时间的计算</h2><p><a href=\"https://www.zhangxinxu.com/php/microCodeDetail?id=11\">https://www.zhangxinxu.com/php/microCodeDetail?id=11</a></p>\n<figure class=\"highlight javascript\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"><span class=\"keyword\">var</span> dateDiff = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">timestamp</span>) </span>&#123;</span><br><span class=\"line\">    <span class=\"comment\">// 补全为13位</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> arrTimestamp = (timestamp + <span class=\"string\">&#x27;&#x27;</span>).split(<span class=\"string\">&#x27;&#x27;</span>);</span><br><span class=\"line\">    <span class=\"keyword\">for</span> (<span class=\"keyword\">var</span> start = <span class=\"number\">0</span>; start &lt; <span class=\"number\">13</span>; start++) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (!arrTimestamp[start]) &#123;</span><br><span class=\"line\">            arrTimestamp[start] = <span class=\"string\">&#x27;0&#x27;</span>;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    timestamp = arrTimestamp.join(<span class=\"string\">&#x27;&#x27;</span>) * <span class=\"number\">1</span>;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"keyword\">var</span> minute = <span class=\"number\">1000</span> * <span class=\"number\">60</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> hour = minute * <span class=\"number\">60</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> day = hour * <span class=\"number\">24</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> halfamonth = day * <span class=\"number\">15</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> month = day * <span class=\"number\">30</span>;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> now = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>().getTime();</span><br><span class=\"line\">    <span class=\"keyword\">var</span> diffValue = now - timestamp;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// 如果本地时间反而小于变量时间</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (diffValue &lt; <span class=\"number\">0</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"string\">&#x27;不久前&#x27;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// 计算差异时间的量级</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> monthC = diffValue / month;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> weekC = diffValue / (<span class=\"number\">7</span> * day);</span><br><span class=\"line\">    <span class=\"keyword\">var</span> dayC = diffValue / day;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> hourC = diffValue / hour;</span><br><span class=\"line\">    <span class=\"keyword\">var</span> minC = diffValue / minute;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// 数值补0方法</span></span><br><span class=\"line\">    <span class=\"keyword\">var</span> zero = <span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\">value</span>) </span>&#123;</span><br><span class=\"line\">        <span class=\"keyword\">if</span> (value &lt; <span class=\"number\">10</span>) &#123;</span><br><span class=\"line\">            <span class=\"keyword\">return</span> <span class=\"string\">&#x27;0&#x27;</span> + value;</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> value;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\"> </span><br><span class=\"line\">    <span class=\"comment\">// 使用</span></span><br><span class=\"line\">    <span class=\"keyword\">if</span> (monthC &gt; <span class=\"number\">12</span>) &#123;</span><br><span class=\"line\">        <span class=\"comment\">// 超过1年，直接显示年月日</span></span><br><span class=\"line\">        <span class=\"keyword\">return</span> (<span class=\"function\"><span class=\"keyword\">function</span> (<span class=\"params\"></span>) </span>&#123;</span><br><span class=\"line\">            <span class=\"keyword\">var</span> date = <span class=\"keyword\">new</span> <span class=\"built_in\">Date</span>(timestamp);</span><br><span class=\"line\">            <span class=\"keyword\">return</span> date.getFullYear() + <span class=\"string\">&#x27;年&#x27;</span> + zero(date.getMonth() + <span class=\"number\">1</span>) + <span class=\"string\">&#x27;月&#x27;</span> + zero(date.getDate()) + <span class=\"string\">&#x27;日&#x27;</span>;</span><br><span class=\"line\">        &#125;)();</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (monthC &gt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">parseInt</span>(monthC) + <span class=\"string\">&quot;月前&quot;</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (weekC &gt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">parseInt</span>(weekC) + <span class=\"string\">&quot;周前&quot;</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (dayC &gt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">parseInt</span>(dayC) + <span class=\"string\">&quot;天前&quot;</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (hourC &gt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">parseInt</span>(hourC) + <span class=\"string\">&quot;小时前&quot;</span>;</span><br><span class=\"line\">    &#125; <span class=\"keyword\">else</span> <span class=\"keyword\">if</span> (minC &gt;= <span class=\"number\">1</span>) &#123;</span><br><span class=\"line\">        <span class=\"keyword\">return</span> <span class=\"built_in\">parseInt</span>(minC) + <span class=\"string\">&quot;分钟前&quot;</span>;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    <span class=\"keyword\">return</span> <span class=\"string\">&#x27;刚刚&#x27;</span>;</span><br><span class=\"line\">&#125;;</span><br></pre></td></tr></table></figure>\n\n<p><br><br><br></p>","categories":[{"name":"庖丁解牛","path":"api/categories/庖丁解牛.json"}],"tags":[{"name":"时间戳","path":"api/tags/时间戳.json"},{"name":"日期格式","path":"api/tags/日期格式.json"}]}